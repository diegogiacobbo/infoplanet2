/*1364820993,178142531*/

if (self.CavalryLogger) { CavalryLogger.start_js(["cI2OO"]); }

__d("AggregatedMapCalloutOrientation",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties'),h={};g(h,{TOP:'fbMapCalloutUseArrowTop',LEFT:'fbMapCalloutUseArrowLeft',RIGHT:'fbMapCalloutUseArrowRight',BOTTOM:'fbMapCalloutUseArrowBottom',ALWAYS_ON_MAP:'alwaysOnMap'});e.exports=h;});
__d("AggregatedMapCallout",["AggregatedMapCalloutOrientation","CSS","DOM","Style","Vector","copyProperties"],function(a,b,c,d,e,f){var g=b('AggregatedMapCalloutOrientation'),h=b('CSS'),i=b('DOM'),j=b('Style'),k=b('Vector'),l=b('copyProperties'),m=16,n=10,o=10;function p(q,r,s){this.map=q;this.contentContainer=null;this.width=null;this.height=null;this.anchor=null;this.orientation=g.RIGHT;this.arrowYOffset=null;this.arrowXOffset=null;this.border=r;this.contentContainer=i.find(this.border,'.fbMapCalloutContent');this.arrowWrap=i.find(this.border,'.fbMapCalloutArrowWrap');this.arrowL=i.find(this.border,'.fbMapCalloutArrowLeft');this.arrowR=i.find(this.border,'.fbMapCalloutArrowRight');this.arrowT=i.find(this.border,'.fbMapCalloutArrowTop');this.arrowB=i.find(this.border,'.fbMapCalloutArrowBottom');this._updateDimensions();}l(p.prototype,{setOrientation:function(q){this.orientation=q;},getOrientation:function(){return this.orientation;},getAnchor:function(){return this.anchor;},close:function(){this.anchor=null;this._map_updatePosition();},setContent:function(q){i.setContent(this.contentContainer,q);this._updateDimensions();},getContent:function(){return this.contentContainer;},recalculateArrowYOffset:function(q){if(!this.anchor)return;var r=this.map._callout_determineArrowYOffset(this,q,this.width,this.height);this.setArrowYOffset(r);this._map_updatePosition();},_updateDimensions:function(){h.show(this.border);this.width=k.getElementDimensions(this.border).x;this.height=k.getElementDimensions(this.border).y;this.setArrowXOffset(this.width/2);this.setArrowYOffset(this.height/2);h.hide(this.border);},_map_moveTo:function(q,r){this.anchor=q;this.map._callout_panTo(q,this,r);this._map_updatePosition();},_map_updatePosition:function(){var q=this.anchor&&this.map._callout_getAnchorBounds(this.anchor);if(q===null){h.hide(this.border);return;}var r,s,t,u,v=n,w=this.orientation;if(this.orientation===g.ALWAYS_ON_MAP){var x=q.getCenter().x,y=q.getCenter().y;if(x<0&&y<0){s=o;r=o;}else if(x>this.map.ww&&y<0){t=o;r=o;}else if(x>this.map.ww&&y>this.map.hh){t=o;u=o;}else if(x<0&&y>this.map.hh){s=o;u=o;}else if(x<0){w=g.RIGHT;s=o;r=q.calloutY-this.arrowYOffset;}else if(x>this.map.ww){w=g.LEFT;t=o;r=q.calloutY-this.arrowYOffset;}else if(y<0){w=g.BOTTOM;r=o;s=(q.l+q.r)/2-this.arrowXOffset;}else if(y>this.map.hh){w=g.TOP;u=o;s=(q.l+q.r)/2-this.arrowXOffset;}else{r=q.calloutY-this.arrowYOffset;if(x<this.map.ww/2){s=q.r+v;w=g.RIGHT;}else{s=q.l-v-this.width;w=g.LEFT;}}}switch(this.orientation){case g.LEFT:s=q.l-v-this.width;r=q.calloutY-this.arrowYOffset;break;case g.RIGHT:s=q.r+v;r=q.calloutY-this.arrowYOffset;break;case g.TOP:r=q.t-v-this.height;s=(q.l+q.r)/2-this.arrowXOffset;break;case g.BOTTOM:r=q.b+v;s=(q.l+q.r)/2-this.arrowXOffset;break;}h.setClass(this.arrowWrap,w);this._setPosition('top',r);this._setPosition('right',t);this._setPosition('bottom',u);this._setPosition('left',s);h.show(this.border);},_setPosition:function(q,r){if(r!==undefined){r+='px';}else r='auto';j.set(this.border,q,r);},setArrowXOffset:function(q){this.arrowXOffset=q;q-=Math.round(m/2);j.set(this.arrowT,'left',q+'px');j.set(this.arrowB,'left',q+'px');},setArrowYOffset:function(q){this.arrowYOffset=q;q-=Math.round(m/2);j.set(this.arrowL,'top',q+'px');j.set(this.arrowR,'top',q+'px');}});l(p,{throbber:function(q){q=q||this.DEFAULT_CALLOUT_WIDTH;var r=i.create('div',{}),s=i.create('img',{src:'/images/loaders/indicator_blue_small.gif'});h.setClass(r,'fbAggregatedMapCalloutThrobberDiv');j.set(r,'width',q+'px');h.setClass(s,'fbAggregatedMapCalloutThrobber');i.setContent(r,s);return r;},ARROW_HEIGHT_PLUS_PADDING:n,ARROW_WIDTH:m});e.exports=p;});
__d("AggregatedMapMarker",["DOM","Style","copyProperties"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('Style'),i=b('copyProperties');function j(k,l){this._root=k;this._sprite=l;}i(j.prototype,{setPosition:function(k){var l=k.y-this._sprite.getAnchorY(),m=k.x-this._sprite.getAnchorX();h.set(this._root,'top',l+'px');h.set(this._root,'left',m+'px');},setOnClick:function(k){this._root.onclick=k;},setOnMouseover:function(k){this._root.onmouseover=k;},setOnMouseout:function(k){this._root.onmouseout=k;},remove:function(){g.remove(this._root);},getElement:function(){return this._root;}});e.exports=j;});
__d("AggregatedMapGroup",["AggregatedMapMarker","BingMapCoordinate","DOM","Rect","Style","clip","copyProperties"],function(a,b,c,d,e,f){var g=b('AggregatedMapMarker'),h=b('BingMapCoordinate'),i=b('DOM'),j=b('Rect'),k=b('Style'),l=b('clip'),m=b('copyProperties');function n(o,p,q,r){this._boundingBox=p;this._sprite=q;this._marker=null;this._mapToPixel=r;this.pins=o;this.deleted=false;}m(n.prototype,{getType:function(){return 'AggregatedMapGroup';},getCenter:function(){return this._mapToPixel(this._boundingBox.getCenter());},getCenterLatLong:function(o){var p=this._boundingBox.getCenter(),q=h.fromMap(p.x,p.y,o);return {latitude:q.getLatitude(),longitude:q.getLongitude()};},hasMarker:function(){return !!this._marker;},dismissMarker:function(){if(this._marker){this._marker.remove();this._marker=null;}},getMarker:function(){return this._marker&&this._marker.getElement();},getSprite:function(){return this._sprite;},updatePosition:function(o){if(!this._marker)return;var p=this.getCenter();this._marker.setPosition(p);},getSpriteBounds:function(){var o=this._sprite,p=this.getCenter().y-o.getAnchorY(),q=this.getCenter().x-o.getAnchorX(),r=q+o.getWidth(),s=p+o.getHeight(),t=new j(p,r,s,q);t.calloutY=p+o.getCalloutY();return t;},renderMarker:function(o){if(!this._marker){var p=this._sprite.render();this._marker=new g(p,this._sprite);if(this.pins.length==1){var q=1000+l(Math.floor(this.getCenter().y),0,4000);k.set(p,'z-index',Math.floor(q));}i.appendContent(o,p);}return this._marker;},add:function(o,p){return this._boundingBox.add(o,p);}});e.exports=n;});
__d("AggregatedMapEntity",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties');function h(i,j,k,l,m,n){if(!(j>0))throw new Error('entity id must be > 0');this.arbiter=i;this.options=k||{};this.entityID=j;this.parentEntityID=null;this.name=l;this.location=m;this.locations=n;}g(h.prototype,{getID:function(){return this.entityID;},addTo:function(i){this._add(i.getID());return this;},add:function(){this._add();return this;},remove:function(){this.arbiter.inform('AggregatedMap/removeEntity',{entityID:this.entityID,parentEntityID:this.parentEntityID});this.parentEntityID=null;return this;},setOptions:function(i){g(this.options,i);this._update();return this;},_hasParent:function(){return this.parentEntityID!==null;},_add:function(i){if(this._hasParent())throw new Error('this entity has a parent already');this.parentEntityID=i;var j={location:this.location,locations:this.locations,name:this.name,options:this.options,entityID:this.entityID,parentEntityID:this.parentEntityID};this.arbiter.inform('AggregatedMap/addEntity',j);},_update:function(){if(this._hasParent())this.arbiter.inform('AggregatedMap/setEntityOptions',{entityID:this.entityID,options:this.options});}});e.exports=h;});
__d("MapAggregation",["copyProperties","removeFromArray"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('removeFromArray');function i(){this.combine=null;this.iterations=0;this.candidates=null;this.loners=null;}g(i.prototype,{aggregate:function(j,k,l){this.overlap=l?l:this._overlap;this.candidates=j;this.combine=k;this.loners=[];while(this.candidates.length>0){var m=this.candidates[this.candidates.length-1],n;do{var o=m.center;this._group(m,Number.MAX_VALUE);n=o!==m.center;}while(!this._isDeleted(m)&&n);if(!this._isDeleted(m)){h(this.candidates,m);this.loners.push(m);}}return this.loners;},_isDeleted:function(j){return j.center===null;},_delete:function(j){h(this.candidates,j);h(this.loners,j);j.center=null;},_group:function(j,k){while(true){this.iterations++;if(this.iterations>=10000){this.iterations%10000===0&&0;return;}var l=this._nearest(j),m=l.nearest,n=l.distanceSquared;if(!m||n>k||!this.overlap(j,m))return;var o=m.center,p=j.center;this._group(m,n-1);if(this._isDeleted(j))return;var q=m.center!==o,r=j.center!==p;if(!q&&!r){this.combine(j,m);this._delete(m);return;}}},_nearest:function(j){var k,l,m,n=null,o=Number.MAX_VALUE;for(k=0;k<this.candidates.length;k++){m=this.candidates[k];if(m===j)continue;l=this._distanceSquared(j,m);if(l<o){n=m;o=l;}}for(k=0;k<this.loners.length;k++){m=this.loners[k];if(m===j)continue;l=this._distanceSquared(j,m);if(l<o){n=m;o=l;}}return {nearest:n,distanceSquared:o};},_overlap:function(j,k){var l=j.radius+k.radius;return this._distanceSquared(j,k)<l*l;},_distanceSquared:function(j,k){var l=j.center.x-k.center.x,m=j.center.y-k.center.y;return l*l+m*m;}});e.exports=i;});
__d("AggregatedMap",["Event","AggregatedMapCallout","AggregatedMapCalloutOrientation","AggregatedMapGroup","AggregatedMapEntity","Arbiter","BingMapCoordinate","BingMaps","CSS","DOM","GeoRectangle","MapAggregation","MapRects","Rect","Style","Vector","clip","copyProperties","csx","mod","$"],function(a,b,c,d,e,f){var g=b('Event'),h=b('AggregatedMapCallout'),i=b('AggregatedMapCalloutOrientation'),j=b('AggregatedMapGroup'),k=b('AggregatedMapEntity'),l=b('Arbiter'),m=b('BingMapCoordinate'),n=b('BingMaps'),o=b('CSS'),p=b('DOM'),q=b('GeoRectangle'),r=b('MapAggregation'),s=b('MapRects'),t=b('Rect'),u=b('Style'),v=b('Vector'),w=b('clip'),x=b('copyProperties'),y=b('csx'),z=b('mod'),aa=b('$'),ba=9000,ca=10,da=7,ea=100,fa=50,ga=500,ha=409,ia=90,ja=90,ka=.15,la=10,ma=10,na=10,oa=new t(50,50,50,50);function pa(){this.visiblePins=[];this.groups=[];this.renderOffset={x:0,y:0};this.canvas=null;this.ww=null;this.hh=null;this.callouts=[];this.futureHeight=null;this.futureWidth=null;this.pad={t:0,r:0,b:0,l:0};this.lastRender=null;this.zoom=2;this.topLeft=m.fromLatLong(0,0);this.zoomStack=[];this.arrowYOffset=ja;this.padding=ea+fa;this.initialized=false;this.mapReady=false;this.iframeReady=false;this.initialPinsToHide=[];this.initialView=null;this.entityCounter=1;}x(pa.prototype,{CALLOUT_MARGIN:10,noPanningStrategy:function(qa){return this._noPan.bind(this,qa);},leftRightNoPanningStrategy:function(){return this._leftRightNoPan.bind(this);},anchoredPanningStrategy:function(qa,ra){return this._anchoredPan.bind(this,qa,ra);},smartPanningStrategy:function(qa,ra){return this._smartPan.bind(this,qa,ra);},setPins:function(qa){this._assertInitialized();this.visiblePins=qa;this.calloutAnchor=null;this._setZoomButtonVisibility();this._aggregate();},getGroups:function(){return this.groups;},getWidth:function(){return this._getW();},getHeight:function(){return this._getH();},getBounds:function(){var qa=n.xyToLatLong(this._pixelToMap(new v(0,0)),this.zoom),ra=n.xyToLatLong(this._pixelToMap(new v(this._getW(),this._getH())),this.zoom);return new q(qa.latitude,qa.longitude,ra.latitude,ra.longitude);},pushView:function(){this._assertInitialized();this.zoomStack.push(this._getMapView());},zoomIntoOne:function(qa,ra){this._assertInitialized();this.pushView();this.zoomToOne(qa,ra);},zoomToOne:function(qa,ra,sa){this.zoomToOneTight(qa,ra,0,sa);},zoomToOneTight:function(qa,ra,sa,ta){this._assertInitialized();ra=ra||new v(0,0);sa=sa||0;ta=ta||false;sa=Math.max(this._findMinZoomWherePinIsAlone(qa),sa,this.zoom);qa.setZoom(sa);var ua=qa.anchor.add(sa,ra.mul(-1));this.iframeArbiter.inform('AggregatedMap/setView',{zoom:sa,center:{latitude:ua.getLatitude(),longitude:ua.getLongitude()},animate:ta},l.BEHAVIOR_PERSISTENT);},zoomInto:function(qa){this._assertInitialized();this.pushView();this.zoomTo(qa);},removePin:function(qa){this._assertInitialized();this.removePins([qa]);},removePins:function(qa){this._assertInitialized();for(var ra=0;ra<qa.length;ra++)qa[ra]._aggregated_map_remove=true;var sa=[];for(var ta=0;ta<this.visiblePins.length;ta++)if(!this.visiblePins[ta]._aggregated_map_remove)sa.push(this.visiblePins[ta]);for(var ua=0;ua<qa.length;ua++)delete qa[ua]._aggregated_map_remove;this.visiblePins=sa;this._aggregate();},addPins:function(qa){this._assertInitialized();this.visiblePins=this.visiblePins||[];for(var ra=0;ra<qa.length;ra++)this.visiblePins.push(qa[ra]);this._aggregate();},addPin:function(qa){this._assertInitialized();this.addPins([qa]);},zoomOut:function(){this._assertInitialized();this.logger&&this.logger.bumpTap('zoom-out');this.zoomDelta(-1,true);},zoomIn:function(){this._assertInitialized();this.logger&&this.logger.bumpTap('zoom-in');this.zoomDelta(1,true);},zoomBack:function(){this._assertInitialized();this.logger&&this.logger.bumpTap('snap-back');var qa;if(this.zoomStack.length){qa=this.zoomStack.pop();}else{qa={};x(qa,this.initialView);qa.zoom=Math.min(qa.zoom,this.zoom);}this.iframeArbiter.inform('AggregatedMap/setView',qa);},setInitialView:function(){this._assertInitialized();this.initialView=this._getMapView();var qa=p.scry(this.canvas,"span.__0")[0];qa&&o.hide(qa);},closeCalloutAndZoomBack:function(){this._assertInitialized();this.hideCallout();this.zoomBack();},onAddPin:function(qa,ra){var sa=ra.pin,ta=ra.content;this.hideCallout();this.addPin(sa);this.zoomIntoOne(sa);this.openCallout(sa,ta);},zoomDelta:function(qa,ra){qa=w(this.zoom+qa,this.minZoom,this.maxZoom)-this.zoom;var sa=null;if(ra&&this._getPrimaryCalloutAnchorGroup()){sa=this._getPrimaryCalloutAnchorGroup().getCenter();if(!s.containsPoint(new t(0,this.ww,this.hh,0),sa))sa=null;}this.iframeArbiter.inform('AggregatedMap/zoom',{zoom:qa,anchor:sa});},getZoom:function(){return this.zoom;},getCenter:function(){return n.xyToLatLong(this._pixelToMap(new v(this._getW()/2,this._getH()/2)),this.zoom);},getView:function(){return this._getMapView();},setView:function(qa){this._assertInitialized();this.iframeArbiter.inform('AggregatedMap/setView',qa);},resizingTo:function(qa,ra){this._assertInitialized();this.futureWidth=qa;this.futureHeight=ra;},setViewportPadding:function(qa,ra,sa,ta){this.pad.t=qa;this.pad.r=ra;this.pad.b=sa;this.pad.l=ta;},redraw:function(){this._assertInitialized();this._aggregate();},zoomTo:function(qa,ra){this._assertInitialized();if(qa.length<1)return;var sa=this.maxZoom;if(qa.length<la)while(this._aggregateZoom(qa,sa-1).length==qa.length&&sa>=ma)sa--;var ta=[];for(var ua=0;ua<qa.length;ua++){var va={latitude:qa[ua].getLatitude(),longitude:qa[ua].getLongitude()};ta.push(va);}var wa=n.getViewForLatLongs(this.ww,this.hh,ta,oa,this.minZoom,sa);delete wa.height;delete wa.width;wa.animate=ra;this.iframeArbiter.inform('AggregatedMap/setView',wa,l.BEHAVIOR_PERSISTENT);},hideCallout:function(qa){this._assertInitialized();var ra=this._getPrimaryCallout().getAnchor();this._getPrimaryCallout().close();if(ra&&!qa)this._inform('calloutHidden');},throbber:function(qa){qa=qa||ha;return h.throbber(qa);},openCallout:function(qa,ra,sa){if(this._getTooltipCallout().getAnchor()===qa)this._getTooltipCallout().close();this._getPrimaryCallout().setContent(ra);this._getPrimaryCallout()._map_moveTo(qa,sa);return this._getPrimaryCallout();},getCallout:function(){return this._getPrimaryCallout();},openTooltip:function(qa,ra,sa){if(this._getPrimaryCallout().getAnchor()===qa)return;this._getTooltipCallout().setContent(ra);this._getTooltipCallout()._map_moveTo(qa,sa);return this._getTooltipCallout();},getTooltip:function(){return this._getTooltipCallout();},createPolyline:function(qa,ra){return new k(this.iframeArbiter,this.entityCounter++,ra,'Polyline',null,qa);},createPolygon:function(qa,ra){return new k(this.iframeArbiter,this.entityCounter++,ra,'Polygon',null,qa);},createEntityCollection:function(qa,ra){return new k(this.iframeArbiter,this.entityCounter++,ra,'EntityCollection',null,null);},_callout_getAnchorBounds:function(qa){var ra=this._getCalloutAnchorGroup(qa),sa=ra&&ra.getSpriteBounds();return sa;},_callout_panTo:function(qa,ra,sa){var ta=this._callout_getAnchorBounds(qa),ua=sa?sa(ra,ta):null;if(ua){var va=n.xyToLatLong(this._pixelToMap(ua),this.zoom);this.iframeArbiter.inform('AggregatedMap/setView',{center:va});}},_callout_determineArrowYOffset:function(qa,ra,sa,ta){var ua=this._callout_getAnchorBounds(qa.getAnchor()),va=new v((ua.l+ua.r)/2,ua.calloutY),wa=ta/2,xa=this._getVisibleBounds(),ya=s.containsPoint(this._getNoPanBounds(ta),va,1),za=wa;if(ra||ya){var ab=xa.t+wa+this.CALLOUT_MARGIN,bb=xa.b-(ta-wa)-this.CALLOUT_MARGIN;za+=va.y-w(va.y,ab,bb);}za=w(za,h.ARROW_WIDTH/2,ta-h.ARROW_WIDTH/2);return za;},_createCallout:function(qa){var ra=p.scry(this.canvas,'.fbAggregatedMapCalloutShell')[0],sa=ra.cloneNode(true);p.appendContent(this.canvas,sa);u.set(sa,'z-index',qa);var ta=new h(this,sa);this.callouts.push(ta);return ta;},_getPrimaryCallout:function(){this.primaryCallout=this.primaryCallout||this._createCallout(ba);return this.primaryCallout;},_getTooltipCallout:function(){this.tooltipCallout=this.tooltipCallout||this._createCallout(ba+1);return this.tooltipCallout;},_assertInitialized:function(){},_init:function(qa,ra,sa,ta,ua,va,wa,xa){this.iframeArbiter=ra;this.logger=wa;this.canvas=sa;this.instanceid=ta;this.ww=ua.width;this.hh=ua.height;this.maxZoom=ua.maxZoom;this.minZoom=ua.minZoom;this.maxCalloutWidth=ua.maxCalloutWidth||this.ww-ca;this.maxCalloutHeight=ua.maxCalloutHeight||this.hh-ca;if(navigator.userAgent.toLowerCase().indexOf('khtml')>=0){document.addEventListener('mouseup',this._reroute.bind(this),false);document.addEventListener('mousemove',this._reroute.bind(this),false);}this.listeners=[];this.listeners.push(l.subscribe('onload/exit',this._onBeforeLeave.bind(this)));this.iframeListeners=[this.onViewChangeToken=this.iframeArbiter.subscribe('AggregatedMap/viewchanged',this._onViewChange.bind(this)),this.onViewChangeToken=this.iframeArbiter.subscribe('AggregatedMap/viewchangeend',this._onViewChangeEnd.bind(this)),this.onClickToken=this.iframeArbiter.subscribe('AggregatedMap/click',this._onMapClick.bind(this)),this.iframeReadyToken=this.iframeArbiter.subscribe('AggregatedMap/iframeReady',this._iframeReady.bind(this))];for(var ya in pa.Listeners)this._subscribe('AggregatedMap/'+ya,this[ya].bind(this));this.initialized=true;for(var za=0;za<va.length;za++)va[za].xhp&&this.initialPinsToHide.push(va[za].xhp);va.length&&this.setPins(va);if(xa){va[0].setCallout(aa(xa));this._getPrimaryCallout()._map_moveTo(va[0],this.noPanningStrategy(i.TOP));}o.hide(p.scry(this.canvas,'.fbAggregatedMapCalloutShell')[0]);this._notifyIfReady();},_guard:function(qa){return function(ra,sa){if(!(!sa||!sa._instanceid))if(sa._instanceid===this.instanceid)return qa(ra,sa);}.bind(this);},_subscribe:function(qa,ra){this.listeners.push(l.subscribe(qa,this._guard(ra)));},_inform:function(qa,ra,sa){ra=ra||{};ra._instanceid=this.instanceid;l.inform('AggregatedMap/'+qa,ra,sa);},_bubbleClick:function(qa){this._inform(pa.Events.bubbleClick,qa);},_bubbleMouseover:function(qa){this._inform(pa.Events.bubbleMouseover,qa);},_bubbleMouseout:function(qa){this._inform(pa.Events.bubbleMouseout,qa);},_pinClick:function(qa){if(qa._agg_map_callout)if(this.getCallout().getAnchor()===qa){this.hideCallout();}else this.openCallout(qa,qa._agg_map_callout);this._inform(pa.Events.pinClick,qa);},_pinMouseover:function(qa){if(qa.name){var ra=p.create('span');o.addClass(ra,'fbAggregatedMapTooltipText');p.setContent(ra,qa.name);this.openTooltip(qa,ra,this.leftRightNoPanningStrategy());}this._inform(pa.Events.pinMouseover,qa);},_pinMouseout:function(qa){if(this.tooltipCallout&&this.tooltipCallout.getAnchor()===qa&&qa.name)this.tooltipCallout.close();this._inform(pa.Events.pinMouseout,qa);},_reroute:function(qa){var ra=v.getElementPosition(this.canvas).sub(v.getScrollPosition());this.iframeArbiter.inform('AggregatedMap/mouseEvent',{e:qa,offset:ra});},_getVisibleBounds:function(){return new t(this.pad.t,this._getW()-this.pad.r,this._getH()-this.pad.b,this.pad.l);},_findMinZoomWherePinIsAlone:function(qa){if(this.visiblePins.length<2)return this.minZoom;var ra=Number.MAX_VALUE,sa=null,ta=qa.anchor.getAbsoluteXY();for(var ua=0;ua<this.visiblePins.length;ua++){var va=this.visiblePins[ua],wa=va.anchor.getAbsoluteXY().distanceTo(ta);if(wa<ra&&va!==qa){ra=wa;sa=va;}}var xa=qa.getAggregationRadius()+sa.getAggregationRadius(),ya=this.maxZoom;while(ra/2>xa&&ya>this.minZoom){ya--;ra/=2;}while(ya<this.maxZoom){var za=this._aggregateZoom(this.visiblePins,ya),ab=false;for(var bb=0;bb<za.length;bb++){var cb=za[bb];if(cb.members.length==1&&cb.members[0]===qa)return ya;}ya++;}return ya;},_smartPan:function(qa,ra,sa,ta){qa=qa||this.maxCalloutWidth;ra=ra||this.maxCalloutHeight;var ua=s.pad(this._getNoPanBounds(ra),ga-this.CALLOUT_MARGIN),va=new v(ta.getCenter().x,ta.calloutY);if(s.containsPoint(ua,va)){var wa=this._getVisibleBounds(),xa=va.sub(s.boundPoint(this._getNoPanBounds(ra),va)),ya=ta.w()/2+h.ARROW_HEIGHT_PLUS_PADDING+qa+this.CALLOUT_MARGIN;if(va.x>wa.getCenter().x){sa.setOrientation(i.LEFT);if(!xa.x)xa.x=va.x-Math.max(va.x,ya+wa.l);}else{sa.setOrientation(i.RIGHT);if(!xa.x)xa.x=va.x-Math.min(va.x,wa.r-ya);}var za=null;if(xa.magnitude()>=1)za=new v(this._getW()/2+xa.x,this._getH()/2+xa.y);return za;}return this._anchoredPan(pa.Anchor.DEFAULT,i.RIGHT,this._getPrimaryCallout(),ta);},_leftRightNoPan:function(qa,ra){if(ra.getCenter().x>this._getVisibleBounds().getCenter().x){qa.setOrientation(i.LEFT);}else qa.setOrientation(i.RIGHT);},_noPan:function(qa,ra,sa){ra.setOrientation(qa);},_anchoredPan:function(qa,ra,sa,ta){var ua=this._getVisibleBounds();sa.setOrientation(ra);if(qa===pa.Anchor.DEFAULT)qa=new v(ua.getCenter().x-this.maxCalloutWidth/2-ta.w()/2,ua.getCenter().y-ka*this._getH()-ja+h.ARROW_WIDTH/2);return ta.getCenter().sub(qa).add(new v(this._getW()/2,this._getH()/2));},_getMapSize:function(){return n.mapSize(this.zoom);},_getMapView:function(){var qa=n.xyToLatLong(this._pixelToMap(new v(this._getW()/2,this._getH()/2)),this.zoom);return {zoom:this.zoom,center:qa};},_renderOverlay:function(){if(!this.mapReady)return;this.lastRender=this.topLeft;var qa,ra=new t(-this.padding,this._getW()+this.padding,this._getH()+this.padding,-this.padding);for(var sa=0;sa<this.groups.length;sa++){qa=this.groups[sa];var ta=qa.getCenter();if(s.containsPoint(ra,ta)){var ua=qa.renderMarker(this.canvas);if(qa.pins.length>1){ua.setOnClick(this._bubbleClick.bind(this,qa));ua.setOnMouseover(this._bubbleMouseover.bind(this,qa));ua.setOnMouseout(this._bubbleMouseout.bind(this,qa));}else{ua.setOnClick(this._pinClick.bind(this,qa.pins[0]));ua.setOnMouseover(this._pinMouseover.bind(this,qa.pins[0]));ua.setOnMouseout(this._pinMouseout.bind(this,qa.pins[0]));}}else qa.dismissMarker();}this._position();while(this.initialPinsToHide.length)o.hide(this.initialPinsToHide.pop());},_mapToPixel:function(qa){return this._mapToPixelBounds(qa,-this.padding,this._getW()+this.padding);},_mapToPixelBounds:function(qa,ra,sa){var ta=qa.sub(this.topLeft.getMapXY(this.zoom));if(ta.x<ra&&ta.x+this._getMapSize()<sa){ta.x+=this._getMapSize();}else if(ta.x>sa&&ta.x-this._getMapSize()>ra)ta.x-=this._getMapSize();return ta;},_pixelToMap:function(qa){var ra=qa.add(this.topLeft.getMapXY(this.zoom));ra.x=z(ra.x,this._getMapSize());return ra;},_getNoPanBounds:function(qa){var ra=this._getVisibleBounds();return s.pad(new t(ra.t+ia,ra.r,ra.b-ia,ra.l),-this.CALLOUT_MARGIN);},_getCalloutAnchorGroup:function(qa){return qa&&(qa.group||qa);},_getPrimaryCalloutAnchorGroup:function(){return this._getCalloutAnchorGroup(this._getPrimaryCallout().getAnchor());},updateCallouts:function(){for(var qa=0;qa<this.callouts.length;qa++)this.callouts[qa]._map_updatePosition();},_setZoomButtonVisibility:function(){var qa=p.scry(this.canvas,"label.__1")[0],ra=p.scry(this.canvas,"label.__2")[0];qa&&o.conditionClass(qa,"uiButtonDisabled",this.zoom>=this.maxZoom);ra&&o.conditionClass(ra,"uiButtonDisabled",this.zoom<=this.minZoom);},_aggregate:function(){this.logger&&this.logger.startRun('_aggregate');var qa,ra=this._aggregateZoom(this.visiblePins,this.zoom),sa=[];for(var ta=0;ta<ra.length;ta++){var ua=[],va=ra[ta];qa=new j(va.members,va.rect,va.sprite,this._mapToPixel.bind(this));sa.push(qa);for(var wa=0;wa<va.members.length;wa++)va.members[wa].group=qa;}for(var xa=0;xa<this.groups.length;xa++){qa=this.groups[xa];qa.dismissMarker();qa.deleted=true;}for(var ya=0;ya<this.callouts.length;ya++)if(this.callouts[ya].getAnchor()&&this.callouts[ya].getAnchor().getType()==='AggregatedMapGroup')this.callouts[ya].close();this.groups=sa;this._renderOverlay();this.logger&&this.logger.endRun('_aggregate');},_combine:function(qa,ra){for(var sa=0;sa<ra.members.length;sa++)qa.members.push(ra.members[sa]);qa.rect=s.boundingBox(qa.rect,ra.rect);qa.sprite=qa.sprite.combine(ra.sprite);qa.radius=qa.sprite.getAggregationRadius();qa.center=qa.rect.getCenter();qa.single=0;return qa;},_overlap:function(qa,ra){var sa=qa.center.y-ra.center.y,ta=qa.center.x-ra.center.x;if(qa.single+ra.single==1)if(qa.single&&sa>da/2){sa-=da;}else if(ra.single&&-sa<da/2)sa+=da;var ua=qa.radius+ra.radius;return ta*ta+sa*sa<ua*ua;},_aggregateZoom:function(qa,ra){for(var sa=0;sa<qa.length;sa++){qa[sa].setZoom(ra);var ta=qa[sa].center;qa[sa].rect=new t(ta.y,ta.x,ta.y,ta.x);qa[sa].single=1;}var ua=[],va=[];for(var wa=0;wa<qa.length;wa++){var xa=qa[wa],ya={};x(ya,xa);ya.radius=xa.getAggregationRadius();ya.members=[xa];if(ya.radius){ua.push(ya);}else va.push(ya);}if(ra<this.maxZoom&&ua.length>1)ua=new r().aggregate(ua,this._combine.bind(this),this._overlap.bind(this));return ua.concat(va);},_position:function(){this.logger&&this.logger.startRun('_position');var qa=this._getW()/2;for(var ra=0;ra<this.groups.length;ra++)this.groups[ra].updatePosition(qa);this.updateCallouts();this.logger&&this.logger.endRun('_position');},_notifyIfReady:function(){if(this.initialized&&this.iframeReady)this._inform(pa.Events.ready,this,l.BEHAVIOR_STATE);},_getDims:function(){return new v(this._getW(),this._getH());},_getH:function(){return this.futureHeight||this.hh;},_getW:function(){return this.futureWidth||this.ww;},_onMapClick:function(qa){this._inform(pa.Events.mapClick);},_onViewChangeEnd:function(qa,ra){this._inform(pa.Events.viewChangeEnd,ra);},_onViewChange:function(qa,ra){this.mapReady=true;this._inform(pa.Events.viewChange,ra,l.BEHAVIOR_STATE);this.hh=ra.height;this.ww=ra.width;var sa=ra.zoom;this.topLeft=m.fromLatLong(ra.center).add(sa,this._getDims().mul(-.5));if(this.zoom!==sa){this.zoom=sa;while(this.zoomStack.length&&this.zoom<=this.zoomStack[this.zoomStack.length-1].zoom)this.zoomStack.pop();this._setZoomButtonVisibility();this._aggregate();}else if(!this.lastRender||this.topLeft.calculateDistanceX(sa,this.lastRender)>ea||this.topLeft.calculateDistanceY(sa,this.lastRender)>ea){this._renderOverlay();}else this._position();var ta=p.scry(this.canvas,"span.__0")[0];ta&&o.conditionShow(ta,this._showSnapBack());},_showSnapBack:function(){if(this.zoomStack.length){return true;}else if(this.initialView){var qa=this.initialView;if(this.zoom>qa.zoom){return true;}else{var ra=this._getMapView(),sa=na/n.scale(1,this.zoom);return Math.abs(ra.center.latitude-qa.center.latitude)>sa||Math.abs(ra.center.longitude-qa.center.longitude)>sa;}}return false;},_iframeReady:function(qa,ra){this.iframeReady=true;this._notifyIfReady();},_onBeforeLeave:function(){for(var qa=0;qa<this.iframeListeners.length;qa++)this.iframeArbiter.unsubscribe(this.iframeListeners[qa]);for(var ra=0;ra<this.listeners.length;ra++)this.listeners[ra].unsubscribe();this.logger=null;this.groups=null;}});x(pa,{Anchor:{DEFAULT:'default_anchor'},Events:{calloutHidden:'calloutHidden',ready:'ready',mapClick:'mapClick',viewChange:'viewChange',viewChangeEnd:'viewChangeEnd',bubbleClick:'bubbleClick',bubbleMouseover:'bubbleMouseover',bubbleMouseout:'bubbleMouseout',pinClick:'pinClick',pinMouseover:'pinMouseover',pinMouseout:'pinMouseout',onSearchSubmit:'onSearchSubmit'},Listeners:{hideCallout:'hideCallout',zoomDelta:'zoomDelta',zoomIn:'zoomIn',zoomOut:'zoomOut',zoomBack:'zoomBack',closeCalloutAndZoomBack:'closeCalloutAndZoomBack',onAddPin:'onAddPin'},inform:function(qa,event,ra,sa){if(!ra){ra={};ra._instanceid=qa;}l.inform('AggregatedMap/'+event,ra,sa);},listenThenInform:function(qa,ra,sa,ta){g.listen(ra,sa,function(){pa.inform(qa,ta);});},subscribe:function(qa,event,ra){l.subscribe('AggregatedMap/'+event,pa._guard(qa,ra));},subscribeAll:function(qa,ra){for(var sa in pa.Events){var ta=ra['_mapHandler_'+sa];if(ta){ta=ta.bind(ra);pa.subscribe(qa,sa,ta);}}},_guard:function(qa,ra){return function(sa,ta,ua){if(!ua._instanceid){throw new Error('aggregated map didnt pass instanceid');}else if(ua._instanceid!==qa)return;return sa(ua);}.bind(this,ra);}});e.exports=pa;});
__d("AggregatedMapCircleSprite",["copyProperties","CSS","DOM"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('CSS'),i=b('DOM');function j(o,p,q,r){this._size=o;this._radius=p;this.chooseAggregationRadius=r;this._aggregationRadius=r(this._size);this._count=q;}function k(){return this._radius;}function l(){return this._radius*2;}function m(o){switch(o){case j.SIZE_SMALL:return 9;case j.SIZE_MEDIUM:return 11;case j.SIZE_LARGE:return 16;}}function n(o){var p;if(this.chooseAggregationRadius){p=this.chooseAggregationRadius;}else p=m;var q=this.getCount()+o.getCount();if(q>=100){return j.large(q,p);}else if(q>=10){return j.medium(q,p);}else return j.small(q,p);}g(j.prototype,{render:function(){var o=i.create('div',{className:['fbAggregatedMapBubble','fbAggregatedMapBubble'+this._size].join(' ')});i.setContent(o,this._count);var p=i.create('div',{className:['fbAggregatedMapBubbleShell','fbAggregatedMapBubbleShell'+this._size].join(' ')});i.setContent(p,o);this._root=p;return p;},combine:n,getCount:function(){return this._count;},getHeight:l,getWidth:l,getAnchorX:k,getAnchorY:k,getCalloutX:k,getCalloutY:k,getAggregationRadius:function(){return this._aggregationRadius;}});g(j,{RADIUS_SMALL:15,RADIUS_MEDIUM:20,RADIUS_LARGE:28,SIZE_SMALL:'Small',SIZE_MEDIUM:'Medium',SIZE_LARGE:'Large',small:function(o,p){return new j(j.SIZE_SMALL,j.RADIUS_SMALL,o,p);},medium:function(o,p){return new j(j.SIZE_MEDIUM,j.RADIUS_MEDIUM,o,p);},large:function(o,p){return new j(j.SIZE_LARGE,j.RADIUS_LARGE,o,p);},combine:n});e.exports=j;});
__d("AggregatedMapRedPinSprite",["AggregatedMapCircleSprite","CSS","DOM","copyProperties"],function(a,b,c,d,e,f){var g=b('AggregatedMapCircleSprite'),h=b('CSS'),i=b('DOM'),j=b('copyProperties');function k(l,m,n,o,p,q,r,s,t){this.size=l;this.image=m;this.width=n;this.height=o;this.calloutY=p;this.aggregationRadius=q;this.text=s;this.count=r;this.css=t;}j(k.prototype,{render:function(){var l=i.create('div');h.addClass(l,'fbAggregatedMapPin');h.addClass(l,'fbAggregatedMapPin'+this.size);if(this.css)h.addClass(l,this.css);var m='/images/places/map/'+this.image,n=i.create('img',{src:m});i.appendContent(l,n);var o=null;if(this.text){o=i.create('div');h.addClass(o,'fbAggregatedMapPinText');h.addClass(o,'fbAggregatedMapPinText'+this.size);i.setContent(o,this.count);i.appendContent(l,o);}return l;},combine:g.combine,getCount:function(){return this.count;},getHeight:function(){return this.height;},getWidth:function(){return this.width;},getAnchorX:function(){return this.width/2;},getAnchorY:function(){return this.height;},getCalloutX:function(){return this.width/2;},getCalloutY:function(){return this.calloutY;},getAggregationRadius:function(){return this.aggregationRadius;}});j(k,{dot:function(l){if(l===undefined)l=1;return new k('Small','small_dot.png',17,22,8,10,l,false);},smallBlank:function(l){return new k('Small','small_blank.png',17,22,8,10,l,true);},mediumBlank:function(l){return new k('Medium','medium_blank.png',25,34,12,14,l,true);},largeBlank:function(l){return new k('Large','large_blank.png',29,43,14,17,l,true);}});e.exports=k;});
__d("AggregatedMapPin",["AggregatedMapRedPinSprite","BingMapCoordinate","copyProperties"],function(a,b,c,d,e,f){var g=b('AggregatedMapRedPinSprite'),h=b('BingMapCoordinate'),i=b('copyProperties');function j(){this.anchor=null;this.name=null;this.group=null;}i(j.prototype,{getType:function(){return 'AggregatedMapPin';},setZoom:function(k){this.center=this.anchor.getMapXY(k);},getLatitude:function(){return this.anchor.getLatitude();},getLongitude:function(){return this.anchor.getLongitude();},getGroup:function(){return this.group;},getAggregationRadius:function(){return this.sprite.getAggregationRadius();},setSprite:function(k){this.sprite=k;},setCallout:function(k){this._agg_map_callout=k;}});i(j,{create:function(k,l,m,n){var o=new j();o.anchor=h.fromLatLong(k);o.sprite=l;if(m)o.name=m;if(n)o.xhp=n;return o;},redPinWithDot:function(k,l,m,n){var o=g.dot(n);return j.create(k,o,l,m);},pageLocationPin:function(k,l,m,n){var o=j.redPinWithDot(k,l,m);o.profileID=n;return o;}});e.exports=j;});
__d("legacy:AggregatedMap",["AggregatedMap","AggregatedMapCalloutOrientation"],function(a,b,c,d){a.AggregatedMap=b('AggregatedMap');a.AggregatedMapCalloutOrientation=b('AggregatedMapCalloutOrientation');},3);
__d("legacy:aggregated-map-pin",["AggregatedMapPin"],function(a,b,c,d){a.AggregatedMapPin=b('AggregatedMapPin');},3);
__d("DynamicMap",["Arbiter","ArbiterMixin","CSS","DOM","Run","Style","Vector","copyProperties","ge"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('CSS'),j=b('DOM'),k=b('Run'),l=b('Style'),m=b('Vector'),n=b('copyProperties'),o=b('ge'),p={};function q(){}n(q.prototype,h,{queueInit:function(s,t,u,v,w,x){w=w||{};var y=n(w,{map_options:u,pins:v,DynamicMapArbiter:this});g.inform('DynamicMap/'+s+'/init',y,g.BEHAVIOR_PERSISTENT);if(x){var z=this.subscribe('DynamicMap/'+s+'/copyrightChange',function(aa,ba){j.setContent(x,ba.join(' \u00b7 '));});k.onLeave(function(){this.unsubscribe(z);}.bind(this));}g.subscribe('DynamicMap/moveInfoBox',r.bind(null,t,s));}});function r(s,t,u,v){if(v.mapid!=t)return;var w=parseInt(v.boundingbox.l+(v.boundingbox.r-v.boundingbox.l)/2,10),x=v.boundingbox.t,y=o(v.popupinfobox),z=v.closeinfobox,aa=v.map,ba=v.centerOffset,ca,da=false;if(y){if(v.action==='click'){if(!y.justDragged){if(!p[y.id]){if(o(z)){i.hide(z);delete p[z];}p[y.id]=y;da=true;}else delete p[y.id];}else{y.justDragged=false;for(ca in p)i.removeClass(p[ca],'mapPopUpInfoboxInactive');}}else if(v.action==='drag'){y.justDragged=true;for(ca in p)i.addClass(p[ca],'mapPopUpInfoboxInactive');}else y.justDragged=false;if(p[y.id]){var ea=m.getElementDimensions(s);if(v.boundingbox.l<0||v.boundingbox.t<0||v.boundingbox.r>ea.x||v.boundingbox.b>ea.y){i.hide(y);}else{i.show(y);var fa=m.getElementDimensions(y),ga=w,ha=x-fa.y;if(v.isplacemapinfobox){ga-=(fa.x/2);}else ga-=11;l.set(y,'left',ga+'px');l.set(y,'top',ha+'px');if(da){var ia=aa.getWidth()-(ga+fa.x),ja=aa.getHeight()-(ha+fa.y);ba.x=(ga<0)?-ga:0;ba.x=(ia<0)?ia:ba.x;ba.y=(ha<0)?-ha:0;ba.y=(ja<0)?ja:ba.y;var ka={animate:true,center:aa.getCenter(),centerOffset:ba};aa.setView(ka);}}}else i.hide(y);}}e.exports=q;});
__d("legacy:DynamicMap",["DynamicMap"],function(a,b,c,d){a.DynamicMap=b('DynamicMap');},3);