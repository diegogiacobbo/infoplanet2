/*1365111947,173213213*/

if (self.CavalryLogger) { CavalryLogger.start_js(["hghA6"]); }

__d("FileInputUploader",["ArbiterMixin","DOM","Env","FileForm","Form","copyProperties","submitForm"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('DOM'),i=b('Env'),j=b('FileForm'),k=b('Form'),l=b('copyProperties'),m=b('submitForm');function n(o){this._inputElem=o;this._data={};}l(n.prototype,g,{_formElem:null,_fileForm:null,_uri:null,_allowCrossOrigin:false,_uploadInParallel:false,setURI:function(o){this._uri=o;return this;},setData:function(o){this._data=o;return this;},setAllowCrossOrigin:function(o){this._allowCrossOrigin=!!o;return this;},setUploadInParallel:function(o){this._uploadInParallel=!!o;return this;},send:function(){this._createForm();var o=this._inputElem.cloneNode(false);h.replace(this._inputElem,o);h.appendContent(this._formElem,this._inputElem);h.appendContent(document.body,this._formElem);m(this._formElem);h.replace(o,this._inputElem);this._cleanup();},_onFileFormEvent:function(o,p){this.inform(o,p);},_createForm:function(){this._formElem=h.create('form',{action:this._uri,method:'post'});this._fileForm=new j(this._formElem,null,{allowCrossOrigin:this._allowCrossOrigin,uploadInParallel:this._uploadInParallel});this._fileForm.subscribe(j.EVENTS,this._onFileFormEvent.bind(this));k.createHiddenInputs(l({fb_dtsg:i.fb_dtsg},this._data),this._formElem);},_cleanup:function(){this._fileForm.destroy();this._fileForm=null;h.remove(this._formElem);this._formElem=null;}});e.exports=n;});
__d("PhotosUploadID",[],function(a,b,c,d,e,f){var g=1024,h={getNewID:function(){return g++;}};e.exports=h;});
__d("ProgressBar",["CSS","DOM","Style","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DOM'),i=b('Style'),j=b('copyProperties'),k=b('emptyFunction');function l(o,p,q){this._root=o;this._min=p||0;this._max=q||100;this._meter=h.find(o,'div.fill');this._initialPosition=0;this._position=0;this._initialVelocity=0;this._velocity=0;this._acceleration=0;this.useAcceleration=true;this._loopInterval=30;this._targetPosition=0;this._targetTime=0;this._startTime=null;this._timeout=null;this._onComplete=k;}j(l.prototype,{getRoot:function(){return this._root;},setPosition:function(o){o=this._normalizePosition(o);this._initialPosition=o;this._position=o;this._updateMeter();this.stop();return this;},changeLabel:function(o){var p=h.scry(this._root,'span.label');p.forEach(function(q){h.setContent(q,o);});return this;},setCompleteHandler:function(o){this._onComplete=o||k;return this;},setTarget:function(o,p){clearTimeout(this._timeout);this._targetPosition=o;var q=this._normalizePosition(o);this._targetTime=p;this._initialVelocity=this._velocity;this._initialPosition=this._position;if(this.useAcceleration){this._acceleration=2*(q-this._initialPosition-this._initialVelocity*p)/(p*p);}else{this._acceleration=0;this._velocity=this._initialVelocity=(q-this._initialPosition)/p;}if(this._position>=q){this._onComplete();}else this._start();return this;},setNoAcceleration:function(o){this.useAcceleration=!o;return this;},stop:function(){this._velocity=0;this._initialVelocity=0;this._acceleration=0;clearTimeout(this._timeout);return this;},_start:function(){this._startTime=Date.now();this._timeout=setTimeout(this._loop.bind(this),this._loopInterval);return this;},_loop:function(){var o=Date.now()-this._startTime;this._position=(.5*this._acceleration*o*o)+(this._initialVelocity*o)+this._initialPosition;var p=this._velocity;this._velocity=this._acceleration*o+this._initialVelocity;var q=p<0!==this._velocity<0;this._updateMeter();if(this._position>this._normalizePosition(this._targetPosition)||q){this._velocity=this._initialVelocity=0;this._acceleration=0;this.setPosition(this._targetPosition);this._onComplete();}else this._timeout=setTimeout(this._loop.bind(this),this._loopInterval);},_updateMeter:function(){var o=Math.min(Math.max(this._position,0),1);g.conditionClass(this._meter,'empty',o<=0);g.conditionClass(this._meter,'full',o>=1);i.set(this._meter,'width',o*100+'%');},_normalizePosition:function(o){return Math.min(Math.max((o-this._min)/(this._max-this._min),0),1);}});function m(o,p){o.setPosition(p);}function n(o,p,q){o.setTarget(p,q);}e.exports=l;e.exports.setTarget=n;e.exports.setPosition=m;});
__d("PhotosMultiUploadInput",["Event","Arbiter","AsyncUploadRequest","ComposerXDragDrop","ComposerXController","CSS","Dialog","DOM","DragDropTarget","FileForm","FileInputUploader","Parent","PhotosUploadID","PhotosUploadWaterfallX","ProgressBar","$","copyProperties","csx","cx","tx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('AsyncUploadRequest'),j=b('ComposerXDragDrop'),k=b('ComposerXController'),l=b('CSS'),m=b('Dialog'),n=b('DOM'),o=b('DragDropTarget'),p=b('FileForm'),q=b('FileInputUploader'),r=b('Parent'),s=b('PhotosUploadID'),t=b('PhotosUploadWaterfallX'),u=b('ProgressBar'),v=b('$'),w=b('copyProperties'),x=b('csx'),y=b('cx'),z=b('tx');function aa(fa,ga,ha,ia){this._grid=da.getInstance(ia.gridID);this._grid.setProgressBarMarkup(fa).setVideoIconMarkup(ga).setConfig(ia);ha.getInput().multiple=(ia.maxselect!=1)&&i.isSupported();ha.subscribe('change',function(ja,event){if(event.getTarget().value)this._grid.doFileUpload(ha);}.bind(this));h.inform('PhotosMultiUploadInput/loaded/'+ia.gridID,h.BEHAVIOR_PERSISTENT);}w(aa,{imageUploadDone:function(fa,ga,ha,ia){ba[fa].imageUploadDone(ga,ha,ia);},initDragDrop:function(fa,ga){h.inform('PhotosMultiUploadInput/initDragDrop/'+fa,{dragDropArea:ga},h.BEHAVIOR_PERSISTENT);},imageUploadFail:function(fa,ga){ba[fa].removeLoadingIndicator(ga.getFile().uploadID);},doFileUpload:function(fa,ga){ba[fa].doFileUpload(ga);},onFilesDrop:function(fa,ga){ba[fa]._onFilesDrop(ga);},generateLoadingIndicators:function(fa,ga){ba[fa].generateLoadingIndicators(ga);},setWaterfallID:function(fa,ga){ba[fa].setWaterfallID(ga);},getConfig:function(fa){return ba[fa].getConfig();}});var ba={},ca=0;function da(fa){this._loadingIndicators={};this._numRemainingFiles=0;this._progressBarMarkup=null;this._videoIconMarkup=null;this._gridID=fa;this._dragDropTarget=null;this._submitListener=null;this._fileInputInstances=[];this._videoFileInput=null;this._videoFileInputContainer=null;this._videoUploadSubscriptions=[];this._uploadTimers={};h.subscribe('multi-upload/video-removed/'+this._gridID,function(){n.remove(this._videoIconMarkup);this._submitListener&&this._submitListener.remove();this._submitListener=null;this._videoFileInput=null;this._videoFileInputContainer=null;this._videoUploadSubscriptions.forEach(function(ga){this._config.videoUploader.unsubscribe(ga);}.bind(this));this._fileInputInstances.forEach(function(ga){ga.clear();});}.bind(this));h.subscribe('PhotosMultiUploadInput/initDragDrop/'+fa,function(ga,ha){this.initDragDrop(ha.dragDropArea);}.bind(this));}w(da,{getInstance:function(fa){ba[fa]=ba[fa]||new da(fa);return ba[fa];}});w(da.prototype,{getLoadingIndicator:function(fa){var ga=this._loadingIndicators[fa];return ga;},initDragDrop:function(fa){this._dragDropTarget&&this._dragDropTarget.disable();this._dragDropTarget=new o(fa).setOnFilesDropCallback(this._onFilesDrop.bind(this)).setFileFilter(j.filterImages).enable();},setConfig:function(fa){this._config=fa;return this;},setProgressBarMarkup:function(fa){this._progressBarMarkup=fa;return this;},setVideoIconMarkup:function(fa){this._videoIconMarkup=fa;var ga=n.find(fa,"._3ev");g.listen(ga,'click',this._onVideoRemoved.bind(this));return this;},imageUploadDone:function(fa,ga,ha){var ia=this.getLoadingIndicator(ga);if(!ia)return;h.inform('multi-upload/images-added/'+this._gridID,{fbids:[ha],tagInfo:{}});if(n.contains(document.body,ia.getRoot())){n.replace(ia.getRoot(),fa);this._numRemainingFiles--;if(this._numRemainingFiles===0)h.inform('multi-upload/images-upload-completed/'+this._gridID);}this._loadingIndicators[ga]=null;},generateLoadingIndicators:function(fa){var ga=ea(fa);this._numRemainingFiles+=ga;for(var ha=0;ha<ga;ha++){var ia=this._progressBarMarkup.cloneNode(true);this.insertIntoGrid(ia);var ja;if(fa.files){if(!fa.files[ha].uploadID)fa.files[ha].uploadID=s.getNewID();ja=fa.files[ha].uploadID;}else{fa.uploadID=s.getNewID();ja=fa.uploadID;}this._loadingIndicators[ja]=new u(ia);}},fileUploadFailure:function(fa,ga){if(this._config.waterfallID){var ha=Date.now()-this._uploadTimers[fa];t.sendSignal({qn:this._config.waterfallID,step:t.CLIENT_TRANSFER_FAIL,uploader:t.WEB_COMPOSER,dt:ha,error_code:ga.response.getError()});}this.removeFileUpload(fa);},fileUploadCanceled:function(fa){if(this._config.waterfallID){var ga=Date.now()-this._uploadTimers[fa];t.sendSignal({qn:this._config.waterfallID,step:t.CLIENT_TRANSFER_CANCEL,uploader:t.WEB_COMPOSER,dt:ga});}this.removeFileUpload(fa);},removeFileUpload:function(fa){this._numRemainingFiles=Math.max(0,this._numRemainingFiles-1);this.removeLoadingIndicator(fa);if(this._numRemainingFiles===0)h.inform('multi-upload/images-upload-completed/'+this._gridID);},doFileUpload:function(fa){var ga=false,ha=false;switch(this._config.supportedFileTypes){case 'photos':ha=true;break;case 'videos':ga=true;break;case 'both':ga=ha=true;break;}var ia=fa.getInput().value.split('.').pop().toLowerCase(),ja=this._config.videoUploader.getExtensions(),ka=ga&&!!ja[ia];this._submitListener&&this._submitListener.remove();if(ka){this._videoSelected(fa);}else if(ha){this._photosSelected(fa);}else new m().setBody("Sorry, you can only select video files.").setTitle("Unsupported File").setModal(true).setButtons(m.OK).show();},setWaterfallID:function(fa){this._config.waterfallID=fa;},getConfig:function(){return this._config;},_photosSelected:function(fa){var ga=fa.getInput(),ha=ea(ga);if(this._config.maxselect>1&&ha>this._config.maxselect){new m().setTitle("Too Many Photos").setBody(z._("Sorry, you can only add {maxselect} photos to a message. If you'd like, you can add photos to additional messages.",{maxselect:this._config.maxselect})).setButtons(m.OK).setModal(true).show();return;}this._onBeforeAddUploadedImages();this.generateLoadingIndicators(ga);h.inform('multi-upload/images-upload-start/'+this._gridID,{imageCount:ha});var ia=this._config.uploadData;if(ga.uploadID)ia.upload_id=ga.uploadID;if(this._config.waterfallID)ia.qn=this._config.waterfallID;var ja=new q(ga).setURI(this._config.photoEndpoint).setData(ia).setAllowCrossOrigin(true).setUploadInParallel(true);ja.subscribe('progress',this._onProgress.bind(this));ja.subscribe('failure',function(ka,la){this.fileUploadFailure(la.upload.getFile().uploadID,la);}.bind(this));ja.subscribe('start',this._onFileUploadStart.bind(this));ja.subscribe('success',function(ka,la){this._onFileUploadSuccess(la.upload.getFile().uploadID);}.bind(this));ja.send();fa.clear();if(this._config.waterfallID)t.sendSignal({qn:this._config.waterfallID,step:t.CLIENT_SELECT_SUCCESS,count:ha,uploader:t.WEB_COMPOSER,times_selected:ca++,method:'file_selector'});},_videoSelected:function(fa){var ga=fa.getInput();if(ga.files&&ga.files.length>1){new m().setTitle("Too many files").setBody("Please select only one video file at a time.").setButtons(m.OK).show();return;}h.inform('multi-upload/composer-reset/'+this._gridID);this._dragDropTarget&&this._dragDropTarget.disable();this.insertIntoGrid(this._videoIconMarkup);h.inform('multi-upload/video-added/'+this._gridID);this._fileInputInstances.push(fa);this._videoUploadSubscriptions=[this._config.videoUploader.subscribe('upload-succeeded',this._onVideoUploadFinished.bind(this)),this._config.videoUploader.subscribe('upload-failed',this._onVideoUploadFinished.bind(this)),this._config.videoUploader.subscribe('file-invalidated',this._onVideoUploadFinished.bind(this))];var ha=r.byTag(v(this._gridID),'form');this._submitListener=g.listen(n.find(ha,"._11b"),'click',this._onVideoSubmit.bind(this,ha,ga));},_onVideoRemoved:function(){this._dragDropTarget&&this._dragDropTarget.enable();h.inform('multi-upload/video-removed/'+this._gridID);},_onVideoSubmit:function(fa,ga){fa.action=this._config.videoEndpoint;ga.name='video';this._videoFileInput=ga;this._videoFileInputContainer=ga.parentNode;l.hide(ga);n.appendContent(fa,ga);l.addClass(fa,"_4_8");var ha=p.getInstance(fa);this._config.videoUploader.upload(ha,ga,this._gridID);return false;},_onVideoUploadFinished:function(fa,ga){n.appendContent(this._videoFileInputContainer,this._videoFileInput);l.show(this._videoFileInput);this._onVideoRemoved();var ha=r.byTag(v(this._gridID),'form');l.removeClass(ha,"_4_8");k.reset(ha);},removeLoadingIndicator:function(fa){var ga=this.getLoadingIndicator(fa);ga&&n.remove(ga.getRoot());delete this._loadingIndicators[fa];},_onFileUploadStart:function(fa,ga){var ha=ga.upload.getFile().uploadID,ia=n.find(this.getLoadingIndicator(ha).getRoot(),"._639");l.show(ia);g.listen(ia,'click',function(){ga.upload.abort();this.fileUploadCanceled(ha);}.bind(this));this._uploadTimers[ha]=Date.now();if(this._config.waterfallID)t.sendSignal({qn:this._config.waterfallID,step:t.CLIENT_TRANSFER_BEGIN,uploader:t.WEB_COMPOSER});},_onProgress:function(fa,ga){var ha=ga.event,ia=this.getLoadingIndicator(ga.upload.getFile().uploadID);if(!ia)return;l.hide(n.find(ia.getRoot(),"._2om"));l.show(n.find(ia.getRoot(),'.uiProgressBar'));if(ha.loaded==ha.total){ia.setPosition(50);ia.setTarget(100,2000);}else ia.setPosition(50*ha.loaded/ha.total);},_onFileUploadSuccess:function(fa){var ga=Date.now()-this._uploadTimers[fa];if(this._config.waterfallID)t.sendSignal({qn:this._config.waterfallID,step:t.CLIENT_TRANSFER_SUCCESS,uploader:t.WEB_COMPOSER,dt:ga});},_onFilesDrop:function(fa){this._onBeforeAddUploadedImages();var ga={files:fa};this.generateLoadingIndicators(ga);h.inform('multi-upload/images-upload-start/'+this._gridID,{imageCount:fa.length});var ha=new i().setData(this._config.uploadData).setFiles(fa).setAllowCrossOrigin(true).setURI(this._config.photoEndpoint);ha.subscribe('failure',function(ia,ja){this.fileUploadFailure(ja.getFile().uploadID,ga);}.bind(this));ha.subscribe('progress',function(ia,ja){this._onProgress(ia,{upload:ja,event:ja.getProgressEvent()});}.bind(this));ha.subscribe('start',function(ia,ja){this._onFileUploadStart(ia,{upload:ja});}.bind(this));ha.subscribe('success',function(ia,ja){this._onFileUploadSuccess(ja.getFile().uploadID);}.bind(this));ha.send();if(this._config.waterfallID)t.sendSignal({qn:this._config.waterfallID,step:t.CLIENT_SELECT_SUCCESS,count:fa.length,uploader:t.WEB_COMPOSER,method:'drag_drop'});},_onBeforeAddUploadedImages:function(){if(this._config.maxselect==1)h.inform('multi-upload/composer-reset/'+this._gridID);},insertIntoGrid:function(fa){var ga=n.scry(v(this._gridID),"._577")[0];if(ga){n.insertBefore(ga,fa);}else n.prependContent(v(this._gridID),fa);}});function ea(fa){if(fa.files){return fa.files.length;}else return 1;}e.exports=aa;});
__d("TimelineMapScrollableArea",["Event","Animation","ArbiterMixin","CSS","DOM","Run","SimpleDrag","Style","Vector","$","copyProperties"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Animation'),i=b('ArbiterMixin'),j=b('CSS'),k=b('DOM'),l=b('Run'),m=b('SimpleDrag'),n=b('Style'),o=b('Vector'),p=b('$'),q=b('copyProperties');function r(s,t){s&&this.init(p(s),t);}q(r.prototype,i,{init:function(s,t){t=t||{};this._elem=s;this._wrap=k.find(s,'div.fbScrollableAreaWrap');this._body=k.find(this._wrap,'div.fbScrollableAreaBody');this._track=k.find(s,'div.fbScrollableAreaTrack');this._gripper=k.find(this._track,'div.fbScrollableAreaGripper');this._options=t;this.adjustGripper();this._listeners=[g.listen(this._wrap,'scroll',this._handleScroll.bind(this))];if(t.fade!==false)this._listeners.push(g.listen(s,'mouseenter',this.adjustGripper.shield(this)),g.listen(s,'mouseenter',this.showScrollbar.shield(this)),g.listen(s,'mousemove',this._handleMousemove.bind(this)),g.listen(s,'mouseout',this.hideScrollbar.shield(this)));if(t.fade!==undefined)this._listeners.push(g.listen(this._track,'click',this.clickToScroll.bind(this)));if(t.verticalscroll)this._listeners.push(g.listen(this._wrap,'mousewheel',this.mouseWheel.bind(this)),g.listen(this._wrap,'DOMMouseScroll',this.mouseWheel.bind(this)));this.initDrag();if(!t.persistent)l.onLeave(this.destroy.bind(this));},initDrag:function(){var s=new m(this._gripper);s.subscribe('start',function(t,event){if(!((event.which&&event.which===1)||(event.button&&event.button===1)))return;this.inform('dragstart');var u=o.getEventPosition(event).x,v=this._gripper.offsetLeft,w=s.subscribe('update',function(y,z){var aa=o.getEventPosition(z).x-u,ba=this._elem.clientWidth,ca=this._body.offsetWidth,da=this._track.offsetWidth,ea=ba/ca*da,fa=ca-this._wrap.offsetWidth,ga=v+aa,ha=da-ea;ga=Math.max(Math.min(ga,ha),0);var ia=ga/ha*fa;this._wrap.scrollLeft=ia;}.bind(this)),x=s.subscribe('end',function(){s.unsubscribe(w);s.unsubscribe(x);this.inform('dragend');}.bind(this));}.bind(this));},adjustGripper:function(){var s=this._elem.clientWidth,t=this._body.offsetWidth,u=this._track.offsetWidth,v=s/t*u;if(v<u){n.set(this._gripper,'width',v+'px');var w=this._wrap.scrollLeft/t*u;n.set(this._gripper,'left',w+'px');j.show(this._gripper);}else j.hide(this._gripper);this._checkContentBoundaries();return this;},_checkContentBoundaries:function(){var s=this._wrap.scrollLeft,t=this._wrap.scrollWidth-this._wrap.clientWidth;j.conditionClass(this._elem,'contentBefore',s>0);j.conditionClass(this._elem,'contentAfter',s<t);},destroy:function(){this._listeners.forEach(function(s){s.remove();});this._listeners.length=0;},_handleMousemove:function(event){var s=o.getElementPosition(this._track).y,t=o.getElementDimensions(this._track).y;if(Math.abs(s+t/2-o.getEventPosition(event).y)<25){this.showScrollbar(false);}else this.hideScrollbar();},_handleScroll:function(event){this.adjustGripper();if(this._options.fade!==false)this.showScrollbar();},hideScrollbar:function(){if(!this._scrollbarVisible)return this;this._scrollbarVisible=false;if(this._hideTimeout){clearTimeout(this._hideTimeout);this._hideTimeout=null;}this._hideTimeout=function(){if(this._scrollbarAnimation){this._scrollbarAnimation.stop();this._scrollbarAnimation=null;}this._scrollbarAnimation=new h(this._track).from('opacity',1).to('opacity',0).duration(250).ondone(j.addClass.curry(this._track,'invisible_elem')).go();}.bind(this).defer(750);return this;},showScrollbar:function(s){if(this._scrollbarVisible)return this;this._scrollbarVisible=true;if(this._hideTimeout){clearTimeout(this._hideTimeout);this._hideTimeout=null;}if(this._scrollbarAnimation){this._scrollbarAnimation.stop();this._scrollbarAnimation=null;}this.adjustGripper();n.set(this._track,'opacity',1);j.removeClass(this._track,'invisible_elem');if(s!==false)this.hideScrollbar();return this;},clickToScroll:function(event){var s=o.getEventPosition(event).x,t=this._elem.clientWidth,u=this._body.offsetWidth,v=this._track.offsetWidth,w=t/u*v,x=o.getElementPosition(this._gripper);if(s>=x.x&&s<=x.x+w)return;var y=s<x.x?-1:1,z=this._wrap.offsetWidth*.8*y;this.scrollBy(z);},scrollBy:function(s){var t=this._body.offsetWidth-this._wrap.offsetWidth,u=this._wrap.scrollLeft+s;u=Math.max(Math.min(u,t),0);this._wrap.scrollLeft=u;},mouseWheel:function(event){var s=0;if(event.wheelDelta){var t=event.wheelDelta;if(event.wheelDeltaX&&event.wheelDeltaY)t=Math.abs(event.wheelDeltaX)>Math.abs(event.wheelDeltaY)?event.wheelDeltaX:event.wheelDeltaY;s=-t*10/40;}else if(event.detail)s=event.detail*10;this.scrollBy(s);event.prevent();}});e.exports=a.TimelineMapScrollableArea||r;});
__d("VaultEditableGrid",["Event","Arbiter","AsyncRequest","CSS","DOM","URI","$","copyProperties","csx","ge","removeFromArray"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('AsyncRequest'),j=b('CSS'),k=b('DOM'),l=b('URI'),m=b('$'),n=b('copyProperties'),o=b('csx'),p=b('ge'),q=b('removeFromArray'),r={};function s(t,u){r[t.id]=this;this._grid=t;this._gridID=t.id;this._dialog={};this._dialogEndpoint=u;this._selectedVaultImageIDs=[];h.subscribe('multi-upload/image-removed/'+this._gridID,function(v,w){q(this._selectedVaultImageIDs,w);}.bind(this));h.subscribe('multi-upload/composer-reset/'+this._gridID,this.removeImages.bind(this));h.inform('fbVaultEditableGrid/created/'+t.id,this,h.BEHAVIOR_PERSISTENT);h.subscribe('multi-upload/images-upload-start/'+this._gridID,this._scrollToRight.bind(this));}n(s,{VAULT_IMAGE:'vault_image',getInstance:function(t){return r[t];},registerDialogWithGrid:function(t,u,v,w){h.subscribe(['multi-upload/images-upload-start/'+t,'multi-upload/video-added/'+t],v.hide.bind(v));h.subscribe('fbVaultEditableGrid/created/'+t,function(x,y){y._registerDialogWithGrid(u,v,w);});},onImagesSelected:function(t,u,v,w){r[t]._onImagesSelected(u,v,w);}});n(s.prototype,{getRoot:function(){var t=p(this._gridID);if(t){return t;}else return this._grid;},_registerDialogWithGrid:function(t,u,v){this._dialog[v]=u;var w=this.getMoreLink();w&&g.listen(w,'click',function(){u.show();return false;});u.subscribe('aftershow',function(){var x=[];k.scry(m(this._gridID),'input[type="hidden"]').forEach(function(z){if(z.name.match('composer_vault_images')||z.name.match('composer_unpublished_photo'))x.push(z.value);});var y=t.getGrid();y.bulkChange(function(){var z=y.getSelectionSet();z.clear();z.addAll(x);});}.bind(this));},getID:function(){return this._gridID;},_onImagesSelected:function(t,u,v){var w=k.find(this.getRoot(),"._577");this.removeImages();this._selectedVaultImageIDs=u;t.forEach(function(x){k.insertBefore(w,x);});h.inform('multi-upload/images-added/'+this._gridID,{fbids:u,tagInfo:v});this._scrollToRight();},removeImages:function(){k.scry(this.getRoot(),'.fbVaultGridItem').forEach(function(t){if(!j.hasClass(t,'fbVaultEditableGridMoreLink'))k.remove(t);});this._selectedVaultImageIDs=[];h.inform('multi-upload/all-images-removed/'+this._gridID);},_scrollToRight:function(){var t=this.getRoot(),u=k.find(t,'.fbScrollableAreaWrap');u.scrollLeft=Math.max(0,k.find(t,'.fbScrollableAreaBody').offsetWidth-u.offsetWidth);},showDialog:function(t,u){if(this._dialog[u]){this._dialog[u].show();}else{var v=l(this._dialogEndpoint).addQueryData({type:u});i.bootstrap(v,t);}},getMoreLink:function(){return k.scry(this.getRoot(),'.fbVaultEditableGridMoreLink')[0];}});e.exports=s;});
__d("MercuryPhotoUploader",["Arbiter","ArbiterMixin","CSS","copyProperties","DOM","FileInput","Parent","PhotosMultiUploadInput","VaultEditableGrid","TimelineMapScrollableArea","csx","cx","removeFromArray","Event"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('CSS'),j=b('copyProperties'),k=b('DOM'),l=b('FileInput'),m=b('Parent'),n=b('PhotosMultiUploadInput'),o=b('VaultEditableGrid'),p=b('TimelineMapScrollableArea'),q=b('csx'),r=b('cx'),s=b('removeFromArray'),t=b('Event');function u(v,w,x,y){new p(v,{verticalscroll:true});this._grid=v;this._selectedFBIDs=this._getPreselectedFBIDs();this._uploading=false;this._grid_loaded=false;g.subscribe('PhotosMultiUploadInput/loaded/'+v.id,function(){this._grid_loaded=true;}.bind(this));g.subscribe('MercuryPhotoUploader/initUploadButton/'+v.id,function(){var z=k.scry(w,'input[type="file"]')[0];if(!z)z=k.create('input',{accept:'image/*',type:'file',className:"_n",name:'composer_unpublished_photo[]',multiple:1});var aa=m.byClass(w,"_9_h"),ba=new l(aa,k.find(aa,"._214"),z);ba.subscribe('change',n.doFileUpload.curry(v.id,ba));});g.subscribe('MercuryPhotoUploader/registerPhotoMenu/'+v.id,function(z,aa){var ba=aa.menu.getRoot();aa.menu.setContext(w);var ca=k.scry(ba,"._d2p"),da=ca&&ca[0];da&&t.listen(da,'click',function(){o.getInstance(v.id).showDialog(da,o.VAULT_IMAGE);});var ea=k.scry(ba,"._52w_"),fa=ea&&ea[0];fa&&t.listen(fa,'click',function(){o.getInstance(v.id).showDialog(fa,aa.type);});t.listen(w,'click',function(){if(!this._grid_loaded)return;if(!aa.menu.isShown())this.inform('menu-show');aa.menu.show();}.bind(this));t.listen(document.documentElement,'click',function(event){if(!k.contains(w,event.getTarget())&&!k.contains(da,event.getTarget())&&!k.contains(fa,event.getTarget())){if(aa.menu.isShown())this.inform('menu-hide');aa.menu.hide();}}.bind(this));var ga=k.find(ba,"._9_h");t.listen(ga,'click',function(){this.inform('selection-start');}.bind(this));}.bind(this));x.addSubscriptions(g.subscribe('multi-upload/images-added/'+this._grid.id,function(z,aa){this._selectedFBIDs=this._selectedFBIDs.concat(aa.fbids);this._imagesChanged();this.inform('upload-completed',{fbids:aa.fbids});}.bind(this)),g.subscribe('multi-upload/image-removed/'+this._grid.id,function(z,aa){s(this._selectedFBIDs,aa);this._imagesChanged();}.bind(this)),g.subscribe('multi-upload/images-upload-start/'+this._grid.id,function(z,aa){i.show(this._grid);this._uploading=true;this.inform('dom-updated');this.inform('upload-started',aa);}.bind(this)),g.subscribe('multi-upload/composer-reset/'+this._grid.id,this.clear.bind(this)),g.subscribe('multi-upload/all-images-removed/'+this._grid.id,this._onImagesRemoved.bind(this)),g.subscribe('multi-upload/images-upload-completed/'+this._grid.id,function(z){this._uploading=false;this.inform('all-uploads-completed');}.bind(this)));i.conditionShow(this._grid,this._selectedFBIDs.length);y&&n.initDragDrop(v.id,y);}j(u,{initUploadButton:function(v){g.inform('MercuryPhotoUploader/initUploadButton/'+v,{},g.BEHAVIOR_PERSISTENT);},registerPhotoMenu:function(v,w,x){g.inform('MercuryPhotoUploader/registerPhotoMenu/'+v,{menu:w,type:x},g.BEHAVIOR_PERSISTENT);}});j(u.prototype,h,{getSelectedFBIDs:function(){return this._selectedFBIDs;},isUploading:function(){return this._uploading;},clear:function(){var v=o.getInstance(this._grid.id);v&&v.removeImages();},setWaterfallID:function(v){n.setWaterfallID(this._grid.id,v);},_onImagesRemoved:function(){this._selectedFBIDs=[];this._uploading=false;i.hide(this._grid);this.inform('all-uploads-completed');this.inform('dom-updated');},_getPreselectedFBIDs:function(){var v=[];k.scry(this._grid,'input[type="hidden"]').forEach(function(w){if(w.name.match('composer_vault_images'))v.push(w.value);});return v;},_imagesChanged:function(){i.conditionShow(this._grid,this._selectedFBIDs.length>0);this.inform('dom-updated');}});e.exports=u;});
__d("MercuryShareLinkUploader",["ArbiterMixin","AsyncRequest","CSS","copyProperties","DOM","Form","HTML","URLScraper","WebMessengerEvents","Event"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('AsyncRequest'),i=b('CSS'),j=b('copyProperties'),k=b('DOM'),l=b('Form'),m=b('HTML'),n=b('URLScraper'),o=b('WebMessengerEvents'),p=b('Event');function q(t,u,v,w,x){this._stageElement=t;this._stageContentElement=u;this._stageLoadingElement=v;this._isShareLoaded=false;this._shareInProgress=null;this._currentAsyncRequest=null;p.listen(w,'click',this.close.bind(this));this._scraper=new n(x);this._scraper.subscribe('match',s.curry(this));}j(q.prototype,g);j(q.prototype,{getAttachData:function(){if(this._isShareLoaded){return l.serialize(this._stageElement);}else return null;},check:function(){this._scraper.check();},close:function(){r(this);this._scraper.disable();this.inform('closed');},clear:function(){r(this);this._scraper.enable();},enable:function(){this._scraper.enable();},disable:function(){this._scraper.disable();}});function r(t){i.hide(t._stageElement);t._isShareLoaded=false;t._shareInProgress=null;t._currentAsyncRequest&&t._currentAsyncRequest.abort();t._currentAsyncRequest=null;t._scraper.reset();o.detailDOMChanged();}function s(t,event,u){t._shareInProgress=u.url;t._currentAsyncRequest&&t._currentAsyncRequest.abort();t._currentAsyncRequest=new h().setMethod('POST').setURI('/ajax/share_scrape.php').setData({u:u.url}).setHandler(function(v){if(t._shareInProgress!==u.url)return;t._shareInProgress=null;t._currentAsyncRequest=null;i.show(t._stageElement);k.empty(t._stageContentElement);k.setContent(t._stageContentElement,m(v.payload));t._isShareLoaded=true;o.detailDOMChanged();}).setStatusElement(t._stageLoadingElement);t._currentAsyncRequest.send();t.inform('link-detected');}e.exports=q;});
__d("FreeformTokenizerBehavior",["Input","Keys","Event","function-extensions"],function(a,b,c,d,e,f){var g=b('Input'),h=b('Keys'),i=b('Event');b('function-extensions');function j(k,l){var m=l.tokenize_on_blur!==false,n=l.tokenize_on_paste!==false,o=l.matcher&&new RegExp(l.matcher,'i'),p=l.paste_split&&new RegExp(l.paste_split),q=l.select_on_comma!==false;function r(event){var s=g.getValue(k.getInput()).trim();if(p&&event&&event.type=='paste'){s=s.split(p);}else s=[s];var t=false;for(var u=0;u<s.length;u++){var v=s[u].trim();if(v&&(!o||o.test(v))){var w={uid:v,text:v,freeform:true};k.addToken(k.createToken(w));t=true;}}if(event&&t){k.getTypeahead().getCore().afterSelect();event.kill();}}k.subscribe('keydown',function(s,t){var event=t.event,u=i.getKeyCode(event);if((q&&u==h.COMMA)||u==h.RETURN){var v=k.getTypeahead().getView();if(v.getSelection()){v.select();event.kill();}else r(event);}});k.subscribe('paste',function(s,t){if(n)r.bind(null,t.event).defer(20);});k.subscribe('blur',function(s,t){if(m)r();k.getTypeahead().getCore().reset();});}e.exports=j;});
__d("MercuryDataSources",[],function(a,b,c,d,e,f){var g={},h={add:function(i,j){g[i]=j;},get:function(i){!g[i];return g[i];}};e.exports=h;});
__d("MercuryTypeaheadRenderer",["JSXDOM","Event","MercuryConstants","CSS","DOM","MercuryImageTemplates","MercuryTypeaheadTemplates","copyProperties","cx"],function(a,b,c,d,e,f){var g=b('JSXDOM'),h=b('Event'),i=b('MercuryConstants'),j=b('CSS'),k=b('DOM'),l=b('MercuryImageTemplates'),m=b('MercuryTypeaheadTemplates'),n=b('copyProperties'),o=b('cx');function p(r,s){var t=i.MercuryTypeaheadConstants,u;switch(r.type){case t.HEADER_TYPE:u=m[':fb:mercury:typeahead:header'].build();p.renderHeader(u,r);break;case t.USER_TYPE:u=m[':fb:mercury:typeahead:result'].build();p.renderPerson(u,r);break;default:throw new Error('Unsupported result type: '+r.type);}return u.getRoot();}n(p,{renderHeader:function(r,s){if(s.disabled){j.hide(r.getRoot());return;}var t=s.getLinkHandler&&s.getLinkHandler();if(t){var u=r.getNode('link');k.setContent(u,s.linkText);h.listen(u,'click',t);}else j.hide(r.getNode('link'));r.setNodeContent('text',s.text);},renderPersonWithBigPhoto:function(r,s){var t=l[':fb:mercury:thread-image:single'].build();q(r,s,t);},renderPerson:function(r,s){var t=l[':fb:mercury:thread-image:single:medium'].build();q(r,s,t);}});function q(r,s,t){if(s.photo){t.getRoot().setAttribute('src',s.photo);k.setContent(r.getNode('image'),t.getRoot());}if(s.text){k.setContent(r.getNode('name'),s.text);r.getRoot().setAttribute('aria-label',s.text);}var u=[];if(s.subtext||s.category){if(s.subtext)u.push(s.subtext);if(s.category)u.push(s.category);k.appendContent(r.getNode('snippet'),u.join(" \u00b7 "));}if(s.non_employee){if(u.length)k.prependContent(r.getNode('snippet')," \u00b7 ");k.prependContent(r.getNode('snippet'),g.span({className:"_52l8 highlight"},"(Non-employee)"));}}e.exports=p;});
__d("WebMessengerAddPeopleToConversationDialog",["ContextualTypeaheadView","Dialog","DOM","FreeformTokenizerBehavior","MercuryAPIArgsSource","MercuryDataSources","MercuryLogMessageType","MercurySourceType","MercuryTypeahead","MercuryTypeaheadRenderer","MercuryMessages","WebMessengerTemplates","MercuryThreads","WebMessengerConstants","tx"],function(a,b,c,d,e,f){var g=b('ContextualTypeaheadView'),h=b('Dialog'),i=b('DOM'),j=b('FreeformTokenizerBehavior'),k=b('MercuryAPIArgsSource'),l=b('MercuryDataSources'),m=b('MercuryLogMessageType'),n=b('MercurySourceType'),o=b('MercuryTypeahead'),p=b('MercuryTypeaheadRenderer'),q=b('MercuryMessages').get(),r=b('WebMessengerTemplates'),s=b('MercuryThreads').get(),t=b('WebMessengerConstants'),u=b('tx'),v={show:function(x){var y="Add People",z={};z[t.FRIEND_TYPE]={uid:t.FRIEND_TYPE,type:t.HEADER_TYPE,disabled:true};z[t.NON_FRIEND_TYPE]={uid:t.NON_FRIEND_TYPE,text:"Other People",type:t.HEADER_TYPE};var aa=new o(l.get('MercuryRecipientsDataSource'),g);aa.setViewOption('renderer',p);aa.setViewOption('typeObjects',z);aa.addTokenizerBehavior({behavior:j,config:{matcher:t.VALID_EMAIL}});aa.setPlaceholder("Enter a friend's name");var ba=[];ba.push({name:'subscribe',label:y,handler:w.bind(null,x,aa)});ba.push(h.CANCEL);var ca=r[':fb:web-messenger:add-people-dialog'].build(),da=new h().setTitle(y).setBody(ca.getRoot()).setButtons(ba).showLoading();s.getThreadMeta(x,function(ea){aa.setFullWidthView(ca.getNode('participantsTypeahead'));aa.setExcludedParticipants(ea.participants);aa.build();i.appendContent(ca.getNode('participantsTypeahead'),aa.getElement());da.show();aa.focus();},k.WEBMESSENGER);}};function w(x,y){var z=y.getTokens(),aa=z.map(function(ba){if(ba.getInfo().type==t.USER_TYPE){return 'fbid:'+ba.getValue();}else return 'email:'+ba.getValue();});if(!aa.length)return false;q.sendMessage(q.constructLogMessageObject(n.TITAN_WEB,x,m.SUBSCRIBE,{added_participants:aa}),null,k.WEBMESSENGER);return true;}e.exports=v;});
__d("Autosize",["CSS","cx","DOM","Style"],function(a,b,c,d,e,f){var g=b("CSS"),h=b('cx'),i=b("DOM"),j=b("Style"),k=['fontFamily','fontStyle','fontVariant','fontWeight','letterSpacing','textDecoration','textIndent','textTransform','whiteSpace','wordSpacing','wordWrap'],l=/^[0-9]+$/;function m(r){var s=r.cloneNode(true);g.addClass(s,"_4g");var t=r.clientWidth-j.getFloat(r,'paddingLeft')-j.getFloat(r,'paddingRight');j.set(s,'width',t+'px');var u=r.clientHeight-j.getFloat(r,'paddingTop')-j.getFloat(r,'paddingBottom');j.set(s,'height',u+'px');i.insertAfter(r,s);return s;}function n(r,s,t,u,v){var w=r.style.fontSize,x=r.style.height;j.set(r,"height","auto");if(s!==null){var y=r.style.width;j.set(r,"width","auto");}var z=0,aa=v.length-1;while(z<aa){var ba=Math.ceil((z+aa)/2);j.set(r,"font-size",v[ba]+u);if((t!==null&&r.scrollHeight>t)||(s!==null&&r.scrollWidth>s)){aa=ba-1;}else z=ba;}r.style.fontSize=w;r.style.height=x;if(s!==null)r.style.width=y;return v[z]+u;}function o(r,s,t,u,v,w){var x=r.style.fontSize,y=r.style.height;j.set(r,"height","auto");if(s!==null){var z=r.style.width;j.set(r,"width","auto");}j.set(r,"font-size",w+u);if((t===null||r.scrollHeight<=t)&&(s===null||r.scrollWidth<=s)){r.style.fontSize=x;r.style.height=y;if(s!==null)r.style.width=z;return w+u;}j.set(r,"font-size",v+u);if((t!==null&&r.scrollHeight>t)||(s!==null&&r.scrollWidth>s)){r.style.fontSize=x;r.style.height=y;if(s!==null)r.style.width=z;return v+u;}while(v+1<w){var aa=Math.ceil((v+w)/2);j.set(r,"font-size",aa+u);if((t!==null&&r.scrollHeight>t)||(s!==null&&r.scrollWidth>s)){w=aa;}else v=aa;}r.style.fontSize=x;r.style.height=y;if(s!==null)r.style.width=z;return v+u;}function p(r,s){this._wrap=r;this._attr=s;if(this._attr.sizes){var t=this._attr.sizes;for(var u=1,v=t.length;u<v;u++){if(t[u-1]<=t[u])continue;t.sort(function(x,y){return x-y;});break;}}else if(s.min>s.max){var w=s.min;s.min=s.max;s.max=w;}this.fit();}p.prototype.fit=function(r,s){var t=this._wrap;if(!t.clientWidth){q.push(this);return;}var u=m(t);if(typeof r==="undefined")r=this._attr.width;if(l.test(r)){u.style.width=r+"px";}else if(r!==null&&r!=="auto")u.style.width=r;if(typeof s==="undefined")s=this._attr.height;if(l.test(s)){u.style.height=s+"px";}else if(s!==null&&s!=="auto")u.style.height=s;var v=null;if(!this._attr.wrap)v=u.clientWidth;var w=null;if(this._attr.wrap||s!==null)w=u.clientHeight;var x;if(this._attr.sizes){x=n(u,v,w,"px",this._attr.sizes);}else x=o(u,v,w,"px",this._attr.min,this._attr.max);i.remove(u);j.set(t,"font-size",x);g.removeClass(t,"invisible_elem");};var q=[];p.onNodeInserted=function(){var r=q;q=[];r.forEach(function(s){s.fit();});};e.exports=p;});
__d("WebMessengerEditThreadDialog",["Event","Button","ContextualDialog","CSS","DOM","FileInput","FileInputUploader","Input","InputSelection","LayerFadeOnHide","LayerFadeOnShow","MercuryAPIArgsSource","MercuryLogMessageType","MercurySourceType","MercuryMessages","WebMessengerTemplates","MercuryThreads","URI","WebMessengerSubscriptionsHandler","copyProperties","csx","cx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Button'),i=b('ContextualDialog'),j=b('CSS'),k=b('DOM'),l=b('FileInput'),m=b('FileInputUploader'),n=b('Input'),o=b('InputSelection'),p=b('LayerFadeOnHide'),q=b('LayerFadeOnShow'),r=b('MercuryAPIArgsSource'),s=b('MercuryLogMessageType'),t=b('MercurySourceType'),u=b('MercuryMessages').get(),v=b('WebMessengerTemplates'),w=b('MercuryThreads').get(),x=b('URI'),y=b('WebMessengerSubscriptionsHandler'),z=b('copyProperties'),aa=b('csx'),ba=b('cx'),ca=':fb:web-messenger:read-view:header:edit-multichat',da=function(){var ea=v[ca].build();this._dialog=new i({position:'below',addedBehaviors:[p,q]},ea.getRoot());this._saveButton=ea.getNode('saveButton');this._pictureInput=ea.getNode('newPicture');this._uploadButton=ea.getNode('uploadButton');this._uploadingThrobber=ea.getNode('uploadingThrobber');this._uploadedFileDetails=ea.getNode('uploadedFileDetails');this._fileNameNode=ea.getNode('fileName');this._cancelImageButton=ea.getNode('cancelImage');this._threadID=null;var fa=ea.getNode('newName');this._uploadedImage=null;if(!this._pictureInput){var ga=k.scry(ea.getRoot(),"._8-9")[0];this._pictureInput=k.create('input',{accept:'image/*',type:'file',className:"_n",name:'attachment[]',multiple:1,tabindex:1});new l(ga,this._uploadButton,this._pictureInput);}this._uploader=new m(this._pictureInput);this._uploader.setURI(x('/ajax/mercury/upload.php').setSubdomain('attachments').toString());y.addSubscriptions(this._uploader.subscribe('success',this._onFileUploadSuccess.bind(this)),g.listen(this._pictureInput,'change',this._onFileUploadChange.bind(this)),g.listen(this._cancelImageButton,'click',this._resetImageUpload.bind(this)));this._dialog.subscribe('submit',function(){this.save(n.getValue(fa));this._dialog.hide();return false;}.bind(this));this._dialog.subscribe('show',function(){var ha=w.getThreadMetaNow(this._threadID);n.setValue(fa,ha.name);this._resetImageUpload();}.bind(this));this._dialog.subscribe('aftershow',function(){o.set(fa,0,n.getValue(fa).length);}.bind(this));};z(da.prototype,{toggleShown:function(ea,fa){if(!this._dialog.isShown()){this._dialog.setContext(ea);this._threadID=fa;this._uploadedImage=null;this._dialog.show();}else this._dialog.hide();},save:function(ea){var fa=null,ga=w.getThreadMetaNow(this._threadID);if(ga)fa=ga.name;if((ea||fa)&&(ea!=fa))u.sendMessage(u.constructLogMessageObject(t.CHAT_WEB,this._threadID,s.THREAD_NAME,{name:ea}),null,r.WEBMESSENGER);if(this._uploadedImage)u.sendMessage(u.constructLogMessageObject(t.CHAT_WEB,this._threadID,s.THREAD_IMAGE,{image:this._uploadedImage}));},_onFileUploadChange:function(event){var ea=n.getValue(event.getTarget());if(ea){h.setEnabled(this._saveButton,false);j.hide(this._uploadButton);j.hide(this._uploadedFileDetails);j.show(this._uploadingThrobber);this._uploader.send();}},_onFileUploadSuccess:function(ea,fa){var ga=fa.response.getPayload();this._uploadedImage=ga.metadata[0];k.setContent(this._fileNameNode,this._uploadedImage.filename);j.hide(this._uploadingThrobber);j.hide(this._uploadButton);j.show(this._uploadedFileDetails);h.setEnabled(this._saveButton,true);},_resetImageUpload:function(){this._uploadedImage=null;j.hide(this._uploadingThrobber);j.hide(this._uploadedFileDetails);j.show(this._uploadButton);}});e.exports=da;});
__d("MercuryPresence",["Arbiter","AvailableListConstants","DOM","CSS"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AvailableListConstants'),i=b('DOM'),j=b('CSS'),k={},l={},m={updateOnPresenceChanges:function(r,s){l[s.tagName]=true;k[r]=true;j.addClass(s,'presenceListener_'+r);o(s,n(r));}};function n(r){var s=q(r),t={presenceActive:false,presenceMobile:false};switch(s){case h.ACTIVE:t.presenceActive=true;break;case h.MOBILE:t.presenceMobile=true;break;default:break;}return t;}function o(r,s){for(var t in s)j.conditionClass(r,t,s[t]);}function p(){for(var r in k){var s=n(r);for(var t in l){var u=i.scry(document,t+'.presenceListener_'+r);for(var v=0;v<u.length;v++)o(u[v],s);}}}var q=function(r){return h.OFFLINE;};d(['AvailableList'],function(r){q=r.get;p();});g.subscribe(h.ON_AVAILABILITY_CHANGED,p);e.exports=m;});
__d("WebMessengerStateManager",["Arbiter","Dialog","Env","Focus","JSLogger","MercuryFilters","WebMessengerPermalinks","WebMessengerStateConstants","WebMessengerEvents","MessagingTag","copyProperties","tx"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('Dialog'),i=b('Env'),j=b('Focus'),k=b('JSLogger'),l=b('MercuryFilters'),m=b('WebMessengerPermalinks'),n=b('WebMessengerStateConstants'),o=b('WebMessengerEvents'),p=b('MessagingTag'),q=b('copyProperties'),r=b('tx'),s=k.create('wm_state_manager'),t=i.user,u=q(new g(),{getCurrentUserID:function(){return t;},getCurrentMasterState:function(){return y;},getCurrentDetailState:function(){return z;},getCurrentStateData:function(){return aa;},setUserID:function(ca){t=ca||i.user;},updateMasterState:function(ca,da){u.updateAllStates(ca,z,da);},updateDetailState:function(ca,da){u.updateAllStates(y,ca,da);},updateAllStates:function(ca,da,ea){for(var fa=0;fa<ba.length;fa++)if(ba[fa]){var ga=ba[fa](ca,da,ea);if(ga){x(ga,ca,da,ea);return;}}v(ca,da,ea);},updateStateOnURI:function(ca,da,ea){w(ca,da,ea);},registerConfirmationBeforeStateUpdate:function(ca){var da=ba.length;ba.push(ca);return da;},unregisterConfirmationBeforeStateUpdate:function(ca){delete ba[ca];}});function v(ca,da,ea){if(!ea.folder)ea.folder=aa.folder;if(!ea.filter)ea.filter=aa.filter;if(!m.goNextURI(ca,da,ea))w(ca,da,ea);}function w(ca,da,ea){y=ca;z=da;aa=ea;var fa=q({},aa);fa.new_tokens=[];(aa.new_tokens||[]).forEach(function(ga){fa.new_tokens.push(ga.getInfo());});fa.new_tokens=[];s.log('state_updated',{master_state:y,detail_state:z,data:fa});u.inform(n.STATE_CHANGE_EVENT);}function x(ca,da,ea,fa){s.log('confirmation_dialog',{master_state:y,detail_state:z,data:aa,new_master_state:da,new_detail_state:ea,new_data:fa,text:ca});var ga=[];ga.push({name:'yes',label:"Yes",handler:function(){v(da,ea,fa);o.inform(o.FOCUS_COMPOSER);}});ga.push(q({handler:o.inform.curry(o.FOCUS_COMPOSER)},h.CANCEL));var ha=new h().setTitle("Are you sure you want to navigate away?").setBody(ca).setButtons(ga).setModal(true).show(),ia=ha.getButtonElement('yes');ia&&j.set(ia);}var y=n.MASTER.RECENT_THREADS,z=n.DETAIL.RECENT_MESSAGES,aa={thread_id:null,folder:p.INBOX,filter:l.ALL},ba=[undefined];e.exports=u;});
__d("WebMessengerDetailViewHeaderControl",["JSXDOM","Event","WebMessengerAddPeopleToConversationDialog","Autosize","ContextualDialog","CSS","DOM","WebMessengerEditThreadDialog","HovercardLink","HoverFlyout","LayerFadeOnHide","LayerFadeOnShow","MercuryAPIArgsSource","MercuryConfig","MercuryParticipantTypes","MercuryParticipants","MercuryPresence","ScrollableArea","WebMessengerStateConstants","WebMessengerStateManager","Style","WebMessengerTemplates","MercuryThreadInformer","MercuryThreadMetadataRenderer","MercuryThreads","WebMessengerConstants","WebMessengerEvents","WebMessengerSubscriptionsHandler","copyProperties","csx","cx","tx"],function(a,b,c,d,e,f){var g=b('JSXDOM'),h=b('Event'),i=b('WebMessengerAddPeopleToConversationDialog'),j=b('Autosize'),k=b('ContextualDialog'),l=b('CSS'),m=b('DOM'),n=b('WebMessengerEditThreadDialog'),o=b('HovercardLink'),p=b('HoverFlyout'),q=b('LayerFadeOnHide'),r=b('LayerFadeOnShow'),s=b('MercuryAPIArgsSource'),t=b('MercuryConfig'),u=b('MercuryParticipantTypes'),v=b('MercuryParticipants'),w=b('MercuryPresence'),x=b('ScrollableArea'),y=b('WebMessengerStateConstants'),z=b('WebMessengerStateManager'),aa=b('Style'),ba=b('WebMessengerTemplates'),ca=b('MercuryThreadInformer').get(),da=b('MercuryThreadMetadataRenderer').get(),ea=b('MercuryThreads').get(),fa=b('WebMessengerConstants'),ga=b('WebMessengerEvents'),ha=b('WebMessengerSubscriptionsHandler'),ia=b('copyProperties'),ja=b('csx'),ka=b('cx'),la=b('tx'),ma=function(ra){this._rootElement=ra;m.empty(this._rootElement);this._renderHeaderBar();};ia(ma.prototype,{hideView:function(){l.hide(this._rootElement);},updateView:function(){l.removeClass(this._rootElement,'isMultichat');l.show(this._rootElement);this._listener&&ca.unsubscribe(this._listener);var ra=y;switch(z.getCurrentDetailState()){case ra.DETAIL.RECENT_MESSAGES:case ra.DETAIL.SEARCH_CONTEXT:case ra.DETAIL.SEARCH_THREAD_SNIPPET:this.setThreadID(z.getCurrentStateData().thread_id);break;default:this.setThreadID(null);break;}ga.detailDOMChanged();},setThreadID:function(ra){this._threadID=ra;if(this._threadID){this._listener=ca.listen(this._threadID,this.updateView.bind(this));ha.addSubscriptions(this._listener);}ra&&ea.getThreadMeta(ra,function(sa){if(this._threadID==ra)l.conditionClass(this._rootElement,'isMultichat',!sa.is_canonical&&ea.canReply(ra));}.bind(this));},_renderHeaderBar:function(){this._headerBar=ba[':fb:web-messenger:read-view:header'].build();m.appendContent(this._rootElement,this._headerBar.getRoot());var ra=this._headerBar.getNode('editThreadName'),sa=this._headerBar.getNode('addPeopleToThread'),ta=new n();this._title_node_wrapper=this._headerBar.getNode('headerName');this._relationship_status=this._headerBar.getNode('relationshipStatus');ha.addSubscriptions(h.listen(this._headerBar.getNode('closeButton'),'click',function(){var ua=ia(z.getCurrentStateData(),{all_people_query:undefined});z.updateDetailState(y.DETAIL.COMPOSE_MAIN,ua);}),h.listen(ra,'click',function(event){this._threadID&&ta.toggleShown(this._headerBar.getNode('headerName'),this._threadID);return true;}.bind(this)),h.listen(sa,'click',function(event){this._threadID&&i.show(this._threadID);return true;}.bind(this)),ga.subscribe(ga.DETAIL_DOM_CHANGED,this.updateHeaderBar.bind(this)));},updateHeaderBar:function(){var ra=this._headerBar.getNode('headerButtons');this._title_node_wrapper.style.fontSize='';var sa=g.div(null);m.setContent(this._title_node_wrapper,sa);var ta=z.getCurrentDetailState(),ua=ta==y.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS;l.conditionShow(this._headerBar.getNode('closeButton'),ua);l.conditionClass(this._title_node_wrapper,'allPeopleResults',ua);l.hide(this._relationship_status);l.removeClass(this._title_node_wrapper,"_50jz");var va,wa;switch(ta){case y.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS:wa=z.getCurrentStateData().all_people_query;va=m.tx._("People matching {query}",{query:m.create('strong',{},wa)});break;case y.DETAIL.COMPOSE_MAIN:case y.DETAIL.COMPOSE_TYPEAHEAD_RESULTS:va="New message";break;case y.DETAIL.SEARCH_SNIPPET:wa=z.getCurrentStateData().message_query;if(wa)va=la._("Messages with word: {query}",{query:wa});break;}var xa=!va&&!this._threadID;if(xa)va="No Selection";l.conditionClass(this._title_node_wrapper,"_3jd",xa);if(va){m.setContent(sa,va);qa(this._title_node_wrapper,this._threadID,ra);return;}da.renderAndSeparatedParticipantList(this._threadID,sa,{check_length:false,names_renderer:function(ya){var za=ya.map(function(bb){var cb=ya.length===1?bb.name:bb.short_name,db=v.getUserID(bb.id);if(db&&bb.href){var eb=m.create('a',{href:bb.href},cb);if(ya.length===1)eb.setAttribute('data-hovercard',o.constructEndpoint({id:db}));return eb;}else return cb;});if(ya.length===1&&ya[0].fbid!==null){var ab=m.create('span');m.setContent(ab,za[0]);na(ya[0],ab);za[0]=ab;}return za;}.bind(this)});if(t.SocialContextGK)this.renderRelationshipStatusIndicator();this.renderParticipantListFlyout(sa);this.renderNamedThreadParticipantCount(sa);qa(this._title_node_wrapper,this._threadID,ra);new j(this._title_node_wrapper,{min:11,max:16,height:100,width:this._title_node_wrapper.offsetWidth,wrap:false});},renderNamedThreadParticipantCount:function(ra){ea.getThreadMeta(this._threadID,function(sa){if(sa.name){var ta=da.renderParticipantCount(sa.thread_id,{count:sa.participants.length-1}),ua=m.create('span',{className:"_1us"},la._("{participants}",{participants:ta}));m.appendContent(ra,ua);}},s.WEBMESSENGER);},renderRelationshipStatusIndicator:function(){var ra=this._relationship_status,sa=this._title_node_wrapper,ta=this._threadID;ea.getThreadMeta(this._threadID,function(ua){var va=ua.participants.filter(function(wa){return wa!==v.user;});if(va.length>1)return;v.getMulti(va,function(wa){if(this._threadID!=ta)return;var xa=va.map(function(za){return wa[za];}),ya=xa[0];if(ya&&!ya.is_friend&&(ya.type===u.USER||ya.type===u.FRIEND)){m.setContent(ra,pa(ya));l.show(ra);l.addClass(sa,"_50jz");}}.bind(this));}.bind(this),s.WEBMESSENGER);},renderParticipantListFlyout:function(ra){this._dialog&&this._dialog.destroy();delete this._dialog;this._flyout&&this._flyout.destroy();delete this._flyout;var sa=this._threadID;ea.getThreadMeta(this._threadID,function(ta){var ua=ta.participants.filter(function(va){return va!==v.user;});if(ua.length<=1)return;v.getMulti(ua,function(va){if(this._threadID!=sa)return;var wa=0,xa=ba[':fb:web-messenger:flyoutlist'].build();for(var ya in va){var za=va[ya],ab=ba[':fb:web-messenger:flyoutlist-profile-item'].build();ab.getNode('profilePhoto').setAttribute('src',za.image_src);var bb=ab.getNode('title');if(za.href){var cb=m.create('a',{href:za.href});m.setContent(bb,cb);bb=cb;var db=ab.getNode('profilePhoto'),eb=m.create('a',{href:za.href});m.replace(db,eb);m.setContent(eb,db);}m.setContent(bb,za.name);na(za,ab.getNode('title'));m.setContent(ab.getNode('infoLine'),pa(za));wa++;m.appendContent(xa.getNode('list'),ab.getRoot());}var fb=xa.getRoot();this._dialog=new k({context:ra,position:'below',addedBehaviors:[q,r]},fb);this._flyout=new p();this._flyout.init(this._dialog);this._flyout.initNode(ra);oa(this._flyout,fb,wa);}.bind(this));}.bind(this),s.WEBMESSENGER);},destroy:function(){}});function na(ra,sa){var ta=v.getUserID(ra.id),ua=m.create('span');if(ta){w.updateOnPresenceChanges(ta,ua);if(m.isNode(sa))m.appendContent(sa,ua);}return ua;}function oa(ra,sa,ta){if(ta<=fa.MAX_VISIBLE_IN_FLYOUT)return;var ua=x.fromNative(sa,{fade:true});sa.style.height=fa.PARTICIPANTS_FLYOUT_HEIGHT+'px';ra.subscribe('show',function(){ua.showScrollbar(false);});}function pa(ra){var sa=ra.social_snippets||{},ta=Object.keys(sa);if(ta.length>0){var ua=ta.slice(0,1).map(function(za){return sa[za];});return ua;}var va=ra.networks||{},wa=Object.keys(va),xa=wa.length>0,ya=2;if(xa){var ua=wa.slice(0,ya).map(function(za){return va[za];});return ua.join(' \u00b7 ');}return '';}function qa(ra,sa,ta){var ua=ta.offsetWidth,va=m.scry(document.body,"div._2nd");if(va.length)ua+=va[0].offsetWidth;var wa=ra.parentNode.offsetWidth;if(wa>ua)aa.set(ra,'max-width',(wa-ua)+'px');}e.exports=ma;});
__d("WebMessengerFlexibleArea",["Event","ArbiterMixin","CSS","cx","DOM","Style","throttle","Vector","copyProperties","createArrayFrom"],function(a,b,c,d,e,f){var g=b('Event'),h=b('ArbiterMixin'),i=b('CSS'),j=b('cx'),k=b('DOM'),l=b('Style'),m=b('throttle'),n=b('Vector'),o=b('copyProperties'),p=b('createArrayFrom'),q=[];function r(){q.forEach(function(t){t.draw();});}g.listen(window,'resize',m(r,50));function s(t){this.minFlexAreaHeight=0;this.flexArea=t;this.container=null;this.padding=0;this.sizeToFit=false;q.push(this);}o(s.prototype,h,{setContainer:function(t){this.container=t;return this;},setPadding:function(t){this.padding=t;return this;},setMinFlexAreaHeight:function(t){this.minFlexAreaHeight=t;return this;},setSizeToFit:function(t){this.sizeToFit=t;return this;},draw:function(){if(this.flexArea){var t=this._flexHeight;this.inform('predraw',{old_height:t});var u=n.getViewportDimensions().y-this.padding;u-=n.getElementPosition(this.container||this.flexArea).y;if(this.container){p(this.container.childNodes).forEach(function(v){u-=n.getElementDimensions(v).y;});u+=n.getElementDimensions(this.flexArea).y;}if(this.sizeToFit)u=Math.min(u,this._getNaturalHeight());if(u<this.minFlexAreaHeight)u=this.minFlexAreaHeight;if(isNaN(u)||u<0)u=0;if(u!==t){l.set(this.flexArea,'height',u+'px');this._flexHeight=u;this.inform('height_changed',{height:u,old_height:t});}}return this;},destroy:function(){var t=q.indexOf(this);t>=0&&q.splice(t,1);r();},_getNaturalHeight:function(){var t=this.flexArea.cloneNode(true);i.addClass(t,"_2ys");l.set(t,'height','auto');k.insertAfter(this.flexArea,t);var u=n.getElementDimensions(t).y;k.remove(t);return u;},_getFlexHeight:function(){if(isNaN(this._flexHeight))this._flexHeight=n.getElementDimensions(this.flexArea).y;return this._flexHeight;}});e.exports=s;});
__d("WebMessengerFlexibleScrollArea",["Class","CSS","DOMQuery","ScrollableArea","Style","WebMessengerFlexibleArea","copyProperties","emptyFunction","throttle"],function(a,b,c,d,e,f){var g=b('Class'),h=b('CSS'),i=b('DOMQuery'),j=b('ScrollableArea'),k=b('Style'),l=b('WebMessengerFlexibleArea'),m=b('copyProperties'),n=b('emptyFunction'),o=b('throttle');function p(q,r){this._scroll=j.fromNative(q,r);this.parent.construct(this,q);this._scrollBody=i.find(this.flexArea,'.uiScrollableAreaBody');var s=i.scry(this.flexArea,'.uiScrollableAreaShadow');this._shadow=s.length?s[0]:null;this._scrollContent=i.find(this.flexArea,'.uiScrollableAreaContent');this._scrollCallback=n;this._drawSubscription=this.subscribe('height_changed',this.poke.bind(this));this._scrollSub=this._scroll.subscribe('scroll',o(this._onScroll,50,this));}g.extend(p,l);m(p.prototype,{setBottomAligned:function(q){var r=q!==false;if(this._bottomEdgeBias===r)return;h.conditionClass(this.flexArea,'uiScrollableAreaBottomAligned',r);this._bottomEdgeBias=r;if(this._bottomEdgeBias){this.scrollToBottom(false);}else this.scrollToTop(false);this.poke.bind(this).defer();return this;},setInfiniteScrollHandler:function(q,r){if(r){this._infiniteUpwardScrollHandler=q;}else this._infiniteDownScrollHandler=q;return this;},setScrollCallback:function(q){this._scrollCallback=q;return this;},setTabbable:function(q){this._scroll._wrap.setAttribute('tabindex',q?'0':'-1');},poke:function(q,r){var s=this._scrollHeight,t=this._scroll.getScrollTop();this._scrollHeight=this._getScrollHeight();if(typeof s=='undefined'||(r&&!r.old_height)){this._bottomEdgeBias&&this._setShadowHeight();return;}var u=this._scrollHeight-s;if(this._bottomEdgeBias){var v=r?r.height-r.old_height:0;clearTimeout(this._pollTimer);this._pollTimer=this.poke.bind(this).defer(200);var w,x=u-v;if(this._scrollHeight>this._getFlexHeight()){w=t+x;w=w<0?0:w;}else w=0;x>0&&this._setShadowHeight();if(w!==t)this._scroll.setScrollTop(w,false);x<0&&this._setShadowHeight();}else if(u)this._scroll.setScrollTop(t,false);},setScrollTop:function(q,r){this._scroll.setScrollTop(q,r);},getScrollableArea:function(){return this._scroll;},isScrolledToBottom:function(){return this._scroll.isScrolledToBottom();},scrollToBottom:function(q){this._scroll.scrollToBottom(q);if(this._bottomEdgeBias)this._scrollBottom=0;},isScrolledToTop:function(){return this._scroll.getScrollTop()===0;},scrollToTop:function(q){this._scroll.scrollToTop(q);},scrollIntoView:function(q,r){this._scroll.scrollIntoView(q,r);},destroy:function(){this._scrollSub&&this._scrollSub.unsubscribe();this.unsubscribe(this._drawSubscription);clearTimeout(this._pollTimer);this.parent.destroy();this._scroll.destroy();},_getScrollHeight:function(){if(this._bottomEdgeBias){return this._scrollContent.offsetHeight;}else return this._scroll.getScrollHeight();},_setShadowHeight:function(){var q=this._shadowHeight;this._shadowHeight=this._scrollHeight-this._getFlexHeight();if(this._shadowHeight<0)this._shadowHeight=0;if(this._shadowHeight!==q)k.set(this._shadow,'height',this._shadowHeight+'px');},_onScroll:function(){var q=this._scroll.getScrollTop(),r=this._getScrollHeight();if(q<this._getFlexHeight())this._infiniteUpwardScrollHandler&&this._infiniteUpwardScrollHandler();if(q+2*this._getFlexHeight()>r)this._infiniteDownScrollHandler&&this._infiniteDownScrollHandler();this._scrollCallback(this._scroll);}});e.exports=p;});
__d("WebMessengerDeleteThreadDialog",["Dialog","tx","MercuryThreads"],function(a,b,c,d,e,f){var g=b('Dialog'),h=b('tx'),i=b('MercuryThreads').get(),j={show:function(k){var l=[];l.push({name:'delete_conversation',label:"Delete Conversation",handler:i.deleteThread.bind(i,k)});l.push(g.CANCEL);new g().setTitle("Delete This Entire Conversation?").setBody("Once you delete your copy of this conversation, it cannot be undone.").setButtons(l).show();}};e.exports=j;});
__d("WebMessengerActionsMenuItem",["Event","CSS","WebMessengerStateManager","WebMessengerTemplates","copyProperties"],function(a,b,c,d,e,f){var g=b('Event'),h=b('CSS'),i=b('WebMessengerStateManager'),j=b('WebMessengerTemplates'),k=b('copyProperties');function l(m,n,o){var p=j[':fb:web-messenger:actions-menu-item'].build();p.setNodeContent('title',m);this.node=p.getRoot();this.showFn=o;g.listen(this.node,'click',function(){var q=i.getCurrentStateData().thread_id;q&&n(q);});}k(l.prototype,{getNode:function(){return this.node;},updateShown:function(m){var n=this.showFn?this.showFn(m):true;h.conditionShow(this.node,n);return n;}});e.exports=l;});
__d("ListInputTargetTracker",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties');function h(){this._index=undefined;this._items=[];}g(h.prototype,{getIndex:function(){return this._index;},setIndex:function(i){this._index=Math.max(0,Math.min(i,this._items.length-1));},getNumItems:function(){return this._items.length;},getItem:function(){if(this._index!==undefined)return this._items[this._index];},setTargetItem:function(i){this.updateIndex(this._items,i);},removeItemAtIndex:function(i){this._items.splice(i,1);},removeItemByValue:function(i){var j=this._items.indexOf(i);this.removeItemAtIndex(j);},moveUp:function(){if(this._index===undefined||this._index===0){if(this._items.length){this._index=this._items.length-1;return true;}}else if(this._index>0){this._index--;return true;}return false;},moveDown:function(){if(this._index===undefined||this._index===this._items.length-1){if(this._items.length){this._index=0;return true;}}else if(this._index<this._items.length-1){this._index++;return true;}return false;},updateIndex:function(i,j){this._items=i||[];if(j){var k=this._items.indexOf(j);if(k>=0){this._index=k;}else if(this._index!==undefined)if(this._items.length>0){this._index=Math.min(this._index,this._items.length-1);}else this._index=undefined;}else this._index=undefined;return this._index;}});e.exports=h;});
__d("WebMessengerShortcuts",["Dialog","DialogX","KeyEventController","LayerHideOnEscape","ListInputTargetTracker","MercuryAPIArgsSource","MessagingTag","Parent","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","MercuryThreads","UserAgent","WebMessengerEvents","arrayContains","cx","ge","tx"],function(a,b,c,d,e,f){var g=b('Dialog'),h=b('DialogX'),i=b('KeyEventController'),j=b('LayerHideOnEscape'),k=b('ListInputTargetTracker'),l=b('MercuryAPIArgsSource'),m=b('MessagingTag'),n=b('Parent'),o=b('WebMessengerStateConstants'),p=b('WebMessengerStateManager'),q=b('WebMessengerTemplates'),r=b('MercuryThreads').get(),s=b('UserAgent'),t=b('WebMessengerEvents'),u=b('arrayContains'),v=b('cx'),w=b('ge'),x=b('tx'),y=null,z=null,aa={c:{callback:ea,description:"Start a new message",section:'navigation',uses_meta:true},g:{callback:fa,description:"Search conversations",section:'searchAndHelp',uses_meta:true},i:{callback:na.curry(m.INBOX),description:"Go to Inbox",section:'navigation',uses_meta:true},u:{callback:na.curry(m.OTHER),description:"Go to Other",section:'navigation',uses_meta:true},DELETE:{callback:ha,description:"Archive\/unarchive conversation",otherKeys:['BACKSPACE'],keyName:"Delete",section:'conversation',uses_meta:true},r:{callback:ia,description:"Mark message as read\/unread",section:'conversation',uses_meta:true},UP:{callback:ja,description:"Select next conversation",section:'navigation',uses_meta:false},DOWN:{callback:ka,description:"Select previous conversation",section:'navigation',uses_meta:false},q:{callback:pa,description:"Show\/hide keyboard shortcuts",section:'searchAndHelp',uses_meta:true},j:{callback:qa,description:"Mark as spam",section:'conversation',uses_meta:true}},ba={registerGeneralShortcuts:function(){z=new k();for(var ra in aa){var sa=aa[ra],ta=sa.otherKeys||[];ta.push(ra);for(var ua=0;ua<ta.length;ua++)i.registerKey(ta[ua],sa.callback,da.curry(sa.uses_meta));}},updateThreadlistIndex:function(ra,sa,ta){y=ra;if(z){if(!u(sa,ta))ta=null;z.updateIndex(sa,ta);}},openSearchThread:function(){var ra=ma(),sa=p.getCurrentMasterState();if(ra&&sa==o.MASTER.SEARCH)y.openSearchThread(ra);},showOrHideShortcuts:pa};function ca(){return s.osx()?'CTRL':'ALT';}function da(ra,event,sa){if(!i.filterEventTypes(event,sa))return false;var ta=event.getTarget();if(!n.byClass(ta,"_ksg"))return false;var ua;if(ra)switch(ca()){case 'CTRL':ua='ctrlKey';break;case 'ALT':ua='altKey';break;}var va=['ctrlKey','metaKey','altKey','shiftKey'];for(var wa=0;wa<va.length;wa++)if(va[wa]!==ua&&event[va[wa]])return false;return !ra||event[ua];}function ea(){p.updateDetailState(o.DETAIL.COMPOSE_MAIN,{start:true});return false;}function fa(){t.focusAndSelectSearch();return false;}function ga(ra){var sa;if(z.getNumItems()>1){var ta=z.getIndex();z.setIndex(ta===0?1:ta-1);sa=ma();}ra();p.updateDetailState(o.DETAIL.RECENT_MESSAGES,{folder:p.getCurrentStateData().folder,thread_id:sa});if(sa)y._manager.scrollIntoView(w(z.getItem()),false);}function ha(){var ra=ma();if(ra){r.getThreadMeta(ra,function(sa){if(sa.folder==m.SPAM)return;ga(function(){r.changeThreadArchivedStatus(sa.thread_id,!sa.is_archived);});},l.WEBMESSENGER);return false;}}function ia(){var ra=ma();if(ra){r.getThreadMeta(ra,function(sa){var ta=!sa.unread_count;r.changeThreadReadStatus(ra,!ta);},l.WEBMESSENGER);return false;}}function ja(){if(z)if(z.getIndex()===0){switch(p.getCurrentMasterState()){case o.MASTER.SEARCH:z.moveUp();la();y._manager.scrollToBottom(false);break;default:y._manager.scrollToTop(false);t.focusSearch();}}else{if(z.getItem()){z.moveUp();}else z.moveDown();la();}return false;}function ka(){var ra=p.getCurrentMasterState();if(z&&(ra!==o.MASTER.RECENT_THREADS||z.getIndex()<z.getNumItems()-1)){z.moveDown();la();}return false;}function la(){var ra=ma();if(ra){var sa=p.getCurrentMasterState();if(sa==o.MASTER.SEARCH){y.updateKeyboardSelection(ra);t.focusSearch();}else p.updateDetailState(o.DETAIL.RECENT_MESSAGES,{thread_id:ra});if(z)if(z.getIndex()===0){y._manager.scrollToTop(false);}else y._manager.scrollIntoView(w(z.getItem()),false);}}function ma(){var ra=z&&z.getItem();if(typeof ra==='string'&&ra.indexOf(':')!==-1)return ra.substr(ra.indexOf(':')+1);return null;}function na(ra){var sa=p.getCurrentMasterState(),ta=sa==o.MASTER.SEARCH?null:p.getCurrentStateData().thread_id;p.updateMasterState(o.MASTER.RECENT_THREADS,{thread_id:ta,folder:ra});}var oa;function pa(){if(!oa){var ra={};for(var sa in aa){var ta=aa[sa];if(!ta.uses_meta)continue;var ua=q[':fb:web-messenger:shortcuts-dialog:row'].build();ua.setNodeContent('meta',ca());if(ta.keyName){ua.setNodeContent('key',ta.keyName);}else ua.setNodeContent('key',sa);ua.setNodeContent('description',ta.description);if(!ra[ta.section])ra[ta.section]=[];ra[ta.section].push(ua.getRoot());}var va=q[':fb:web-messenger:shortcuts-dialog'].build();for(var wa in ra)va.setNodeContent(wa,ra[wa]);oa=new h({modal:true,width:g.SIZE.WIDE},va.getRoot());oa.enableBehavior(j);}if(oa.isShown()){oa.hide();}else oa.show();return false;}function qa(){var ra=ma();if(ra){r.getThreadMeta(ra,function(sa){if(sa.folder==m.SPAM)return;ga(r.markThreadSpam.bind(r,ra));},l.WEBMESSENGER);return false;}}e.exports=ba;});
__d("WebMessengerDetailViewActionsMenuControl",["Event","WebMessengerAddPeopleToConversationDialog","WebMessengerDeleteThreadDialog","Arbiter","AsyncDialog","AsyncRequest","MercuryChatUtils","MercuryConfig","CSS","Dialog","DOM","Input","Keys","WebMessengerActionsMenuItem","MercuryAPIArgsSource","MercuryLogMessageType","MercurySourceType","MercuryThreadMuter","MercuryMessages","MessagingTag","MercuryParticipants","MercuryServerRequests","WebMessengerShortcuts","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","MercuryThreadInformer","MercuryThreads","Toggler","URI","WebMessengerSubscriptionsHandler","copyProperties","goURI","tx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('WebMessengerAddPeopleToConversationDialog'),i=b('WebMessengerDeleteThreadDialog'),j=b('Arbiter'),k=b('AsyncDialog'),l=b('AsyncRequest'),m=b('MercuryChatUtils'),n=b('MercuryConfig'),o=b('CSS'),p=b('Dialog'),q=b('DOM'),r=b('Input'),s=b('Keys'),t=b('WebMessengerActionsMenuItem'),u=b('MercuryAPIArgsSource'),v=b('MercuryLogMessageType'),w=b('MercurySourceType'),x=b('MercuryThreadMuter'),y=b('MercuryMessages').get(),z=b('MessagingTag'),aa=b('MercuryParticipants'),ba=b('MercuryServerRequests').get(),ca=b('WebMessengerShortcuts'),da=b('WebMessengerStateConstants'),ea=b('WebMessengerStateManager'),fa=b('WebMessengerTemplates'),ga=b('MercuryThreadInformer').get(),ha=b('MercuryThreads').get(),ia=b('Toggler'),ja=b('URI'),ka=b('WebMessengerSubscriptionsHandler'),la=b('copyProperties'),ma=b('goURI'),na=b('tx');function oa(){this.node=fa[':ui:menu:separator'].render();}oa.prototype.getNode=function(){return this.node;};function pa(yb){this._rootElement=yb;this._menuTemplate=fa[':fb:web-messenger:actions-menu'].build();this._newMessageButton=this._menuTemplate.getNode('newMessageButton').parentNode;this._actionsMenu=this._menuTemplate.getNode('menu');this._searchThreadInput=this._menuTemplate.getNode('searchThreadInput');this._searchThreadButton=this._menuTemplate.getNode('searchThreadButton').parentNode;this._searchCloseButton=this._menuTemplate.getNode('searchCloseButton').parentNode;ka.addSubscriptions(ga.subscribe('threads-updated',function(zb,ac){ac[this._threadID]&&this.updateView();}.bind(this)),g.listen(this._menuTemplate.getNode('newMessageButton'),'click',function(){ea.updateDetailState(da.DETAIL.COMPOSE_MAIN,la(ea.getCurrentStateData(),{start:true,thread_id:undefined}));}),g.listen(this._searchThreadButton,'mousedown',function(event){if(!this._searchMode){ra(this,true);}else{var zb=r.getValue(this._searchThreadInput);if(zb){var ac=la({},ea.getCurrentStateData());la(ac,{message_query:zb});ea.updateDetailState(da.DETAIL.SEARCH_THREAD_SNIPPET,ac);}else ra(this,false);}event.kill();return false;}.bind(this)),g.listen(this._searchCloseButton,'click',function(){ra(this,false);var zb=ea.getCurrentDetailState();if(zb!==da.DETAIL.RECENT_MESSAGES)ea.updateDetailState(da.DETAIL.RECENT_MESSAGES,{thread_id:ea.getCurrentStateData().thread_id});}.bind(this)),g.listen(this._searchThreadInput,'blur',function(event){var zb=r.getValue(this._searchThreadInput);if(!zb)ra(this,false);}.bind(this)),g.listen(this._searchThreadInput,'keyup',function(event){var zb=r.getValue(this._searchThreadInput),ac=la({},ea.getCurrentStateData());la(ac,{message_query:zb});if(event.keyCode==s.RETURN&&zb)ea.updateDetailState(da.DETAIL.SEARCH_THREAD_SNIPPET,ac);if(event.keyCode==s.ESC)r.reset(this._searchThreadInput);}.bind(this)));this.initItems();q.setContent(this._rootElement,this._menuTemplate.getRoot());}la(pa.prototype,{initItems:function(){this.menuItems=[new t("Mark as read",sb,fb),new t("Mark as unread",rb,cb(fb)),new t("Open in Chat",xa,m.canOpenChatTab),new t("Create Group...",qb,ab),new oa(),new t("Forward Messages...",ub),new t("Delete Messages...",tb),new oa(),new t("Add People...",kb,wa),new t("Leave Conversation...",lb,wa),new t("Delete Conversation...",bb),new t("Mute Conversation...",sa.curry(-1),ua),new t("Unmute Conversation...",sa.curry(0),ta),new t("Move to Inbox",za.curry(z.INBOX),ya.curry(z.OTHER)),new t("Move to Other",za.curry(z.OTHER),ya.curry(z.INBOX)),new t("Archive",nb,cb(eb)),new t("Unarchive",ob,eb),new t("Report Spam or Abuse...",hb,cb(db)),new t("Not Spam",jb,db)];if(va())this.menuItems=this.menuItems.concat([new oa(),new t('Enable bug reporting',vb,cb(gb)),new t('Disable bug reporting',wb,gb)]);this.menuItems=this.menuItems.concat([new oa(),new t("Keyboard Shortcuts",ca.showOrHideShortcuts.bind(ca)),new t("Feedback",ma.curry('/help/?page=134259426717336'))]);var yb=this.menuItems.map(function(ac){return ac.getNode();}),zb=q.find(this._menuTemplate.getRoot(),'.uiMenuInner');q.setContent(zb,yb);},hideView:function(){o.hide(this._rootElement);},updateView:function(){this.hideView();var yb=ea.getCurrentDetailState(),zb=false,ac=false,bc=false,cc=false,dc=false,ec=false;switch(yb){case da.DETAIL.COMPOSE_MAIN:case da.DETAIL.COMPOSE_TYPEAHEAD_RESULTS:case da.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS:qa(this);this._threadID=null;break;case da.DETAIL.RECENT_MESSAGES:case da.DETAIL.SEARCH_CONTEXT:if(this._state!==yb)qa(this);var fc=ea.getCurrentStateData().thread_id;zb=true;if(this._searchMode&&this._threadID===fc){cc=true;}else{qa(this);ac=true;bc=true;}this._threadID=fc;if(n.WebMessengerThreadSearchGK&&this._threadID)dc=true;break;case da.DETAIL.SEARCH_THREAD_SNIPPET:var gc=ea.getCurrentStateData();r.setValue(this._searchThreadInput,gc.message_query);this._threadID=gc.thread_id;zb=true;cc=true;ec=true;break;default:qa(this);zb=true;ac=true;this._threadID=null;break;}this._state=yb;o.conditionShow(this._searchThreadInput,cc);o.conditionShow(this._searchThreadButton,dc);o.conditionShow(this._searchCloseButton,ec);o.conditionShow(this._newMessageButton,ac);o.conditionShow(this._rootElement,zb);this._threadSubscription&&ha.unsubscribe(this._threadSubscription);if(bc&&this._threadID){this._threadSubscription=ha.getThreadMeta(this._threadID,function(hc){var ic=null,jc=false;this.menuItems.forEach(function(kc){if(kc instanceof t){jc|=kc.updateShown(hc);}else if(kc instanceof oa){o.conditionShow(kc.getNode(),jc);if(jc){ic=kc;jc=false;}}});if(!jc&&ic)o.hide(ic.getNode());o.show(this._menuTemplate.getNode('menu'));o.show(this._rootElement);}.bind(this),u.WEBMESSENGER);}else o.hide(this._menuTemplate.getNode('menu'));},destroy:function(){}});function qa(yb){yb._searchMode=false;r.reset(yb._searchThreadInput);}function ra(yb,zb){if(zb){yb._searchMode=true;}else qa(yb);o.conditionShow(yb._newMessageButton,!zb);o.conditionShow(yb._actionsMenu,!zb);o.conditionShow(yb._searchThreadInput,zb);if(zb)yb._searchThreadInput.focus();}function sa(yb,zb){x.showMuteChangeDialog(yb,zb);}function ta(yb){return n.MuteThreadsOnDesktopGK&&x.isThreadMuted(yb);}function ua(yb){return n.MuteThreadsOnDesktopGK&&!x.isThreadMuted(yb);}function va(){var yb=aa.getNow(aa.user);return yb&&yb.employee;}function wa(yb){return !yb.is_canonical&&yb.is_subscribed;}function xa(yb){j.inform('chat/open-tab',{thread_id:yb});}function ya(yb,zb){return !zb.is_archived&&zb.folder==yb;}function za(yb,zb){ha.changeFolder(zb,yb);xb();}function ab(yb){var zb=pb(yb.participants);return zb.length>2;}function bb(yb){i.show(yb);}function cb(yb){return function(){return !yb.apply(this,arguments);};}function db(yb){return yb.folder===z.SPAM;}function eb(yb){return yb.is_archived;}function fb(yb){return yb.unread_count>0;}function gb(){return ea.getCurrentStateData().bug_reporting_enabled;}function hb(yb){var zb=ha.getThreadMetaNow(yb),ac;if(zb&&zb.message_count==1){ac=fa[':fb:web-messenger:report-dialog-single-message'].build();}else ac=fa[':fb:web-messenger:report-dialog'].build();var bc=ac.getRoot(),cc=[p.OK,p.CANCEL];new p().setTitle("Report Spam or Abuse").setBody(bc).setButtons(cc).setHandler(ib.curry(yb,bc)).show();}function ib(yb,zb){var ac=q.find(zb,'.markSpam'),bc=q.scry(zb,'.markSpamMessages')[0];if(ac.checked){ha.markThreadSpam(yb);xb();}else if(bc&&bc.checked){var cc=la({},ea.getCurrentStateData());la(cc,{message_action:da.MESSAGE_ACTION.REPORT_SPAM});ea.updateDetailState(ea.getCurrentDetailState(),cc);}else{var dc=q.find(zb,'.reportUsers');if(dc.checked){ba.getServerThreadID(yb,function(ec){p.bootstrap('/ajax/messaging/report/',{tid:ec});});}else return false;}}function jb(yb){ha.unmarkThreadSpam(yb);xb();}function kb(yb){h.show(yb);}function lb(yb){var zb=[];zb.push({name:'unsubscribe',label:"Leave Conversation",handler:mb.bind(null,yb)});zb.push(p.CANCEL);new p().setTitle("Leave conversation?").setBody("You will stop receiving messages from this conversation and people will see that you left.").setButtons(zb).show();}function mb(yb){y.sendMessage(y.constructLogMessageObject(w.TITAN_WEB,yb,v.UNSUBSCRIBE,{}),null,u.WEBMESSENGER);return true;}function nb(yb){ha.changeThreadArchivedStatus(yb,true);xb();}function ob(yb){ha.changeThreadArchivedStatus(yb,false);xb();}function pb(yb){var zb=[];for(var ac=0;ac<yb.length;ac++){var bc=yb[ac];if(/^fbid:\d+$/.test(bc))zb.push(bc.substr(5));}return zb;}function qb(yb){ha.getThreadMeta(yb,function(zb){var ac=pb(zb.participants),bc=ja('/ajax/groups/create_get.php').addQueryData({ref:'web_messenger',members:ac,parent_id:'0'});k.send(new l(bc));},u.WEBMESSENGER);}function rb(yb){ha.changeThreadReadStatus(yb,false);ia.hide();}function sb(yb){ha.changeThreadReadStatus(yb,true);ia.hide();}function tb(){var yb=la({},ea.getCurrentStateData());la(yb,{message_action:da.MESSAGE_ACTION.DELETE});ea.updateDetailState(ea.getCurrentDetailState(),yb);}function ub(){var yb=la({},ea.getCurrentStateData());la(yb,{message_action:da.MESSAGE_ACTION.FORWARD});ea.updateDetailState(ea.getCurrentDetailState(),yb);}function vb(){var yb=la({},ea.getCurrentStateData());yb.bug_reporting_enabled=true;ia.hide();ea.updateDetailState(ea.getCurrentDetailState(),yb);}function wb(){var yb=la({},ea.getCurrentStateData());yb.bug_reporting_enabled=false;ia.hide();ea.updateDetailState(ea.getCurrentDetailState(),yb);}function xb(){ea.updateDetailState(da.DETAIL.RECENT_MESSAGES,{folder:ea.getCurrentStateData().folder});}e.exports=pa;});
__d("ExpandableDataSource",["Class","copyProperties","DataSource"],function(a,b,c,d,e,f){var g=b('Class'),h=b('copyProperties'),i=b('DataSource');function j(k,l,m){this._initialLimit=l;this._moreResultsLimit=m;this._states={};k=k||{};k.maxResults=this._initialLimit;this.parent.construct(this,k);}g.extend(j,i);h(j.prototype,{query:function(k,l,m){this.setQueryData({offset:0,limit:this._initialLimit});this.parent.query(k,l,m);},fetchHandler:function(k,l){var m=k.getPayload(),n=l.value;this.getState('is_loading_more_per_query')[this.value]=false;this.getState('total_results_count_per_query')[this.value]=m.total_count;this.parent.fetchHandler(k,l);},loadMore:function(){if(this.value&&!this.hasLoadedAllResults()){var k=this.getState('max_results_per_query');if(!k[this.value])k[this.value]=this._initialLimit;this.setQueryData({offset:k[this.value],limit:this._moreResultsLimit});k[this.value]+=this._moreResultsLimit;if(k[this.value]>this._maxResults)this._maxResults=k[this.value];this.getState('is_loading_more_per_query')[this.value]=true;this.fetch(this.queryEndpoint,this.getQueryData(this.value,this.buildUids(this.value)),{value:this.value});}},isLoadingMore:function(){return this.getState('is_loading_more_per_query')[this.value];},hasLoadedAllResults:function(){var k=this.getState('total_results_count_per_query')[this.value],l=(this.buildQueryResults(this.value)||[]).length;return k&&l>=k;},getStates:function(){return this._states;},getState:function(k){var l=this.getStates();if(!l[k])l[k]={};return l[k];},getQueryCache:function(){return this.getState('query_cache');}});e.exports=j;});
__d("WebMessengerDetailViewAllPeopleResultsControl",["Event","CSS","DataStore","DOM","ExpandableDataSource","MercuryIDs","Parent","WebMessengerStateConstants","WebMessengerStateManager","Token","WebMessengerEvents","cx","WebMessengerSubscriptionsHandler","copyProperties","WebMessengerTemplates"],function(a,b,c,d,e,f){var g=b('Event'),h=b('CSS'),i=b('DataStore'),j=b('DOM'),k=b('ExpandableDataSource'),l=b('MercuryIDs'),m=b('Parent'),n=b('WebMessengerStateConstants'),o=b('WebMessengerStateManager'),p=b('Token'),q=b('WebMessengerEvents'),r=b('cx'),s=b('WebMessengerSubscriptionsHandler'),t=b('copyProperties'),u=b('WebMessengerTemplates'),v=5,w=5,x=function(ca){this._rootElement=ca;j.empty(this._rootElement);var da=u[':fb:web-messenger:all-people-results'].build();j.setContent(this._rootElement,da.getRoot());this._loadingSpinner=da.getNode('loadingSpinner');this._peopleResults=da.getNode('results');this._loadMoreButton=da.getNode('loadMoreButton');this._loadMoreLink=da.getNode('loadMoreLink');s.addSubscriptions(g.listen(this._loadMoreLink,'click',function(){h.addClass(this._loadMoreButton,'async_saving');this._peopleDataSource&&this._peopleDataSource.loadMore();}.bind(this)));};t(x.prototype,{hideView:function(){h.hide(this._rootElement);},updateView:function(){var ca=o.getCurrentDetailState();if(ca==n.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS){h.show(this._rootElement);y(this);q.detailDOMChanged();}},destroy:function(){}});function y(ca){h.show(ca._loadingSpinner);h.hide(ca._peopleResults);h.hide(ca._loadMoreButton);var da=o.getCurrentStateData(),ea=da.all_people_query||'';z(ca);var fa=(da.participants||[]).map(function(ga){return l.tokenize(ga).value;});ca._peopleDataSource.setExclusions(fa);ca._peopleDataSource.query(ea);}function z(ca){if(!ca._peopleDataSource){ca._peopleDataSource=new k({queryEndpoint:'/ajax/mercury/search_people.php'},v,w);ca._peopleDataSource.init();s.addSubscriptions(ca._peopleDataSource.subscribe('respond',aa.curry(ca)),g.listen(ca._rootElement,'click',function(event){var da=event.getTarget().parentNode;if(h.hasClass(da,"_4wt"))ba(event.getTarget(),ca._peopleDataSource);}));}}function aa(ca,da,ea){var fa=o.getCurrentDetailState(),ga=o.getCurrentStateData();if(fa==n.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS&&ga.all_people_query==ea.value){j.empty(ca._peopleResults);h.show(ca._peopleResults);ea.results.forEach(function(ha){var ia=j.create('div',{className:'personResult'},ha.detail_markup);i.set(ia,'uid',ha.uid);j.appendContent(ca._peopleResults,ia);});if(ea.results.length){h.hide(ca._loadingSpinner);h.conditionShow(ca._loadMoreButton,!ca._peopleDataSource.hasLoadedAllResults());h.conditionClass(ca._loadMoreButton,'async_saving',ca._peopleDataSource.isLoadingMore());}}}function ba(ca,da){var ea=m.byClass(ca,'personResult'),fa=da.getEntry(i.get(ea,'uid')),ga=t(o.getCurrentStateData(),{new_tokens:[new p(fa)],start:false});o.updateDetailState(n.DETAIL.COMPOSE_MAIN,ga);}e.exports=x;});
__d("WebMessengerComposerTypeaheadView",["BucketedTypeaheadView","Class","MercuryConstants","CSS","DataStore","WebMessengerStateConstants","WebMessengerStateManager","copyProperties","cx","tx"],function(a,b,c,d,e,f){var g=b('BucketedTypeaheadView'),h=b('Class'),i=b('MercuryConstants'),j=b('CSS'),k=b('DataStore'),l=b('WebMessengerStateConstants'),m=b('WebMessengerStateManager'),n=b('copyProperties'),o=b('cx'),p=b('tx');function q(u,v){this.parent.construct(this,u,v);var w=i.MercuryTypeaheadConstants;this.typeObjects={};this.typeObjects[w.FRIEND_TYPE]={disabled:true,uid:w.FRIEND_TYPE,type:w.HEADER_TYPE};this.typeObjects[w.THREAD_TYPE]={uid:w.THREAD_TYPE,text:"Group Conversations",type:w.HEADER_TYPE,linkText:"Show More",getLinkHandler:t.curry(this)};this.typeObjects[w.NON_FRIEND_TYPE]={uid:w.NON_FRIEND_TYPE,text:"Other People",type:w.HEADER_TYPE,linkText:"Show All",getLinkHandler:function(){return function(){s(this.parent,this.value);}.bind(this);}.bind(this)};}h.extend(q,g);n(q.prototype,{setTypeahead:function(u){this.parent.setTypeahead(u);var v=k.get(u,'Typeahead');v.subscribe('loading',function(w,x){var y=v.getData();if(this._threadHeader)j.conditionClass(this._threadHeader,"_355",y.isLoadingMore(this.value));}.bind(this));},setNewHeader:function(u,v){if(v.uid===i.MercuryTypeaheadConstants.THREAD_TYPE)this._threadHeader=u;},mouseover:function(event){if(!r(this,event))this.parent.mouseover(event);},mouseup:function(event){if(!r(this,event))this.parent.mouseup(event);},clearSelected:function(){this.index=-1;this.highlight(-1);}});function r(u,event){var v=u.getIndex(event);return v>=0&&v<u.results.length&&u.results[v].type==i.MercuryTypeaheadConstants.HEADER_TYPE;}function s(u,v){var w=n(m.getCurrentStateData(),{all_people_query:v,start:false});m.updateDetailState(l.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS,w);}function t(u){var v=k.get(u.typeahead,'Typeahead'),w=v.getData();if(w.hasLoadedInitialResults(u.value)&&!w.hasLoadedAllResults(u.value))return w.loadMore.bind(w);}e.exports=q;});
__d("MercuryDataSourceHelper",["MercuryPayloadSource","MercuryServerRequests","MercuryThreadMetadataRawRenderer","MercuryThreadMetadataRenderer","WebMessengerConstants"],function(a,b,c,d,e,f){var g=b('MercuryPayloadSource'),h=b('MercuryServerRequests').get(),i=b('MercuryThreadMetadataRawRenderer'),j=b('MercuryThreadMetadataRenderer').get(),k=b('WebMessengerConstants'),l={updateMercuryOnFetchComplete:function(m){m.subscribe('fetchComplete',function(n,o){var p={participants:[],threads:[],payload_source:g.SERVER_SEARCH};o.response.getPayload().entries.forEach(function(q){if(q.type==k.THREAD_TYPE){p.threads=p.threads.concat(q.mercury_thread);p.participants=p.participants.concat(q.participants_to_render);}});if(p.threads.length){h.handleUpdate(p);o.response.getPayload().entries.forEach(function(q){if(q.mercury_thread)q.text=j.renderThreadNameAndParticipantList(q.mercury_thread.thread_id,q.participants_to_render,q.mercury_thread.participants.length,{last_separator_uses_and:false,names_renderer:i.renderShortNames});});}});}};e.exports=l;});
__d("WebMessengerTypeaheadRenderer",["MercuryConstants","DOM","MercuryAPIArgsSource","MercuryTypeaheadRenderer","MercuryServerRequests","WebMessengerTemplates","MercuryThreadMetadataRawRenderer","MercuryThreadMetadataRenderer","MercuryThreads"],function(a,b,c,d,e,f){var g=b('MercuryConstants'),h=b('DOM'),i=b('MercuryAPIArgsSource'),j=b('MercuryTypeaheadRenderer'),k=b('MercuryServerRequests').get(),l=b('WebMessengerTemplates'),m=b('MercuryThreadMetadataRawRenderer'),n=b('MercuryThreadMetadataRenderer').get(),o=b('MercuryThreads').get();function p(r,s){var t;switch(r.type){case g.MercuryTypeaheadConstants.HEADER_TYPE:t=l[':fb:web-messenger:typeahead-header'].build();j.renderHeader(t,r);if(this.setNewHeader)this.setNewHeader(t.getRoot(),r);break;case g.MercuryTypeaheadConstants.USER_TYPE:t=l[':fb:web-messenger:threadlist-row'].build();j.renderPersonWithBigPhoto(t,r);break;case g.MercuryTypeaheadConstants.THREAD_TYPE:t=l[':fb:web-messenger:threadlist-row'].build();q(t,r);break;default:return h.create('div');}return t.getRoot();}function q(r,s){var t=k.getClientThreadIDNow(s.uid);n.renderParticipantImages(s.participants_to_render,r.getNode('image'));var u=n.renderThreadNameAndParticipantList(t,s.participants_to_render,s.mercury_thread.participants.length,{last_separator_uses_and:false,names_renderer:m.renderShortNames});h.setContent(r.getNode('name'),u);r.getRoot().setAttribute('aria-label',u);o.getThreadMeta(t,function(v){n.renderSnippet(v,r.getNode('snippet'));n.renderTimestamp(r.getNode('timestamp'),v.timestamp_absolute,v.timestamp_relative,v.timestamp);},i.WEBMESSENGER);}e.exports=p;});
__d("WebMessengerDetailViewComposeTypeaheadControl",["Event","WebMessengerComposerTypeaheadView","MercuryConstants","CSS","WebMessengerDataSources","DOM","MercuryFolders","FreeformTokenizerBehavior","Keys","MercuryDataSourceHelper","MercuryParticipantTypes","MercuryTypeahead","MercuryParticipants","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","MercuryThreads","WebMessengerEvents","WebMessengerSubscriptionsHandler","WebMessengerTypeaheadRenderer","copyProperties","tx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('WebMessengerComposerTypeaheadView'),i=b('MercuryConstants'),j=b('CSS'),k=b('WebMessengerDataSources'),l=b('DOM'),m=b('MercuryFolders'),n=b('FreeformTokenizerBehavior'),o=b('Keys'),p=b('MercuryDataSourceHelper'),q=b('MercuryParticipantTypes'),r=b('MercuryTypeahead'),s=b('MercuryParticipants'),t=b('WebMessengerStateConstants'),u=b('WebMessengerStateManager'),v=b('WebMessengerTemplates'),w=b('MercuryThreads').get(),x=b('WebMessengerEvents'),y=b('WebMessengerSubscriptionsHandler'),z=b('WebMessengerTypeaheadRenderer'),aa=b('copyProperties'),ba=b('tx'),ca=function(ga,ha){this._typeaheadRoot=ga;this._resultsRoot=ha;l.empty(this._typeaheadRoot);l.empty(this._resultsRoot);};aa(ca.prototype,{hideView:function(){j.hide(this._typeaheadRoot);j.hide(this._resultsRoot);},updateView:function(){var ga=t;switch(u.getCurrentDetailState()){case ga.DETAIL.COMPOSE_MAIN:this.renderComposeTypeahead();j.hide(this._resultsRoot);break;case ga.DETAIL.COMPOSE_TYPEAHEAD_RESULTS:this.renderComposeTypeahead();j.show(this._resultsRoot);break;}x.detailDOMChanged();},renderComposeTypeahead:function(){var ga=u.getCurrentStateData();j.show(this._typeaheadRoot);j.show(this._resultsRoot);if(!this._initiated){var ha=v[':fb:web-messenger:read-view:compose:typeahead'].build();l.setContent(this._typeaheadRoot,ha.getRoot());var ia=v[':fb:web-messenger:read-view:compose:typeahead:results'].build();l.setContent(this._resultsRoot,ia.getRoot());this._initialResultsLoadingSpinner=ia.getNode('initialResultsLoadingSpinner');this._typeaheadFooter=ia.getNode('typeaheadFooter');this._moreResultsLink=ia.getNode('moreResultsLink');this._typeaheadCaption=ia.getNode('caption');this.buildTypeahead(ia.getNode('results'));l.appendContent(ha.getNode('typeahead'),this._typeahead.getElement());this._initiated=true;}if(ga.start){if(!ga.participants)this._typeahead.reset();this._typeahead.focus();var ja=this._typeahead.getTypeahead().getCore();ja.getElement().removeAttribute('disabled');}ea(this);},buildTypeahead:function(ga){if(this._typeahead)return;var ha=k.WebMessengerComposerDataSource;p.updateMercuryOnFetchComplete(ha);var ia=new r(ha,h);ia.setPlaceholder("Name or email address");ia.setViewNodeID(ga);ia.setViewOption('renderer',z);y.addSubscriptions(ia.subscribe('tokens-changed',this.onTokensChanged.bind(this)));ia.addTokenizerBehavior({behavior:n,config:{matcher:i.MercuryTypeaheadConstants.VALID_EMAIL}});ia.build();y.addSubscriptions(ia.getTypeahead().subscribe(['respond','focus'],function(){da(!!ia.getTypeahead().getCore().getValue());}),ia.getTypeahead().subscribe(['reset','blur'],function(){da(false);}),ia.getTypeahead().subscribe('render',function(ja,ka){fa(this,ka.length);}.bind(this)),ia.getTypeahead().subscribe('reset',function(){fa(this,false);}.bind(this)),ia.getTypeahead().subscribe('query',function(ja,ka){l.setContent(this._moreResultsLink,ba._("See more results for {query}",{query:ka.value}));}.bind(this)),g.listen(ia.getElement(),'keydown',function(ja){if(ja.keyCode===o.TAB&&!ja.getModifiers().any){x.focusComposer();return false;}}),g.listen(this._typeaheadFooter,'mousedown',function(){return false;}),g.listen(this._moreResultsLink,'click',function(){var ja=this._typeahead.getTypeahead().getCore().getValue(),ka=aa(u.getCurrentStateData(),{all_people_query:ja,start:false});u.updateDetailState(t.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS,ka);}.bind(this)),g.listen(this._typeaheadFooter,'mouseover',function(){this._typeahead.getTypeahead().getView().clearSelected();}.bind(this)));this._typeahead=ia;},onTokensChanged:function(){var ga=u.getCurrentDetailState();if(ga==t.DETAIL.COMPOSE_MAIN||ga==t.DETAIL.COMPOSE_TYPEAHEAD_RESULTS||ga==t.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS){var ha=this._typeahead,ia=ha.getTokens(),ja=ia[ia.length-1];if(ja&&ja.getInfo().mercury_thread){var ka=ja.getInfo().mercury_thread.thread_id,la=m.getFromMeta(w.getThreadMetaNow(ka));u.updateDetailState(t.DETAIL.RECENT_MESSAGES,{thread_id:ka,folder:la,reuse_composer:true});}else{var ma=ia.map(function(oa){if(oa.getInfo().type==i.MercuryTypeaheadConstants.USER_TYPE){return 'fbid:'+oa.getValue();}else return 'email:'+oa.getValue();}),na=u.getCurrentStateData();if(!na.start||(ma||[]).length)u.updateDetailState(t.DETAIL.COMPOSE_MAIN,aa({},na,{participants:ma}));}}},destroy:function(){}});function da(ga){var ha=u.getCurrentDetailState(),ia=t;if(ha!=ia.DETAIL.COMPOSE_MAIN&&ha!=ia.DETAIL.COMPOSE_TYPEAHEAD_RESULTS)return;var ja;if(ga){ja=ia.DETAIL.COMPOSE_TYPEAHEAD_RESULTS;}else if(ha==ia.DETAIL.COMPOSE_TYPEAHEAD_RESULTS){ja=ia.DETAIL.COMPOSE_MAIN;}else ja=ha;if(ja!=ha){var ka=aa(u.getCurrentStateData(),{start:false,new_tokens:undefined});u.updateDetailState(ja,ka);}}function ea(ga){var ha=u.getCurrentStateData();if(ha.new_tokens){var ia=ga._typeahead.getTypeahead().getCore();ia.reset();ha.new_tokens.forEach(function(la){ga._typeahead.getTokenizer().addToken(la);});if(ha.new_tokens.length==1){var ja=ha.new_tokens[0],ka=s.getNow('fbid:'+ja.getValue());if(ka&&ka.type==q.PAGE)ia.getElement().setAttribute('disabled','disabled');}}}function fa(ga,ha){var ia=ga._typeahead.getTypeahead(),ja=ia.getCore().getValue(),ka=ia.getData().hasLoadedInitialResults(ja);j.conditionShow(ga._initialResultsLoadingSpinner,!ka);j.conditionShow(ga._moreResultsLink,ka&&ha);if(!ha&&ka){l.setContent(ga._typeaheadCaption,"No results found");}else l.setContent(ga._typeaheadCaption,"Displaying top results");}e.exports=ca;});
__d("WebMessengerUnseenMessageNoticeRenderer",["JSXDOM","ContextualLayer","LayerFadeOnHide","cx","tx","Event"],function(a,b,c,d,e,f){var g=b('JSXDOM'),h=b('ContextualLayer'),i=b('LayerFadeOnHide'),j=b('cx'),k=b('tx'),l=b('Event'),m={renderNoticeTooltip:function(o,p){var q=g.div({className:"_40p"},[n(o),g.i({className:"_40q"})]),r=new h(p||{},q).enableBehavior(i);return r;}};function n(o){var p=g.div({className:"_40r"},"You have new messages");l.listen(p,'click',o);return p;}e.exports=m;});
__d("WebMessengerMessagesNotice",["copyProperties","LayerDestroyOnHide","WebMessengerUnseenMessageNoticeRenderer","MercuryParticipants"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('LayerDestroyOnHide'),i=b('WebMessengerUnseenMessageNoticeRenderer'),j=b('MercuryParticipants'),k=function(){this._notice=null;this._noticeContextNode=null;this._active=false;};g(k.prototype,{getActive:function(){return this._active;},showMessageNotice:function(l,m){if(!this._active)return;if(!this._notice)this._notice=i.renderNoticeTooltip(l,{context:this._noticeContextNode,offsetY:2,position:m,alignment:'center'});this._notice.show();},hideMessageNotice:function(){this._notice&&this._notice.hide();},removeMessageNotice:function(){if(this._notice){this._notice.enableBehavior(h).hide();this._notice=null;}},setNoticeContextNode:function(l){this._noticeContextNode=l;},hideView:function(){this._active=false;this.hideMessageNotice();},updateView:function(){this._active=true;},destroy:function(){this._active=false;this.removeMessageNotice();},onlyReceivedFromSelf:function(l){for(var m in l){if(!l.hasOwnProperty(m))continue;for(var n=0,o=l[m].length;n<o;n++)if(l[m][n].author!==j.user)return false;}return true;}});e.exports=k;});
__d("WebMessengerDetailViewUnreadMessagesNotice",["Class","copyProperties","WebMessengerStateManager","throttle","MercuryThreadInformer","MercuryThreads","UserActivity","WebMessengerMessagesNotice","WebMessengerConstants","WebMessengerSubscriptionsHandler"],function(a,b,c,d,e,f){var g=b('Class'),h=b('copyProperties'),i=b('WebMessengerStateManager'),j=b('throttle'),k=b('MercuryThreadInformer').get(),l=b('MercuryThreads').get(),m=b('UserActivity'),n=b('WebMessengerMessagesNotice'),o=b('WebMessengerConstants'),p=b('WebMessengerSubscriptionsHandler'),q=o.MESSAGE_NOTICE_INACTIVITY_THRESHOLD,r=function(u){this.parent.construct(this);this._manager=u;p.addSubscriptions(k.subscribe('thread-read-changed',t.curry(this)));this._manager.setScrollCallback(j(function(v){if(s(this,v)){this.removeMessageNotice();if(m.isActive(5000)){var w=i.getCurrentStateData().thread_id;l.changeThreadReadStatus(w,true);}else m.subscribeOnce(function(){if(s(this,v)){var x=i.getCurrentStateData().thread_id;l.changeThreadReadStatus(x,true);}}.bind(this));}}.bind(this),100,null));};function s(u,v){var w=i.getCurrentStateData().thread_id;return w&&u.parent.getActive()&&v.isScrolledToBottom();}g.extend(r,n);h(r.prototype,{updateOnMessagesReceived:function(u,v,w,x){var y=!m.isActive(q);if(!this.parent.getActive())return;if(y||this.parent.onlyReceivedFromSelf(x)){this.removeMessageNotice();this._manager.scrollToBottom(true);}else if(!this._manager.isScrolledToBottom()){var z=w-(v-u);this._manager.setScrollTop(z,false);this.showMessageNotice();}},showMessageNotice:function(){var u=function(){this._manager.scrollToBottom();}.bind(this);this.parent.showMessageNotice(u,'above');}});function t(u,v,w){var x=i.getCurrentStateData().thread_id;if(x&&w[x]&&w[x].mark_as_read)u.removeMessageNotice();}e.exports=r;});
__d("MercuryListUpdateRenderer",["DOM","ge"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('ge'),i={updateList:function(j,k,l,m,n){var o=[];for(var p=0;p<k.length;p++){if(n){var q=n(p);q&&o.push(q);}var r=h(k[p]);if(r&&l(p)){o.push(r);}else o.push(m(p));}g.setContent(j,o);}};e.exports=i;});
__d("WebMessengerMessageIDFinder",["DataStore","DOM","csx"],function(a,b,c,d,e,f){var g=b('DataStore'),h=b('DOM'),i=b('csx'),j={findAll:function(k){var l=h.scry(k,"._53"),m=[];if(l.length){var n=l[0];for(var o=0;o<n.childNodes.length;o++)m.push(g.get(n.childNodes[o],'MessageRenderer:messageID'));}return m;}};e.exports=j;});
__d("WebMessengerMessagesSelection",["CSS","csx","DOM","getObjectValues","WebMessengerMessageIDFinder"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('csx'),i=b('DOM'),j=b('getObjectValues'),k=b('WebMessengerMessageIDFinder'),l={};function m(p,q){var r=p,s=q;if(r==s)return 0;while(true){r=r.nextSibling;s=s.nextSibling;if(!r||s==p){return 1;}else if(!s||r==q)return -1;}}function n(p,q){var r=p.id,s=i.scry(p,"._yh input")[0];if(q){l[r]=p;g.addClass(p,'selected');s.checked=true;}else{delete l[r];g.removeClass(p,'selected');s.checked=false;}}var o={clear:function(){for(var p in l)n(l[p],false);},selectClick:function(p){n(p,!(p.id in l));},getSelectedMessageIDs:function(){var p=j(l);p.sort(m);var q=[];p.forEach(function(r){q=q.concat(k.findAll(r));});return q;}};e.exports=o;});
__d("MessagingConst",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties'),h={APP_ID:313785040330,XD_MESSAGE:{SANDBOX_READY:'sandbox_ready',SET_CONTENT:'set_content',HTML_SIZE:'html_size',REFRESH_SIZE:'refresh_size'},SHINGLE_SCROLL_TRIGGER:5,EVENTS:{MESSAGE_SENT:'messaging/message_sent'},initConstants:function(i){g(h,i);}};e.exports=h;});
__d("MessagingXD",["Event","DOM","MercuryConstants","MessagingConst","URI","copyProperties"],function(a,b,c,d,e,f){var g=b('Event'),h=b('DOM'),i=b('MercuryConstants'),j=b('MessagingConst'),k=b('URI'),l=b('copyProperties');function m(n){this._listeners=[g.listen(window,'message',this._onPostMessage.bind(this))];this._iframes={};this._contentWindows={};this._messageHandler=n;}l(m.prototype,{unload:function(){this._listeners.forEach(function(n){n.remove();});},createIframe:function(n,o,p){var q=new k(p);this._iframes[o]=h.create('iframe',{name:o,frameBorder:0,src:q.toString()});h.appendContent(n,this._iframes[o]);this._contentWindows[o]=this._iframes[o].contentWindow;return this._iframes[o];},sendMessage:function(n,o){var p=Array.prototype.slice.apply(arguments);p[0]=j.APP_ID;var q=this._iframes[n].contentWindow||this._contentWindows[n];q.postMessage(p.join(','),i.Sandbox.ORIGIN);},_onPostMessage:function(event){if(event.origin!==i.Sandbox.ORIGIN||!event.data.split)return;var n=event.data.split(','),o=unescape(n[1]);this._contentWindows[o]=event.source;this._messageHandler(o,n);}});e.exports=m;});
__d("HTMLEmailRenderer",["CSS","MessagingConst","MessagingXD","copyProperties","emptyFunction","tx","MercuryConstants"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('MessagingConst'),i=b('MessagingXD'),j=b('copyProperties'),k=b('emptyFunction'),l=b('tx'),m=b('MercuryConstants');function n(o,p){this._resizeContent=o.resizeContent||k;this._richMap={};this._useFBStyle=p;this._xdc=new i(this.onXDMessage.bind(this));this._maxWidth=0;}j(n.prototype,{onXDMessage:function(o,p){if(p[0]!=h.APP_ID.toString())return;if(this._richMap&&this._richMap[o])if(p[2]==h.XD_MESSAGE.SANDBOX_READY){return this.setIframeContent(o);}else if(p[2]==h.XD_MESSAGE.HTML_SIZE)return this._resizeContent(o,parseInt(p[3],10),parseInt(p[4],10),p[5]=='true',p[6]=='true');},setIframeContent:function(o,p){this._xdc.sendMessage(o,h.XD_MESSAGE.SET_CONTENT,escape(this._richMap[o]),this._useFBStyle?'useFBStyle':'',p?'forceDialogOnWide':'',escape("Show hidden text"),escape("Hide"),this._maxWidth);},makeRich:function(o,p,q,r){var s=this._xdc.createIframe(p,o,m.Sandbox.PAGE_URL);g.addClass(s,'xdIframe');this._richMap[o]=q;this._maxWidth=r||0;},updateRichMap:function(o,p){this._richMap[o]=p;},unload:function(){this._xdc.unload();}});e.exports=n;});
__d("WebMessengerThreadMessagesRenderer",["JSXDOM","Event","AsyncRequest","MercuryAttachment","MercuryAttachmentRenderer","CSS","DataStore","DOM","HovercardLink","HTMLEmailRenderer","MercuryImageTemplates","LinkController","MercuryActionTypeConstants","MercuryAPIArgsSource","MercuryAttachmentType","MercuryConfig","MercuryThreadlistConstants","MercuryTimePassed","MercuryMessageRenderer","WebMessengerMessagesSelection","MercuryMessages","Parent","MercuryParticipants","WebMessengerStateManager","MercuryStatusTemplates","Style","WebMessengerTemplates","MercuryThreadMetadataRawRenderer","MercuryThreadMetadataRenderer","Vector","WebMessengerConstants","WebMessengerSubscriptionsHandler","csx","cx","formatDate","ge","isRTL","tx"],function(a,b,c,d,e,f){var g=b('JSXDOM'),h=b('Event'),i=b('AsyncRequest'),j=b('MercuryAttachment'),k=b('MercuryAttachmentRenderer'),l=b('CSS'),m=b('DataStore'),n=b('DOM'),o=b('HovercardLink'),p=b('HTMLEmailRenderer'),q=b('MercuryImageTemplates'),r=b('LinkController'),s=b('MercuryActionTypeConstants'),t=b('MercuryAPIArgsSource'),u=b('MercuryAttachmentType'),v=b('MercuryConfig'),w=b('MercuryThreadlistConstants'),x=b('MercuryTimePassed'),y=b('MercuryMessageRenderer'),z=b('WebMessengerMessagesSelection'),aa=b('MercuryMessages').get(),ba=b('Parent'),ca=b('MercuryParticipants'),da=b('WebMessengerStateManager'),ea=b('MercuryStatusTemplates'),fa=b('Style'),ga=b('WebMessengerTemplates'),ha=b('MercuryThreadMetadataRawRenderer'),ia=b('MercuryThreadMetadataRenderer').get(),ja=b('Vector'),ka=b('WebMessengerConstants'),la=b('WebMessengerSubscriptionsHandler'),ma=b('csx'),na=b('cx'),oa=b('formatDate'),pa=b('ge'),qa=b('isRTL'),ra=b('tx'),sa={updateSelection:function(cb){var db=da.getCurrentStateData().message_action;l.conditionClass(cb,'selectionEnabled',db);},setupSelectionListener:function(cb){r.registerHandler(function(db){var eb=da.getCurrentStateData().message_action;if(eb&&ba.byClass(db,'webMessengerMessageGroup'))return false;});la.addSubscriptions(h.listen(cb,'click',function(event){var db=da.getCurrentStateData().message_action;if(db){var eb=null;for(var fb=event.getTarget();fb;fb=fb.parentNode)if(l.hasClass(fb,'webMessengerMessageGroup'))eb=fb;eb&&z.selectClick(eb);}}));},renderForwardedMessages:function(cb,db){var eb=sa.calculateMessageGroups(db),fb=null;eb.forEach(function(gb){var hb=sa.renderMessageGroupArray(gb,true);n.appendContent(cb,hb.getRoot());fb=gb[gb.length-1];});},calculateMessageGroups:function(cb){var db=[],eb=null,fb=null;for(var gb=0,hb=cb.length;gb<hb;gb++){var ib=cb[gb],jb=sa.canAppendMessageToLastGroup(fb,ib);if(!jb){eb=[];db.push(eb);}eb.push(ib);fb=ib;}return db;},canAppendMessageToLastGroup:function(cb,db){var eb=w.GROUPING_THRESHOLD;if(!cb||ta(cb)||ta(db)||cb.author!=db.author||cb.timestamp<db.timestamp-eb||cb.spoof_warning!==db.spoof_warning)return false;return true;},renderMessageGroupArray:function(cb,db,eb){var fb=sa.renderMessageGroup(cb[0],db,eb);for(var gb=1;gb<cb.length;gb++)sa.appendMessageToGroup(fb,cb[gb]);return fb;},renderMessageGroup:function(cb,db,eb){var fb=cb.action_type==s.LOG_MESSAGE,gb=fb?ga[':fb:web-messenger:read-view:log-message'].build():ga[':fb:web-messenger:read-view:message-group'].build();gb.getRoot().setAttribute('id',(eb||'wm:')+cb.message_id);if(fb){sa.renderSingleLogMessage(gb,cb);}else ca.get(cb.author,function(hb){sa.renderSingleMessage(gb,cb,hb,db);});return gb;},appendMessageToGroup:function(cb,db){var eb=ga[':fb:web-messenger:read-view:message'].build();if(db.is_filtered_content){var fb=ea[':fb:mercury:filtered-message'].build();eb.setNodeContent('message',fb.getRoot());}else eb.setNodeContent('message',y.formatMessageBody(db.body,null,true));var gb=ha.renderStatusIndicator(db.status,db.error_data,aa.resendMessage.bind(aa,db,t.WEBMESSENGER));if(gb)eb.setNodeContent('status',gb);var hb=eb.getRoot();m.set(hb,'MessageRenderer:messageID',db.message_id);l.addClass(eb.getNode('message'),qa(db.body)?'direction_rtl':'direction_ltr');n.appendContent(cb.getNode('bodyDiv'),hb);ca.get(ca.user,function(ib){if(ib.employee)n.setContent(eb.getNode('bugReporting'),ga[':fb:web-messenger:bug-reporting'].render());});},renderSingleLogMessage:function(cb,db){var eb=cb.getNode('attachment');y.renderLogMessage(cb.getNode('icon'),cb.getNode('message'),eb,db);if(db.log_message_data.image)l.addClass(eb.firstChild,"_1_vi");ia.renderTimestamp(cb.getNode('timestamp'),db.timestamp_absolute,db.timestamp_relative,db.timestamp);},renderMessageSeparator:function(cb){var db=ga[':fb:mercury:timestamp'].render();db.removeAttribute('title');var eb=cb.timestamp_absolute;if(!eb)eb=y.renderDate(new Date(cb.timestamp));if(aa.isFirstMessage(cb))if(cb.timestamp_time_passed===x.TODAY){eb="Conversation started today";}else eb=ra._("Conversation started {timestamp}",{timestamp:eb});n.setContent(db,eb);l.show(db);return n.create('li',{className:"_2n3"},db);},renderMessageSeparatorForIndex:function(cb,db){var eb=cb[db][0];if(db){var fb=eb.timestamp,gb=cb[db-1],hb=gb[gb.length-1].timestamp,ib=ka.READ_VIEW_SEPARATOR_TIME_LIMIT;if(fb-hb<ib)return false;}return sa.renderMessageSeparator(eb);},renderRawAttachments:function(cb,db){var eb=j.convertRaw(db.raw_attachments||[]);if(db.photo_fbids)for(var fb=0;fb<db.photo_fbids.length;fb++)eb.push({preview_loading:true});sa.renderAttachments(cb,eb,db);},renderAttachments:function(cb,db,eb){ab(db);var fb=460,gb='contain',hb=bb(db);if(hb>1){gb='cover';if(hb==2||hb==4){fb=fb/2;}else fb=fb/3;}for(var ib=0;ib<db.length;ib++){var jb=k.renderAttachment(false,db[ib],eb,fb,gb);n.appendContent(cb,jb);}ua(cb);},renderSingleMessage:function(cb,db,eb,fb){cb.setNodeProperty('bodyDiv','id',db.message_id);if(db.html_body){var gb=cb.getNode('fbml');h.listen(gb,'click',function(){new i().setURI('/ajax/messaging/async.php').setReadOnly(true).setMethod('GET').setData({action:'htmlDialog',mid:db.message_id}).send();return false;});l.show(gb);var hb=cb.getNode('bodyDiv'),ib=g.div({className:"_5xl"}),jb=g.div({className:"_5xm"},ib);n.setContent(hb,jb);m.set(jb,'MessageRenderer:messageID',db.message_id);var kb=new p({resizeContent:va}),lb=function(){kb.makeRich(db.message_id,ib,db.html_body);};lb.defer();if(db.status!==undefined){var mb=cb.getNode('metadata'),nb=ha.renderStatusIndicator(db.status,db.error_data,aa.resendMessage.bind(aa,db));nb&&n.appendContent(mb,nb);}}else sa.appendMessageToGroup(cb,db);var ob;if(eb.href){ob=n.create('a',{href:eb.href},eb.name);var pb=ca.getUserID(eb.id);if(pb)ob.setAttribute('data-hovercard',o.constructEndpoint({id:pb}));}else ob=eb.name;cb.setNodeContent('authorName',ob);var qb=cb.getNode('image');l.removeClass(qb,'MercuryThreadImage');var rb=q[':fb:mercury:thread-image:single:medium'].render();rb.setAttribute('src',eb.image_src);if(eb.href)rb=n.create('a',{href:eb.href},rb);n.setContent(qb,rb);l.addClass(qb.firstChild,"_50dv");var sb=oa(new Date(db.timestamp),v['24h_times']?'H:i':'g:ia');ia.renderTimestamp(cb.getNode('timestamp'),db.timestamp_absolute,sb,db.timestamp);cb.getNode('mapHovercard').removeAttribute('href');if(db.coordinates){l.hide(cb.getNode('tooltipForSource'));ia.renderMessageLocation(cb.getNode('mapHovercard'),cb.getNode('locationIcon'),db.coordinates);}else{cb.getNode('mapHovercard').removeAttribute('data-hovercard');ia.renderMessageSourceTags(cb.getNode('tooltipForSource'),cb.getNode('sourceIcon'),db.source_tags||[],db.author_email);ia.renderSpoofWarning(cb.getNode('spoofWarning'),db.spoof_warning,eb);}if(db.subject)cb.setNodeContent('subject',db.subject);if(db.has_attachment){var tb=cb.getNode('attachments');if(db.attachments&&db.attachments.length===0){sa.renderRawAttachments(tb,db);}else if(db.attachments!==null&&db.attachments.length>0){sa.renderAttachments(tb,db.attachments,db);}else if(db.raw_attachments!=null&&db.raw_attachments.length>0)sa.renderRawAttachments(tb,db.raw_attachments);}var ub=cb.getNode('forwards'),vb=db.forward_count&&aa.getMessagesFromIDs(db.forward_message_ids);if(vb)sa.renderForwardedMessages(ub,vb);l.conditionShow(ub,vb);}};function ta(cb){return cb.action_type==s.LOG_MESSAGE||cb.has_attachment||cb.forward_count||cb.html_body||(cb.body&&cb.body.length>w.MAX_CHARS_BEFORE_BREAK);}function ua(cb){var db=n.scry(cb,"._rpb"),eb=db.length;if(!eb)return;var fb=g.div({className:"_ksb"});if(eb===1){l.addClass(fb,"_1_vi");l.addClass(fb,"_1_vj");n.appendContent(fb,db[0]);}else{var gb=g.table({cellpadding:"0",cellspacing:"0",className:"_1_vk"});n.appendContent(fb,gb);var hb;if(eb===2||eb===4){l.addClass(gb,"_1_vl");hb=2;}else{l.addClass(gb,"_1_vm");hb=3;}var ib;for(var jb=0;jb<eb;++jb){if(jb%hb===0){ib=g.tr(null);n.appendContent(gb,ib);}n.appendContent(ib,g.td(null,db[jb]));}}n.appendContent(cb,fb);}function va(cb,db,eb){var fb=pa(cb),gb=n.find(fb,'iframe'),hb=n.find(gb,"^._5xm"),ib=hb.firstChild;fa.set(gb,'width',db+'px');fa.set(gb,'height',(eb+1)+'px');gb.setAttribute('scrolling','no');var jb=fb&&ja.getElementDimensions(fb).x/db;if(jb&&jb<1){fa.set(hb,'height',Math.round(jb*(eb+1))+'px');var kb=gb.style,lb=['transform','WebkitTransform','msTransform','MozTransform','OTransform'],mb;while(mb=lb.shift())if(typeof kb[mb]!=='undefined'){fa.set(gb,mb,'scale('+jb+','+jb+')');return;}fa.set(ib,'zoom',jb);}}function wa(cb){return cb.attach_type==u.SHARE;}function xa(cb){return cb.attach_type==u.FILE;}function ya(cb){return cb.preview_url;}function za(cb){return cb.attach_type==u.ERROR;}function ab(cb){var db=[wa,ya,xa,za];cb.sort(function(eb,fb){for(var gb=0;gb<db.length;gb+=1){var hb=db[gb],ib=hb(eb),jb=hb(fb);if(ib&&!jb){return -1;}else if(ib&&jb){return 0;}else if(!ib&&jb)return 1;}return 0;});}function bb(cb){var db=0;cb.forEach(function(eb){if(ya(eb))db++;});return db;}e.exports=sa;});
__d("WebMessengerInfoBoxRenderer",["Event","cx","DOM","WebMessengerSubscriptionsHandler"],function(a,b,c,d,e,f){var g=b('Event'),h=b('cx'),i=b('DOM'),j=b('WebMessengerSubscriptionsHandler'),k={render:function(l,m){var n=i.create('div',{className:"_4rk"},l),o=i.create('div',{}),p=true;m.forEach(function(q){if(!p){var r=i.create('span',{className:"_4rl"},'\u00b7');i.appendContent(o,r);}p=false;var s=i.create('a',{},q.text);if(q.handler)j.addSubscriptions(g.listen(s,'click',q.handler));i.appendContent(o,s);});return i.create('div',{className:"_4rh"},[n,o]);}};e.exports=k;});
__d("WebMessengerDetailViewRecentMessagesControl",["Event","Animation","MercuryLastMessageIndicator","CSS","WebMessengerDetailViewUnreadMessagesNotice","DOM","MercuryListUpdateRenderer","MercuryAPIArgsSource","MercuryConfig","MercuryParticipants","MercuryThreadlistConstants","MercuryMessages","WebMessengerMessagesSelection","MessagingTag","WebMessengerStateConstants","WebMessengerStateManager","Style","WebMessengerTemplates","MercuryThreadInformer","WebMessengerThreadMessagesRenderer","MercuryThreads","UserActivity","WebMessengerConstants","WebMessengerInfoBoxRenderer","WebMessengerMessageIDFinder","WebMessengerSubscriptionsHandler","copyProperties","formatDate","ge","tx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Animation'),i=b('MercuryLastMessageIndicator'),j=b('CSS'),k=b('WebMessengerDetailViewUnreadMessagesNotice'),l=b('DOM'),m=b('MercuryListUpdateRenderer'),n=b('MercuryAPIArgsSource'),o=b('MercuryConfig'),p=b('MercuryParticipants'),q=b('MercuryThreadlistConstants'),r=b('MercuryMessages').get(),s=b('WebMessengerMessagesSelection'),t=b('MessagingTag'),u=b('WebMessengerStateConstants'),v=b('WebMessengerStateManager'),w=b('Style'),x=b('WebMessengerTemplates'),y=b('MercuryThreadInformer').get(),z=b('WebMessengerThreadMessagesRenderer'),aa=b('MercuryThreads').get(),ba=b('UserActivity'),ca=b('WebMessengerConstants'),da=b('WebMessengerInfoBoxRenderer'),ea=b('WebMessengerMessageIDFinder'),fa=b('WebMessengerSubscriptionsHandler'),ga=b('copyProperties'),ha=b('formatDate'),ia=b('ge'),ja=b('tx'),ka=function(bb,cb,db,eb,fb,gb,hb){this._manager=bb;this._rootElement=cb;this._loadingSpinner=db;this._noSelectedConversation=eb;this._newMessageLink=fb;this._showUnreadLink=gb;l.empty(this._rootElement);this._pagerExponent=-1;var ib=x[':fb:web-messenger:read-view:recent-messages'].build();l.setContent(this._rootElement,ib.getRoot());this._selectedConversationView=ib.getRoot();this._messageList=ib.getNode('messagelist');this._loadMoreButton=ib.getNode('loadMoreButton');this._loadMoreLink=ib.getNode('loadMoreLink');this._loadMoreCount=ib.getNode('loadMoreCount');this._loadingMoreCount=ib.getNode('loadingMoreCount');this._indicatorNode=ib.getNode('lastMessageIndicator');this._unseenMessagesNotice=new k(this._manager);this._unseenMessagesNotice.setNoticeContextNode(hb);this._active=false;this._state=null;this._threadID=null;this._bugReportingEnabled=false;this._currentCountMap={};this._olderMessageID={};this._loadMessagesInFlight={};z.setupSelectionListener(this._messageList);fa.addSubscriptions(g.listen(this._loadMoreLink,'click',ua.curry(this)),y.subscribe('messages-reordered',function(jb,kb){var lb=this._threadID&&kb[this._threadID];if(lb)qa(this);}.bind(this)),y.subscribe('messages-updated',function(jb,kb){var lb=this._threadID&&kb[this._threadID];if(lb)var mb=Object.keys(lb),nb=mb.length&&lb[mb[0]];if(lb&&nb)qa(this,kb[this._threadID]);}.bind(this)),y.subscribe('messages-received',function(jb,kb){if(this._threadID&&kb[this._threadID])ta(this,kb);}.bind(this)),y.subscribe('thread-read-changed',function(jb,kb){if(kb[this._threadID])ya(this,kb[this._threadID]);}.bind(this)),this._manager.subscribe('scrolledNearTop',function(){this._active&&ua(this);}.bind(this)));};ga(ka.prototype,{hideView:function(){this._active=false;j.hide(this._rootElement);j.hide(this._loadingSpinner);j.hide(this._noSelectedConversation);this._unseenMessagesNotice.hideView();this._manager._flexArea.setBottomAligned(false);},updateView:function(){this._unseenMessagesNotice.updateView();this._active=true;this._manager._flexArea.setBottomAligned(true);j.show(this._rootElement);var bb=ma(this);na(this);s.clear();if(bb){oa(this);}else wa(this);},destroy:function(){la(this);this._unseenMessagesNotice.destroy();this._lastMessageIndicator&&this._lastMessageIndicator.destroy();}});function la(bb){bb._messagesSubscription&&r.unsubscribe(bb._messagesSubscription.subscriber_id,bb._messagesSubscription.thread_id);bb._messagesSubscription=null;}function ma(bb){var cb=v.getCurrentStateData();if(!bb._threadID||bb._threadID!=cb.thread_id)return true;return false;}function na(bb){var cb=v.getCurrentStateData();bb._state=v.getCurrentDetailState();bb._threadID=cb.thread_id;bb._selectionEnabled=!!cb.message_action;bb._bugReportingEnabled=cb.bug_reporting_enabled;z.updateSelection(bb._messageList);j.conditionClass(bb._messageList,'bugReportingEnabled',bb._bugReportingEnabled);}function oa(bb){l.empty(bb._messageList);j.show(bb._loadingSpinner);j.hide(bb._loadMoreButton);la(bb);bb._pagerExponent=-1;bb._lastMessageIndicator&&bb._lastMessageIndicator.destroy();delete bb._lastMessageIndicator;if(bb._threadID){j.show(bb._selectedConversationView);j.hide(bb._noSelectedConversation);if(!bb._olderMessageID[bb._threadID]){pa(bb);}else qa(bb);bb._manager.scrollToBottom(false);}else{ab(bb);j.hide(bb._selectedConversationView);j.show(bb._noSelectedConversation);j.hide(bb._loadingSpinner);}}function pa(bb){bb._loadMessagesInFlight[bb._threadID]=true;bb._currentCountMap[bb._threadID]=ca.INITIAL_MESSAGES_LIMIT+1;j.hide(bb._loadMoreButton);var cb=r.getThreadMessagesRange(bb._threadID,0,bb._currentCountMap[bb._threadID],ra.curry(bb),null,n.WEBMESSENGER);if(cb){bb._messagesSubscription={subscriber_id:cb,thread_id:bb._threadID};}else qa(bb);}function qa(bb,cb){if(!bb._threadID||!bb._olderMessageID[bb._threadID])return;var db=r.getThreadMessagesSinceTimestamp(bb._threadID,za(bb._olderMessageID[bb._threadID]));if(db.length>bb._currentCountMap[bb._threadID])bb._currentCountMap[bb._threadID]=db.length;sa(bb,db,cb);}function ra(bb,cb){bb._loadMessagesInFlight[bb._threadID]=false;if(cb&&cb.length){var db=cb[0].timestamp,eb=bb._olderMessageID[bb._threadID]?za(bb._olderMessageID[bb._threadID]):null;if(!eb||db<eb)bb._olderMessageID[bb._threadID]=cb[0].message_id;}}function sa(bb,cb,db){j.hide(bb._loadingSpinner);j.conditionShow(bb._loadMoreButton,!r.hasLoadedAllMessages(bb._threadID));var eb=aa.getThreadMetaNow(bb._threadID);if(eb){var fb=eb.message_count-cb.length;fb=(fb<0)?0:fb;l.setContent(bb._loadMoreCount,fb);l.setContent(bb._loadingMoreCount,fb);}var gb=function(ob){var pb,qb=ia('wm:'+ob);if(qb)pb=ea.findAll(qb);return pb||[];},hb=[],ib=z.calculateMessageGroups(cb),jb={},kb=[];ib.forEach(function(ob){var pb=ob[0].message_id,qb=false;if(db){qb=ob.some(function(sb){return sb.message_id in db;});if(!qb){hb=gb(pb);qb=hb.some(function(sb){return sb in db;});}}if(!qb){hb=gb(pb);if(ob.length==hb.length){for(var rb=0;rb<ob.length;rb++)if(ob[rb].message_id!=hb[rb]){qb=true;break;}}else qb=true;}if(qb)jb[pb]=1;kb.push('wm:'+pb);});var lb=function(ob){return !jb[ib[ob][0].message_id];},mb=function(ob){var pb=ib[ob],qb=z.renderMessageGroupArray(pb);if(ob==kb.length-1)bb._messageGroup=qb;return qb.getRoot();},nb=function(ob){return z.renderMessageSeparatorForIndex(ib,ob);};m.updateList(bb._messageList,kb,lb,mb,nb);bb._lastMessage=cb[cb.length-1];va(bb).setLastMessage(bb._lastMessage);wa(bb);bb._manager.poke();}function ta(bb,cb){var db=cb[bb._threadID],eb=bb._manager._flexArea.getScrollableArea(),fb=eb.getScrollHeight();db.forEach(function(ib){ib.timestamp_relative=ha(new Date(ib.timestamp),o['24h_times']?'H:i':'g:ia');var jb=z.canAppendMessageToLastGroup(bb._lastMessage,ib);if(!jb){bb._messageGroup=z.renderMessageGroup(ib);var kb=ib.timestamp,lb=bb._lastMessage?bb._lastMessage.timestamp:0,mb=ca.READ_VIEW_SEPARATOR_TIME_LIMIT;if(!lb||kb-lb>=mb){var nb=z.renderMessageSeparator(ib);l.appendContent(bb._messageList,nb);}l.appendContent(bb._messageList,bb._messageGroup.getRoot());}else z.appendMessageToGroup(bb._messageGroup,ib);if(ib.author!=p.user)j.addClass(bb._messageGroup.getRoot(),'unreadHighlight');bb._lastMessage=ib;});bb._manager._flexArea.poke();var gb=eb.getScrollHeight(),hb=eb.getScrollTop();bb._unseenMessagesNotice.updateOnMessagesReceived(fb,gb,hb,cb);va(bb).setLastMessage(bb._lastMessage);if(bb._manager.isScrolledToBottom())wa(bb);}function ua(bb){j.addClass(bb._loadMoreButton,'async_saving');if(bb._loadMessagesInFlight[bb._threadID])return;bb._loadMessagesInFlight[bb._threadID]=true;bb._pagerExponent=Math.min(bb._pagerExponent+1,ca.EXPONENTIAL_PAGER_MAX_CYCLES);var cb=Math.pow(2,bb._pagerExponent),db=bb._currentCountMap[bb._threadID]+(cb*q.WEBMESSENGER_MORE_MESSAGES_COUNT);la(bb);var eb=r.getThreadMessagesRange(bb._threadID,0,db,function(fb){j.removeClass(bb._loadMoreButton,'async_saving');bb._currentCountMap[bb._threadID]=db;ra(bb,fb);bb._loadMessagesInFlight[bb._threadID]=false;},null,n.WEBMESSENGER);if(eb)bb._messagesSubscription={subscriber_id:eb,thread_id:bb._threadID};}function va(bb){if(!bb._lastMessageIndicator)bb._lastMessageIndicator=new i(bb._threadID,bb._indicatorNode,null,bb._manager._flexArea);return bb._lastMessageIndicator;}function wa(bb){if(ba.isActive(5000)){xa(bb);}else ba.subscribeOnce(xa.curry(bb));}function xa(bb){if(!bb._threadID||!bb._active)return;aa.changeThreadReadStatus(bb._threadID,true);var cb=l.scry(bb._messageList,'.unreadHighlight');cb.forEach(function(db){j.removeClass(db,'unreadHighlight');j.addClass(db,'unreadFading');new h(db).from('background','#eceff5').to('background','#fff').from('borderColor','#d6d6d6').to('borderColor','#fff').ease(h.ease.both).duration(1500).ondone(function(){j.removeClass(db,'unreadFading');w.set(db,'background','');w.set(db,'borderColor','');}).go();});}function ya(bb,cb){if(!cb.mark_as_read)return;var db=l.scry(bb._messageList,'.unreadHighlight');for(var eb=0;eb<db.length;eb++){var fb=db[eb],gb=ea.findAll(fb),hb=r.getMessagesFromIDs(gb);if(hb[hb.length-1].timestamp<cb.timestamp)j.removeClass(fb,'unreadHighlight');}}function za(bb){var cb=r.getMessagesFromIDs([bb])[0];return cb?cb.timestamp:0;}function ab(bb){if(bb._builtNoSelectionBox)return;var cb=function(){var eb=v.getCurrentStateData(),fb=ga({},eb);v.updateDetailState(u.DETAIL.COMPOSE_MAIN,ga(fb,{start:true,thread_id:undefined}));},db=function(){var eb=v.getCurrentStateData(),fb=ga({},eb);v.updateMasterState(u.MASTER.RECENT_THREADS,ga(fb,{folder:t.INBOX,filter:t.UNREAD}));};l.setContent(bb._noSelectedConversation,da.render("No Conversation Selected",[{text:"New Message",handler:cb},{text:"Show Unread",handler:db}]));bb._builtNoSelectionBox=true;}e.exports=ka;});
__d("MercurySearchContextResults",["KeyedCallbackManager","MercuryAPIArgsSource","MercuryThreadlistConstants","RangedCallbackManager","MercuryServerDispatcher","MercuryServerRequests","WebMessengerConstants"],function(a,b,c,d,e,f){var g=b('KeyedCallbackManager'),h=b('MercuryAPIArgsSource'),i=b('MercuryThreadlistConstants'),j=b('RangedCallbackManager'),k=b('MercuryServerDispatcher'),l=b('MercuryServerRequests').get(),m=b('WebMessengerConstants'),n=new g(),o=i.WEBMESSENGER_SEARCH_SNIPPET_COUNT,p=m.MORE_SEARCH_CONTEXT_COUNT,q={getSearchContext:function(u,v,w){if(u){var x=n.executeOrEnqueue(u,function(aa){var ba=s(aa,u);w(ba);}),y=n.getUnavailableResources(x);if(y.length){var z=l.getServerThreadIDNow(v);t({message_id:u,thread_id:z,limit:o+1});}return x;}},getMoreSearchContext:function(u,v,w,x){if(u){var y=n.getResource(u);if(y){var z=w==m.MORE_SEARCH_CONTEXT_UP?y.up_message_ids:y.down_message_ids,aa=z.getCurrentArraySize()+p,ba=z.executeOrEnqueue(0,aa,function(){var ea=s(y,u);x(ea);}),ca=z.getUnavailableResources(ba);if(ca.length){var da=l.getServerThreadIDNow(v);t({message_id:u,thread_id:da,limit:aa,direction:w});}return ba;}}},handleUpdate:function(u){if(u.mercury_payload)l.handleUpdate(u.mercury_payload);var v=u.search_context||{};for(var w in v){var x=v[w],y=x.thread_id,z=l.getClientThreadIDNow(y),aa=!n.getResource(w),ba=aa?{thread_id:z,up_message_ids:new j(),down_message_ids:new j()}:n.getResource(w),ca=aa?o+1:p;if(x.up_message_ids&&(ba.up_message_ids.getCurrentArraySize()===0||x.up_message_ids.length>=ba.up_message_ids.getCurrentArraySize()))r(ba.up_message_ids,x.up_message_ids,ca);if(x.down_message_ids&&(ba.down_message_ids.getCurrentArraySize()===0||x.down_message_ids.length>=ba.down_message_ids.getCurrentArraySize()))r(ba.down_message_ids,x.down_message_ids,ca);if(aa)n.setResource(w,ba);}},unsubscribe:function(u,v,w){if(v){var x=n.getResource(v);if(x){if(w==m.MORE_SEARCH_CONTEXT_UP){x.up_message_ids.unsubscribe(u);}else x.down_message_ids.unsubscribe(u);}else n.unsubscribe(u);}}};function r(u,v,w){var x=u.getCurrentArraySize(),y=v.length<x+w;if(v.length){u.removeAllResources();u.addResourcesWithoutSorting(v,0);}if(y)u.setReachedEndOfArray();}function s(u,v){var w=u.up_message_ids.hasReachedEndOfArray(),x=u.up_message_ids.getAllResources();if(!w)x.pop();var y=u.down_message_ids.hasReachedEndOfArray(),z=u.down_message_ids.getAllResources();if(!y)z.pop();return {thread_id:u.thread_id,message_id:v,up_message_ids:x,up_exhausted:w,down_message_ids:z,down_exhausted:y};}function t(u){u.client=h.WEBMESSENGER;k.trySend('/ajax/mercury/search_context.php',u);}k.registerEndpoints({'/ajax/mercury/search_context.php':{mode:k.IMMEDIATE,handler:q.handleUpdate}});e.exports=q;});
__d("MercurySearchSnippetResults",["MercuryAPIArgsSource","MercuryThreadlistConstants","RangedCallbackManager","MercuryServerDispatcher","MercuryServerRequests"],function(a,b,c,d,e,f){var g=b('MercuryAPIArgsSource'),h=b('MercuryThreadlistConstants'),i=b('RangedCallbackManager'),j=b('MercuryServerDispatcher'),k=b('MercuryServerRequests').get(),l={},m={},n=null,o=h.WEBMESSENGER_SEARCH_SNIPPET_COUNT,p=h.WEBMESSENGER_SEARCH_SNIPPET_LIMIT,q=h.WEBMESSENGER_SEARCH_SNIPPET_MORE,r={getAllThreadSearchResults:function(ba,ca){if(ba)s(ba,p,0,ca);},getAllThreadSearchMoreResults:function(ba,ca){if(ba){var da=l[ba];if(da){var ea=da.getCurrentArraySize();s(ba,q,ea,ca);}}},getSingleThreadSearchResults:function(ba,ca,da){if(!ba||!ca)return;t(ba,ca,o,0,da);},getSingleThreadSearchMoreResults:function(ba,ca,da){if(!ba||!ca)return;if(!m[ca])return;var ea=m[ca][ba];if(ea){var fa=ea.num_total_snippets,ga=ea.snippets_cbm.getCurrentArraySize(),ha=fa-ga;if(ha>0){var ia=ha>q?q:ha;t(ba,ca,ia,ga,da);}}},countSnippetsMatchingQueryInThread:function(ba,ca){var da=m[ca][ba];if(da)return da.num_total_snippets;},findIndexOfSnippet:function(ba,ca,da,ea){var fa=z(ba,ca),ga=fa.getAllResources();for(var ha=0;ha<ga.length;ha++)if(da===ga[ha].message_id)return ha;},findSnippetAtIndex:function(ba,ca,da,ea){w(ba,ca,da);x(ba,ca,da,ea);},handleUpdate:function(ba){if(ba.mercury_payload)k.handleUpdate(ba.mercury_payload);var ca=ba.search_snippets||{};Object.keys(ca).filter(function(qa){return !!ca[qa];}).forEach(function(qa){Object.keys(ca[qa]).forEach(function(ra){ca[qa][ra].snippets.forEach(function(sa){sa.matched_keywords=u(sa.matched_keywords);});});});var da=ba.offset,ea=[];for(var fa in ca){var ga=ca[fa];for(var ha in ga){var ia=ga[ha],ja=k.getClientThreadIDNow(ha),ka=ia.snippets,la=z(fa,ja),ma=la.getCurrentArraySize();if(!ba.thread_id){ea.push(ja);if(ma)continue;}else if(da!=ma)continue;var na=m[ja][fa];na.num_total_snippets=ia.num_total_snippets;la.addResourcesWithoutSorting(ka,ma);if(!ba.thread_id||ba.limit>ka.length)if(la.getCurrentArraySize()==na.num_total_snippets)la.setReachedEndOfArray();}if(!ba.thread_id){var oa=y(fa),pa=oa.getCurrentArraySize();if(da==pa){oa.addResourcesWithoutSorting(ea,pa);if(ba.limit>ea.length)oa.setReachedEndOfArray();}}}}};function s(ba,ca,da,ea){v();var fa=y(ba),ga=da+ca,ha=fa.executeOrEnqueue(0,ga,function(ja){var ka={};for(var la=0;la<ja.length;la++){var ma=ja[la],na=m[ma][ba];ka[ma]={num_total_snippets:na.num_total_snippets,snippets:na.snippets_cbm.getAllResources()};}var oa=fa.hasReachedEndOfArray();ea(ka,oa);}),ia=fa.getUnavailableResources(ha);if(ia.length){n={query:ba,thread_id:null,subscriber_id:ha};aa({query:ba,offset:da,limit:ca+1,snippetLimit:o});}}function t(ba,ca,da,ea,fa){v();var ga=z(ba,ca),ha=ea+da,ia=ga.executeOrEnqueue(0,ha,function(){var la=ga.getAllResources(),ma=m[ca][ba].num_total_snippets;fa(la,ma);}),ja=ga.getUnavailableResources(ia);if(ja.length){n={query:ba,thread_id:ca,subscriber_id:ia};var ka=k.getServerThreadIDNow(ca);aa({query:ba,thread_id:ka,snippetOffset:ea,snippetLimit:da});}}function u(ba){if(ba instanceof Array){var ca={};for(var da=0;da<ba.length;da++)ca[da.toString()]=ba[da];return ca;}else return ba;}function v(){if(n){if(n.thread_id){var ba=z(n.query,n.thread_id);ba.unsubscribe(n.subscriber_id);}else{var ca=y(n.query);ca.unsubscribe(n.subscriber_id);}n=null;}}function w(ba,ca,da){}function x(ba,ca,da,ea){var fa=m[ca][ba],ga=fa.snippets_cbm.getAllResources(),ha=fa.num_total_snippets,ia=ga.length;if(da<ia){ea(ga[da].message_id);return;}var ja=ha-ia,ka=ja>q?q:ja;t(ba,ca,ka,ia,function(la,ma){x(ba,ca,da,ea);});}function y(ba){if(!l[ba])l[ba]=new i();return l[ba];}function z(ba,ca){if(!m[ca])m[ca]={};var da=m[ca][ba];if(!da){da={num_total_snippets:-1,snippets_cbm:new i()};m[ca][ba]=da;}return da.snippets_cbm;}function aa(ba){ba.client=g.WEBMESSENGER;j.trySend('/ajax/mercury/search_snippets.php',ba);}j.registerEndpoints({'/ajax/mercury/search_snippets.php':{mode:j.IMMEDIATE,handler:r.handleUpdate}});e.exports=r;});
__d("WebMessengerDetailViewSearchContextControl",["Event","CSS","DOM","MercuryMessages","WebMessengerMessagesSelection","MercurySearchContextResults","MercurySearchSnippetResults","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","WebMessengerThreadMessagesRenderer","WebMessengerConstants","WebMessengerSubscriptionsHandler","copyProperties"],function(a,b,c,d,e,f){var g=b('Event'),h=b('CSS'),i=b('DOM'),j=b('MercuryMessages').get(),k=b('WebMessengerMessagesSelection'),l=b('MercurySearchContextResults'),m=b('MercurySearchSnippetResults'),n=b('WebMessengerStateConstants'),o=b('WebMessengerStateManager'),p=b('WebMessengerTemplates'),q=b('WebMessengerThreadMessagesRenderer'),r=b('WebMessengerConstants'),s=b('WebMessengerSubscriptionsHandler'),t=b('copyProperties'),u=function(ea,fa,ga){this._manager=ea;this._rootElement=fa;this._paginationBox=ga;i.empty(this._rootElement);var ha=p[':fb:web-messenger:read-view:search-context'].build(),ia=p[':fb:web-messenger:read-view:search-pagination-box'].build();i.setContent(this._rootElement,ha.getRoot());i.setContent(this._paginationBox,ia.getRoot());this._messagelistRoot=ha.getRoot();this._loadingSpinner=ha.getNode('loadingSpinner');this._messageList=ha.getNode('messagelist');this._loadMoreButton=ha.getNode('loadMoreButton');this._loadMoreLink=ha.getNode('loadMoreLink');this._downMoreButton=ha.getNode('downMoreButton');this._downMoreLink=ha.getNode('downMoreLink');this._nextSnippet=ia.getNode('nextSnippet');this._previousSnippet=ia.getNode('previousSnippet');this._backToSnippetsButton=ia.getNode('backToSnippetsButton');this._snippetCountDescription=ia.getNode('snippetCountDescription');this._paginationBoxCloseButton=ia.getNode('paginationBoxCloseButton');this._state=null;this._threadID=null;this._messageID=null;q.setupSelectionListener(this._messageList);s.addSubscriptions(g.listen(this._loadMoreLink,'click',function(){h.addClass(this._loadMoreButton,'async_saving');ca(this,r.MORE_SEARCH_CONTEXT_UP);}.bind(this)),g.listen(this._downMoreLink,'click',function(){h.addClass(this._downMoreButton,'async_saving');ca(this,r.MORE_SEARCH_CONTEXT_DOWN);}.bind(this)),g.listen(this._nextSnippet,'click',v.curry(this,1)),g.listen(this._previousSnippet,'click',v.curry(this,-1)),g.listen(this._backToSnippetsButton,'click',function(){var ja=o.getCurrentStateData(),ka=ja.single_thread_search?n.DETAIL.SEARCH_THREAD_SNIPPET:n.DETAIL.SEARCH_SNIPPET,la={folder:ja.folder,message_query:ja.message_query,query:ja.query};if(ja.single_thread_search)la.thread_id=ja.thread_id;o.updateDetailState(ka,la);}),g.listen(this._paginationBoxCloseButton,'click',function(){o.updateDetailState(n.DETAIL.RECENT_MESSAGES,{thread_id:o.getCurrentStateData().thread_id});}.bind(this)));};t(u.prototype,{hideView:function(){h.hide(this._rootElement);h.hide(this._paginationBox);},updateView:function(){h.show(this._rootElement);h.show(this._paginationBox);var ea=y(this);z(this);k.clear();if(ea)ba(this);},destroy:function(){x(this);}});function v(ea,fa){var ga=o.getCurrentStateData(),ha=m.findIndexOfSnippet(ea._messageQuery,ga.thread_id,ga.message_id),ia=ha+fa;h.hide(ea._messageList);h.hide(ea._loadMoreButton);h.hide(ea._downMoreButton);h.show(ea._loadingSpinner);m.findSnippetAtIndex(ea._messageQuery,ga.thread_id,ia,function(ja){h.show(ea._messageList);w(ga,ja);});}function w(ea,fa){var ga={folder:ea.folder,message_id:fa,message_query:ea.message_query,query:ea.query,single_thread_search:ea.single_thread_search,thread_id:ea.thread_id};o.updateDetailState(o.getCurrentDetailState(),ga);}function x(ea){ea._searchContextSubscription&&l.unsubscribe(ea._searchContextSubscription.subscriber_id,ea._searchContextSubscription.message_id,ea._searchContextSubscription.direction);ea._searchThreadsSubscription=null;}function y(ea){var fa=o.getCurrentStateData();if(ea._threadID!=fa.thread_id)return true;if(ea._messageQuery!=fa.message_query)return true;if(ea._messageID!=fa.message_id)return true;return false;}function z(ea){var fa=o.getCurrentStateData();ea._state=o.getCurrentDetailState();ea._threadID=fa.thread_id;ea._messageQuery=fa.message_query;ea._messageID=fa.message_id;ea._selectionEnabled=!!fa.message_action;q.updateSelection(ea._messageList);h.conditionClass(ea._messageList,'bugReportingEnabled',fa.bug_reporting_enabled);}function aa(ea,fa){i.setAttributes(ea,{disabled:fa});var ga=i.find(ea,'^label');h.conditionClass(ga,'uiButtonDisabled',fa);}function ba(ea){var fa=i.create('strong',{},ea._messageQuery),ga=m.countSnippetsMatchingQueryInThread(ea._messageQuery,ea._threadID),ha=m.findIndexOfSnippet(ea._messageQuery,ea._threadID,ea._messageID),ia=ha+1,ja=i.tx._("{index} of {count} results for {query}",{index:ia,count:ga,query:fa});i.setContent(ea._snippetCountDescription,ja);aa(ea._previousSnippet,ha===0);aa(ea._nextSnippet,ha===ga-1);i.empty(ea._messageList);h.show(ea._loadingSpinner);h.hide(ea._loadMoreButton);h.hide(ea._downMoreButton);x(ea);if(ea._threadID&&ea._messageID){var ka=l.getSearchContext(ea._messageID,ea._threadID,function(la){h.hide(ea._loadingSpinner);da(ea,la);});if(ka)ea._searchContextSubscription={subscriber_id:ka,message_id:ea._messageID};}}function ca(ea,fa){x(ea);if(ea._threadID&&ea._messageID){var ga=l.getMoreSearchContext(ea._messageID,ea._threadID,fa,function(ha){if(fa==r.MORE_SEARCH_CONTEXT_UP){h.removeClass(ea._loadMoreButton,'async_saving');}else h.removeClass(ea._downMoreButton,'async_saving');da(ea,ha);});if(ga)ea._searchContextSubscription={subscriber_id:ga,message_id:ea._messageID,direction:fa};}}function da(ea,fa){h.conditionShow(ea._loadMoreButton,!fa.up_exhausted);h.conditionShow(ea._downMoreButton,!fa.down_exhausted);var ga=fa.up_message_ids.concat([fa.message_id],fa.down_message_ids),ha=j.getMessagesFromIDs(ga);i.empty(ea._messageList);var ia=q.calculateMessageGroups(ha);ia.forEach(function(ja,ka){var la=q.renderMessageSeparatorForIndex(ia,ka);if(la)i.appendContent(ea._messageList,la);var ma=q.renderMessageGroupArray(ja,false,'context:').getRoot(),na=ja.some(function(oa){return oa.message_id==fa.message_id;});if(na)h.addClass(ma,'selectedHighlight');i.appendContent(ea._messageList,ma);});}e.exports=u;});
__d("WebMessengerSearchSnippetsRenderer",["Event","CSS","DOM","MercuryImageTemplates","MercuryMessageRenderer","MercuryParticipants","MercurySearchSnippetResults","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","MercuryThreadMetadataRenderer","cx","tx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('CSS'),i=b('DOM'),j=b('MercuryImageTemplates'),k=b('MercuryMessageRenderer'),l=b('MercuryParticipants'),m=b('MercurySearchSnippetResults'),n=b('WebMessengerStateConstants'),o=b('WebMessengerStateManager'),p=b('WebMessengerTemplates'),q=b('MercuryThreadMetadataRenderer').get(),r=b('cx'),s=b('tx'),t={renderMultipleSnippetBlocks:function(z,aa,ba){ba=ba||{};var ca=true;for(var da in ba){ca=false;var ea=p[':fb:web-messenger:read-view:search-snippets-block'].build();i.appendContent(z,ea.getRoot());t.renderSingleSnippetBlock(ea,aa,da,ba[da]);}if(ca)y(z);},renderThreadSnippetBlock:function(z,aa,ba,ca,da){if(!ca||!ca.length){y(z);return;}var ea=p[':fb:web-messenger:read-view:search-snippets-block'].build();i.appendContent(z,ea.getRoot());h.hide(ea.getNode('searchThreadName'));u(ea,aa,ba,ca,da);},renderSingleSnippetBlock:function(z,aa,ba,ca){var da=z.getNode('searchThreadName'),ea=i.create('h3');i.setContent(da,ea);q.renderAndSeparatedParticipantList(ba,ea);u(z,aa,ba,ca.snippets,ca.num_total_snippets);},renderMultipleSnippets:function(z,aa,ba,ca){(ca||[]).forEach(function(da){var ea=p[':fb:web-messenger:read-view:search-snippet'].build();i.appendContent(z,ea.getRoot());l.get(da.author,function(fa){t.renderSingleSnippet(ea,aa,ba,da,fa);});});},renderSingleSnippet:function(z,aa,ba,ca,da){z.setNodeProperty('bodyDiv','id','snippet:'+ca.message_id);var ea=ca.matched_keywords||undefined,fa=k.formatMessageBody(ca.body,ea);z.setNodeContent('body',fa);var ga=z.getNode('image');h.removeClass(ga,'MercuryThreadImage');h.addClass(ga,'MercuryMediumThreadImage');var ha=j[':fb:mercury:thread-image:single:medium'].render();ha.setAttribute('src',da.image_src);if(da.href)ha=i.create('a',{href:da.href},ha);i.setContent(ga,ha);var ia=da.short_name;z.setNodeContent('shortName',i.tx._("{name}:",{name:ia}));q.renderTimestamp(z.getNode('timestamp'),ca.timestamp_absolute,ca.timestamp_relative,ca.timestamp);var ja=z.getNode('seeContext');g.listen(ja,'click',function(){var ka=o.getCurrentStateData(),la={message_query:aa,query:ka.query,thread_id:ba,message_id:ca.message_id},ma=o.getCurrentDetailState();if(ma===n.DETAIL.SEARCH_THREAD_SNIPPET)la.single_thread_search=true;o.updateDetailState(n.DETAIL.SEARCH_CONTEXT,la);return false;});}};function u(z,aa,ba,ca,da){var ea=z.getNode('snippetList');t.renderMultipleSnippets(ea,aa,ba,ca);var fa=da-ca.length;v(z,aa,ba,da,fa);}function v(z,aa,ba,ca,da){var ea=z.getNode('totalSnippetsCount'),fa=z.getNode('moreSnippetsLink');h.conditionShow(fa,da>0);if(da>0){var ga=x(da);i.setContent(fa,ga);}i.setContent(ea,w(ca));if(da>0)g.listen(fa,'click',function(){m.getSingleThreadSearchMoreResults(aa,ba,function(ha){i.empty(z.getNode('snippetList'));u(z,aa,ba,ha,ca);});});}function w(z){if(z==1){return "1 result in total";}else return s._("{count} results in total",{count:z});}function x(z){if(z==1){return "Show 1 more result";}else return s._("Show {count} more results",{count:z});}function y(z){var aa="No results",ba=i.create('div',{className:"_2n4"},aa);i.setContent(z,ba);}e.exports=t;});
__d("WebMessengerDetailViewSearchSnippetsControl",["JSXDOM","Event","CSS","DOM","MercurySearchSnippetResults","WebMessengerSearchSnippetsRenderer","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","WebMessengerPermalinks","WebMessengerSubscriptionsHandler","copyProperties","cx","tx"],function(a,b,c,d,e,f){var g=b('JSXDOM'),h=b('Event'),i=b('CSS'),j=b('DOM'),k=b('MercurySearchSnippetResults'),l=b('WebMessengerSearchSnippetsRenderer'),m=b('WebMessengerStateConstants'),n=b('WebMessengerStateManager'),o=b('WebMessengerTemplates'),p=b('WebMessengerPermalinks'),q=b('WebMessengerSubscriptionsHandler'),r=b('copyProperties'),s=b('cx'),t=b('tx'),u=function(z,aa){this._manager=z;this._rootElement=aa;j.empty(this._rootElement);var ba=o[':fb:web-messenger:read-view:search-snippets'].build();j.setContent(this._rootElement,ba.getRoot());this._loadingSpinner=ba.getNode('loadingSpinner');this._messageList=ba.getNode('messagelist');this._downMoreButton=ba.getNode('downMoreButton');this._downMoreLink=ba.getNode('downMoreLink');this._state=null;this._messageQuery=null;this._threadID=null;i.hide(this._downMoreButton);q.addSubscriptions(h.listen(this._downMoreLink,'click',function(){i.addClass(this._downMoreButton,'async_saving');y(this);}.bind(this)));};r(u.prototype,{hideView:function(){i.hide(this._rootElement);},updateView:function(){i.show(this._rootElement);var z=v(this);w(this);if(z)x(this);},destroy:function(){}});function v(z){var aa=n.getCurrentDetailState();if(z._state!=aa)return true;var ba=n.getCurrentStateData();if(z._messageQuery!=ba.message_query)return true;if(aa==m.DETAIL.SEARCH_THREAD_SNIPPET)if(z._threadID!=ba.thread_id)return true;return false;}function w(z){z._state=n.getCurrentDetailState();var aa=n.getCurrentStateData();z._threadID=aa.thread_id;z._messageQuery=aa.message_query;}function x(z){i.hide(z._downMoreButton);j.empty(z._messageList);if(z._messageQuery){i.show(z._loadingSpinner);if(z._state===m.DETAIL.SEARCH_THREAD_SNIPPET&&z._threadID){k.getSingleThreadSearchResults(z._messageQuery,z._threadID,function(aa,ba){i.hide(z._loadingSpinner);l.renderThreadSnippetBlock(z._messageList,z._messageQuery,z._threadID,aa,ba);var ca=g.a({className:"_4-ii"},t._("Search all conversations for \"{query}\"",{query:z._messageQuery})),da=p.getURI(m.MASTER.SEARCH,m.DETAIL.SEARCH_SNIPPET,{query:z._messageQuery,message_query:z._messageQuery});ca.setAttribute('href',da);j.prependContent(z._messageList,g.div({className:"_4-ij"},ca));});}else k.getAllThreadSearchResults(z._messageQuery,function(aa,ba){i.hide(z._loadingSpinner);l.renderMultipleSnippetBlocks(z._messageList,z._messageQuery,aa);i.conditionShow(z._downMoreButton,!ba);});}}function y(z){if(z._messageQuery)k.getAllThreadSearchMoreResults(z._messageQuery,function(aa,ba){i.removeClass(z._downMoreButton,'async_saving');j.empty(z._messageList);l.renderMultipleSnippetBlocks(z._messageList,z._messageQuery,aa);i.conditionShow(z._downMoreButton,!ba);});}e.exports=u;});
__d("StanfordCrypto",[],function(global,require,requireDynamic,requireLazy,module,exports) {/**
 * @providesModule StanfordCrypto
 *
 * @option preserve-whitespace
 */

"use strict";var sjcl={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(a){this.toString=function(){return"CORRUPT: "+this.message};this.message=a},invalid:function(a){this.toString=function(){return"INVALID: "+this.message};this.message=a},bug:function(a){this.toString=function(){return"BUG: "+this.message};this.message=a},notReady:function(a){this.toString=function(){return"NOT READY: "+this.message};this.message=a}}};
if(typeof module!="undefined"&&module.exports)module.exports=sjcl;
sjcl.cipher.aes=function(a){this.i[0][0][0]||this.B();var b,c,d,e,f=this.i[0][4],g=this.i[1];b=a.length;var h=1;if(b!==4&&b!==6&&b!==8)throw new sjcl.exception.invalid("invalid aes key size");this.a=[d=a.slice(0),e=[]];for(a=b;a<4*b+28;a++){c=d[a-1];if(a%b===0||b===8&&a%b===4){c=f[c>>>24]<<24^f[c>>16&255]<<16^f[c>>8&255]<<8^f[c&255];if(a%b===0){c=c<<8^c>>>24^h<<24;h=h<<1^(h>>7)*283}}d[a]=d[a-b]^c}for(b=0;a;b++,a--){c=d[b&3?a:a-4];e[b]=a<=4||b<4?c:g[0][f[c>>>24]]^g[1][f[c>>16&255]]^g[2][f[c>>8&255]]^
g[3][f[c&255]]}};
sjcl.cipher.aes.prototype={encrypt:function(a){return this.K(a,0)},decrypt:function(a){return this.K(a,1)},i:[[[],[],[],[],[]],[[],[],[],[],[]]],B:function(){var a=this.i[0],b=this.i[1],c=a[4],d=b[4],e,f,g,h=[],i=[],j,k,l,m;for(e=0;e<0x100;e++)i[(h[e]=e<<1^(e>>7)*283)^e]=e;for(f=g=0;!c[f];f^=j||1,g=i[g]||1){l=g^g<<1^g<<2^g<<3^g<<4;l=l>>8^l&255^99;c[f]=l;d[l]=f;k=h[e=h[j=h[f]]];m=k*0x1010101^e*0x10001^j*0x101^f*0x1010100;k=h[l]*0x101^l*0x1010100;for(e=0;e<4;e++){a[e][f]=k=k<<24^k>>>8;b[e][l]=m=m<<24^m>>>8}}for(e=
0;e<5;e++){a[e]=a[e].slice(0);b[e]=b[e].slice(0)}},K:function(a,b){if(a.length!==4)throw new sjcl.exception.invalid("invalid aes block size");var c=this.a[b],d=a[0]^c[0],e=a[b?3:1]^c[1],f=a[2]^c[2];a=a[b?1:3]^c[3];var g,h,i,j=c.length/4-2,k,l=4,m=[0,0,0,0];g=this.i[b];var n=g[0],o=g[1],p=g[2],q=g[3],r=g[4];for(k=0;k<j;k++){g=n[d>>>24]^o[e>>16&255]^p[f>>8&255]^q[a&255]^c[l];h=n[e>>>24]^o[f>>16&255]^p[a>>8&255]^q[d&255]^c[l+1];i=n[f>>>24]^o[a>>16&255]^p[d>>8&255]^q[e&255]^c[l+2];a=n[a>>>24]^o[d>>16&
255]^p[e>>8&255]^q[f&255]^c[l+3];l+=4;d=g;e=h;f=i}for(k=0;k<4;k++){m[b?3&-k:k]=r[d>>>24]<<24^r[e>>16&255]<<16^r[f>>8&255]<<8^r[a&255]^c[l++];g=d;d=e;e=f;f=a;a=g}return m}};
sjcl.bitArray={bitSlice:function(a,b,c){a=sjcl.bitArray.Q(a.slice(b/32),32-(b&31)).slice(1);return c===undefined?a:sjcl.bitArray.clamp(a,c-b)},extract:function(a,b,c){var d=Math.floor(-b-c&31);return((b+c-1^b)&-32?a[b/32|0]<<32-d^a[b/32+1|0]>>>d:a[b/32|0]>>>d)&(1<<c)-1},concat:function(a,b){if(a.length===0||b.length===0)return a.concat(b);var c=a[a.length-1],d=sjcl.bitArray.getPartial(c);return d===32?a.concat(b):sjcl.bitArray.Q(b,d,c|0,a.slice(0,a.length-1))},bitLength:function(a){var b=a.length;
if(b===0)return 0;return(b-1)*32+sjcl.bitArray.getPartial(a[b-1])},clamp:function(a,b){if(a.length*32<b)return a;a=a.slice(0,Math.ceil(b/32));var c=a.length;b&=31;if(c>0&&b)a[c-1]=sjcl.bitArray.partial(b,a[c-1]&2147483648>>b-1,1);return a},partial:function(a,b,c){if(a===32)return b;return(c?b|0:b<<32-a)+a*0x10000000000},getPartial:function(a){return Math.round(a/0x10000000000)||32},equal:function(a,b){if(sjcl.bitArray.bitLength(a)!==sjcl.bitArray.bitLength(b))return false;var c=0,d;for(d=0;d<a.length;d++)c|=
a[d]^b[d];return c===0},Q:function(a,b,c,d){var e;e=0;if(d===undefined)d=[];for(;b>=32;b-=32){d.push(c);c=0}if(b===0)return d.concat(a);for(e=0;e<a.length;e++){d.push(c|a[e]>>>b);c=a[e]<<32-b}e=a.length?a[a.length-1]:0;a=sjcl.bitArray.getPartial(e);d.push(sjcl.bitArray.partial(b+a&31,b+a>32?c:d.pop(),1));return d},j:function(a,b){return[a[0]^b[0],a[1]^b[1],a[2]^b[2],a[3]^b[3]]}};
sjcl.codec.utf8String={fromBits:function(a){var b="",c=sjcl.bitArray.bitLength(a),d,e;for(d=0;d<c/8;d++){if((d&3)===0)e=a[d/4];b+=String.fromCharCode(e>>>24);e<<=8}return decodeURIComponent(escape(b))},toBits:function(a){a=unescape(encodeURIComponent(a));var b=[],c,d=0;for(c=0;c<a.length;c++){d=d<<8|a.charCodeAt(c);if((c&3)===3){b.push(d);d=0}}c&3&&b.push(sjcl.bitArray.partial(8*(c&3),d));return b}};
sjcl.codec.hex={fromBits:function(a){var b="",c;for(c=0;c<a.length;c++)b+=((a[c]|0)+0xf00000000000).toString(16).substr(4);return b.substr(0,sjcl.bitArray.bitLength(a)/4)},toBits:function(a){var b,c=[],d;a=a.replace(/\s|0x/g,"");d=a.length;a+="00000000";for(b=0;b<a.length;b+=8)c.push(parseInt(a.substr(b,8),16)^0);return sjcl.bitArray.clamp(c,d*4)}};
sjcl.codec.base64={H:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(a,b,c){var d="",e=0,f=sjcl.codec.base64.H,g=0,h=sjcl.bitArray.bitLength(a);if(c)f=f.substr(0,62)+"-_";for(c=0;d.length*6<h;){d+=f.charAt((g^a[c]>>>e)>>>26);if(e<6){g=a[c]<<6-e;e+=26;c++}else{g<<=6;e-=6}}for(;d.length&3&&!b;)d+="=";return d},toBits:function(a,b){a=a.replace(/\s|=/g,"");var c=[],d=0,e=sjcl.codec.base64.H,f=0,g;if(b)e=e.substr(0,62)+"-_";for(b=0;b<a.length;b++){g=e.indexOf(a.charAt(b));
if(g<0)throw new sjcl.exception.invalid("this isn't base64!");if(d>26){d-=26;c.push(f^g>>>d);f=g<<32-d}else{d+=6;f^=g<<32-d}}d&56&&c.push(sjcl.bitArray.partial(d&56,f,1));return c}};sjcl.codec.base64url={fromBits:function(a){return sjcl.codec.base64.fromBits(a,1,1)},toBits:function(a){return sjcl.codec.base64.toBits(a,1)}};sjcl.hash.sha256=function(a){this.a[0]||this.B();if(a){this.p=a.p.slice(0);this.k=a.k.slice(0);this.f=a.f}else this.reset()};sjcl.hash.sha256.hash=function(a){return(new sjcl.hash.sha256).update(a).finalize()};
sjcl.hash.sha256.prototype={blockSize:512,reset:function(){this.p=this.O.slice(0);this.k=[];this.f=0;return this},update:function(a){if(typeof a==="string")a=sjcl.codec.utf8String.toBits(a);var b,c=this.k=sjcl.bitArray.concat(this.k,a);b=this.f;a=this.f=b+sjcl.bitArray.bitLength(a);for(b=512+b&-512;b<=a;b+=512)this.G(c.splice(0,16));return this},finalize:function(){var a,b=this.k,c=this.p;b=sjcl.bitArray.concat(b,[sjcl.bitArray.partial(1,1)]);for(a=b.length+2;a&15;a++)b.push(0);b.push(Math.floor(this.f/
4294967296));for(b.push(this.f|0);b.length;)this.G(b.splice(0,16));this.reset();return c},O:[],a:[],B:function(){function a(e){return(e-Math.floor(e))*0x100000000|0}var b=0,c=2,d;a:for(;b<64;c++){for(d=2;d*d<=c;d++)if(c%d===0)continue a;if(b<8)this.O[b]=a(Math.pow(c,0.5));this.a[b]=a(Math.pow(c,1/3));b++}},G:function(a){var b,c,d=a.slice(0),e=this.p,f=this.a,g=e[0],h=e[1],i=e[2],j=e[3],k=e[4],l=e[5],m=e[6],n=e[7];for(a=0;a<64;a++){if(a<16)b=d[a];else{b=d[a+1&15];c=d[a+14&15];b=d[a&15]=(b>>>7^b>>>18^
b>>>3^b<<25^b<<14)+(c>>>17^c>>>19^c>>>10^c<<15^c<<13)+d[a&15]+d[a+9&15]|0}b=b+n+(k>>>6^k>>>11^k>>>25^k<<26^k<<21^k<<7)+(m^k&(l^m))+f[a];n=m;m=l;l=k;k=j+b|0;j=i;i=h;h=g;g=b+(h&i^j&(h^i))+(h>>>2^h>>>13^h>>>22^h<<30^h<<19^h<<10)|0}e[0]=e[0]+g|0;e[1]=e[1]+h|0;e[2]=e[2]+i|0;e[3]=e[3]+j|0;e[4]=e[4]+k|0;e[5]=e[5]+l|0;e[6]=e[6]+m|0;e[7]=e[7]+n|0}};
sjcl.mode.ccm={name:"ccm",encrypt:function(a,b,c,d,e){var f,g=b.slice(0),h=sjcl.bitArray,i=h.bitLength(c)/8,j=h.bitLength(g)/8;e=e||64;d=d||[];if(i<7)throw new sjcl.exception.invalid("ccm: iv must be at least 7 bytes");for(f=2;f<4&&j>>>8*f;f++);if(f<15-i)f=15-i;c=h.clamp(c,8*(15-f));b=sjcl.mode.ccm.J(a,b,c,d,e,f);g=sjcl.mode.ccm.l(a,g,c,b,e,f);return h.concat(g.data,g.tag)},decrypt:function(a,b,c,d,e){e=e||64;d=d||[];var f=sjcl.bitArray,g=f.bitLength(c)/8,h=f.bitLength(b),i=f.clamp(b,h-e),j=f.bitSlice(b,
h-e);h=(h-e)/8;if(g<7)throw new sjcl.exception.invalid("ccm: iv must be at least 7 bytes");for(b=2;b<4&&h>>>8*b;b++);if(b<15-g)b=15-g;c=f.clamp(c,8*(15-b));i=sjcl.mode.ccm.l(a,i,c,j,e,b);a=sjcl.mode.ccm.J(a,i.data,c,d,e,b);if(!f.equal(i.tag,a))throw new sjcl.exception.corrupt("ccm: tag doesn't match");return i.data},J:function(a,b,c,d,e,f){var g=[],h=sjcl.bitArray,i=h.j;e/=8;if(e%2||e<4||e>16)throw new sjcl.exception.invalid("ccm: invalid tag length");if(d.length>0xffffffff||b.length>0xffffffff)throw new sjcl.exception.bug("ccm: can't deal with 4GiB or more data");
f=[h.partial(8,(d.length?64:0)|e-2<<2|f-1)];f=h.concat(f,c);f[3]|=h.bitLength(b)/8;f=a.encrypt(f);if(d.length){c=h.bitLength(d)/8;if(c<=65279)g=[h.partial(16,c)];else if(c<=0xffffffff)g=h.concat([h.partial(16,65534)],[c]);g=h.concat(g,d);for(d=0;d<g.length;d+=4)f=a.encrypt(i(f,g.slice(d,d+4).concat([0,0,0])))}for(d=0;d<b.length;d+=4)f=a.encrypt(i(f,b.slice(d,d+4).concat([0,0,0])));return h.clamp(f,e*8)},l:function(a,b,c,d,e,f){var g,h=sjcl.bitArray;g=h.j;var i=b.length,j=h.bitLength(b);c=h.concat([h.partial(8,
f-1)],c).concat([0,0,0]).slice(0,4);d=h.bitSlice(g(d,a.encrypt(c)),0,e);if(!i)return{tag:d,data:[]};for(g=0;g<i;g+=4){c[3]++;e=a.encrypt(c);b[g]^=e[0];b[g+1]^=e[1];b[g+2]^=e[2];b[g+3]^=e[3]}return{tag:d,data:h.clamp(b,j)}}};
sjcl.mode.ocb2={name:"ocb2",encrypt:function(a,b,c,d,e,f){if(sjcl.bitArray.bitLength(c)!==128)throw new sjcl.exception.invalid("ocb iv must be 128 bits");var g,h=sjcl.mode.ocb2.D,i=sjcl.bitArray,j=i.j,k=[0,0,0,0];c=h(a.encrypt(c));var l,m=[];d=d||[];e=e||64;for(g=0;g+4<b.length;g+=4){l=b.slice(g,g+4);k=j(k,l);m=m.concat(j(c,a.encrypt(j(c,l))));c=h(c)}l=b.slice(g);b=i.bitLength(l);g=a.encrypt(j(c,[0,0,0,b]));l=i.clamp(j(l.concat([0,0,0]),g),b);k=j(k,j(l.concat([0,0,0]),g));k=a.encrypt(j(k,j(c,h(c))));
if(d.length)k=j(k,f?d:sjcl.mode.ocb2.pmac(a,d));return m.concat(i.concat(l,i.clamp(k,e)))},decrypt:function(a,b,c,d,e,f){if(sjcl.bitArray.bitLength(c)!==128)throw new sjcl.exception.invalid("ocb iv must be 128 bits");e=e||64;var g=sjcl.mode.ocb2.D,h=sjcl.bitArray,i=h.j,j=[0,0,0,0],k=g(a.encrypt(c)),l,m,n=sjcl.bitArray.bitLength(b)-e,o=[];d=d||[];for(c=0;c+4<n/32;c+=4){l=i(k,a.decrypt(i(k,b.slice(c,c+4))));j=i(j,l);o=o.concat(l);k=g(k)}m=n-c*32;l=a.encrypt(i(k,[0,0,0,m]));l=i(l,h.clamp(b.slice(c),
m).concat([0,0,0]));j=i(j,l);j=a.encrypt(i(j,i(k,g(k))));if(d.length)j=i(j,f?d:sjcl.mode.ocb2.pmac(a,d));if(!h.equal(h.clamp(j,e),h.bitSlice(b,n)))throw new sjcl.exception.corrupt("ocb: tag doesn't match");return o.concat(h.clamp(l,m))},pmac:function(a,b){var c,d=sjcl.mode.ocb2.D,e=sjcl.bitArray,f=e.j,g=[0,0,0,0],h=a.encrypt([0,0,0,0]);h=f(h,d(d(h)));for(c=0;c+4<b.length;c+=4){h=d(h);g=f(g,a.encrypt(f(h,b.slice(c,c+4))))}b=b.slice(c);if(e.bitLength(b)<128){h=f(h,d(h));b=e.concat(b,[2147483648|0,0,
0,0])}g=f(g,b);return a.encrypt(f(d(f(h,d(h))),g))},D:function(a){return[a[0]<<1^a[1]>>>31,a[1]<<1^a[2]>>>31,a[2]<<1^a[3]>>>31,a[3]<<1^(a[0]>>>31)*135]}};
sjcl.mode.gcm={name:"gcm",encrypt:function(a,b,c,d,e){var f=b.slice(0);b=sjcl.bitArray;e=e||128;d=d||[];a=sjcl.mode.gcm.l(true,a,f,d,c,e);return b.concat(a.data,a.tag)},decrypt:function(a,b,c,d,e){var f=b.slice(0),g=sjcl.bitArray,h=g.bitLength(f);e=e||128;d=d||[];if(e<=h){b=g.bitSlice(f,h-e);f=g.bitSlice(f,0,h-e)}else{b=f;f=[]}a=sjcl.mode.gcm.l(false,a,f,d,c,e);if(!g.equal(a.tag,b))throw new sjcl.exception.corrupt("gcm: tag doesn't match");return a.data},T:function(a,b){var c,d,e,f,g=sjcl.bitArray.j;
d=[0,0,0,0];e=b.slice(0);for(b=0;b<128;b++){if(c=(a[Math.floor(b/32)]&1<<31-b%32)!==0)d=g(d,e);f=(e[3]&1)!==0;for(c=3;c>0;c--)e[c]=e[c]>>>1|(e[c-1]&1)<<31;e[0]>>>=1;if(f)e[0]^=-0x1f000000}return d},e:function(a,b,c){var d,e=c.length;b=b.slice(0);for(d=0;d<e;d+=4){b[0]^=0xffffffff&c[d];b[1]^=0xffffffff&c[d+1];b[2]^=0xffffffff&c[d+2];b[3]^=0xffffffff&c[d+3];b=sjcl.mode.gcm.T(b,a)}return b},l:function(a,b,c,d,e,f){var g,h,i,j,k,l,m,n,o=sjcl.bitArray;l=c.length;m=o.bitLength(c);n=o.bitLength(d);h=o.bitLength(e);
g=b.encrypt([0,0,0,0]);if(h===96){e=e.slice(0);e=o.concat(e,[1])}else{e=sjcl.mode.gcm.e(g,[0,0,0,0],e);e=sjcl.mode.gcm.e(g,e,[0,0,Math.floor(h/0x100000000),h&0xffffffff])}h=sjcl.mode.gcm.e(g,[0,0,0,0],d);k=e.slice(0);d=h.slice(0);a||(d=sjcl.mode.gcm.e(g,h,c));for(j=0;j<l;j+=4){k[3]++;i=b.encrypt(k);c[j]^=i[0];c[j+1]^=i[1];c[j+2]^=i[2];c[j+3]^=i[3]}c=o.clamp(c,m);if(a)d=sjcl.mode.gcm.e(g,h,c);a=[Math.floor(n/0x100000000),n&0xffffffff,Math.floor(m/0x100000000),m&0xffffffff];d=sjcl.mode.gcm.e(g,d,a);i=
b.encrypt(e);d[0]^=i[0];d[1]^=i[1];d[2]^=i[2];d[3]^=i[3];return{tag:o.bitSlice(d,0,f),data:c}}};sjcl.misc.hmac=function(a,b){this.N=b=b||sjcl.hash.sha256;var c=[[],[]],d=b.prototype.blockSize/32;this.n=[new b,new b];if(a.length>d)a=b.hash(a);for(b=0;b<d;b++){c[0][b]=a[b]^909522486;c[1][b]=a[b]^1549556828}this.n[0].update(c[0]);this.n[1].update(c[1])};sjcl.misc.hmac.prototype.encrypt=sjcl.misc.hmac.prototype.mac=function(a){a=(new this.N(this.n[0])).update(a).finalize();return(new this.N(this.n[1])).update(a).finalize()};
sjcl.misc.pbkdf2=function(a,b,c,d,e){c=c||1E3;if(d<0||c<0)throw sjcl.exception.invalid("invalid params to pbkdf2");if(typeof a==="string")a=sjcl.codec.utf8String.toBits(a);e=e||sjcl.misc.hmac;a=new e(a);var f,g,h,i,j=[],k=sjcl.bitArray;for(i=1;32*j.length<(d||1);i++){e=f=a.encrypt(k.concat(b,[i]));for(g=1;g<c;g++){f=a.encrypt(f);for(h=0;h<f.length;h++)e[h]^=f[h]}j=j.concat(e)}if(d)j=k.clamp(j,d);return j};
sjcl.random={randomWords:function(a,b){var c=[];b=this.isReady(b);var d;if(b===0)throw new sjcl.exception.notReady("generator isn't seeded");else b&2&&this.W(!(b&1));for(b=0;b<a;b+=4){(b+1)%0x10000===0&&this.M();d=this.A();c.push(d[0],d[1],d[2],d[3])}this.M();return c.slice(0,a)},setDefaultParanoia:function(a){this.w=a},addEntropy:function(a,b,c){c=c||"user";var d,e,f=(new Date).valueOf(),g=this.s[c],h=this.isReady(),i=0;d=this.I[c];if(d===undefined)d=this.I[c]=this.S++;if(g===undefined)g=this.s[c]=
0;this.s[c]=(this.s[c]+1)%this.b.length;switch(typeof a){case "number":if(b===undefined)b=1;this.b[g].update([d,this.z++,1,b,f,1,a|0]);break;case "object":c=Object.prototype.toString.call(a);if(c==="[object Uint32Array]"){e=[];for(c=0;c<a.length;c++)e.push(a[c]);a=e}else{if(c!=="[object Array]")i=1;for(c=0;c<a.length&&!i;c++)if(typeof a[c]!="number")i=1}if(!i){if(b===undefined)for(c=b=0;c<a.length;c++)for(e=a[c];e>0;){b++;e>>>=1}this.b[g].update([d,this.z++,2,b,f,a.length].concat(a))}break;case "string":if(b===
undefined)b=a.length;this.b[g].update([d,this.z++,3,b,f,a.length]);this.b[g].update(a);break;default:i=1}if(i)throw new sjcl.exception.bug("random: addEntropy only supports number, array of numbers or string");this.m[g]+=b;this.g+=b;if(h===0){this.isReady()!==0&&this.L("seeded",Math.max(this.h,this.g));this.L("progress",this.getProgress())}},isReady:function(a){a=this.F[a!==undefined?a:this.w];return this.h&&this.h>=a?this.m[0]>80&&(new Date).valueOf()>this.P?3:1:this.g>=a?2:0},getProgress:function(a){a=
this.F[a?a:this.w];return this.h>=a?1:this.g>a?1:this.g/a},startCollectors:function(){if(!this.o){if(window.addEventListener){window.addEventListener("load",this.q,false);window.addEventListener("mousemove",this.r,false)}else if(document.attachEvent){document.attachEvent("onload",this.q);document.attachEvent("onmousemove",this.r)}else throw new sjcl.exception.bug("can't attach event");this.o=true}},stopCollectors:function(){if(this.o){if(window.removeEventListener){window.removeEventListener("load",
this.q,false);window.removeEventListener("mousemove",this.r,false)}else if(window.detachEvent){window.detachEvent("onload",this.q);window.detachEvent("onmousemove",this.r)}this.o=false}},addEventListener:function(a,b){this.t[a][this.R++]=b},removeEventListener:function(a,b){var c;a=this.t[a];var d=[];for(c in a)a.hasOwnProperty(c)&&a[c]===b&&d.push(c);for(b=0;b<d.length;b++){c=d[b];delete a[c]}},b:[new sjcl.hash.sha256],m:[0],C:0,s:{},z:0,I:{},S:0,h:0,g:0,P:0,a:[0,0,0,0,0,0,0,0],d:[0,0,0,0],u:undefined,
w:6,o:false,t:{progress:{},seeded:{}},R:0,F:[0,48,64,96,128,192,0x100,384,512,768,1024],A:function(){for(var a=0;a<4;a++){this.d[a]=this.d[a]+1|0;if(this.d[a])break}return this.u.encrypt(this.d)},M:function(){this.a=this.A().concat(this.A());this.u=new sjcl.cipher.aes(this.a)},V:function(a){this.a=sjcl.hash.sha256.hash(this.a.concat(a));this.u=new sjcl.cipher.aes(this.a);for(a=0;a<4;a++){this.d[a]=this.d[a]+1|0;if(this.d[a])break}},W:function(a){var b=[],c=0,d;this.P=b[0]=(new Date).valueOf()+3E4;for(d=
0;d<16;d++)b.push(Math.random()*0x100000000|0);for(d=0;d<this.b.length;d++){b=b.concat(this.b[d].finalize());c+=this.m[d];this.m[d]=0;if(!a&&this.C&1<<d)break}if(this.C>=1<<this.b.length){this.b.push(new sjcl.hash.sha256);this.m.push(0)}this.g-=c;if(c>this.h)this.h=c;this.C++;this.V(b)},r:function(a){sjcl.random.addEntropy([a.x||a.clientX||a.offsetX||0,a.y||a.clientY||a.offsetY||0],2,"mouse")},q:function(){sjcl.random.addEntropy((new Date).valueOf(),2,"loadtime")},L:function(a,b){var c;a=sjcl.random.t[a];
var d=[];for(c in a)a.hasOwnProperty(c)&&d.push(a[c]);for(c=0;c<d.length;c++)d[c](b)}};try{var s=new Uint32Array(32);crypto.getRandomValues(s);sjcl.random.addEntropy(s,1024,"crypto['getRandomValues']")}catch(t){}
sjcl.json={defaults:{v:1,iter:1E3,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes"},encrypt:function(a,b,c,d){c=c||{};d=d||{};var e=sjcl.json,f=e.c({iv:sjcl.random.randomWords(4,0)},e.defaults),g;e.c(f,c);c=f.adata;if(typeof f.salt==="string")f.salt=sjcl.codec.base64.toBits(f.salt);if(typeof f.iv==="string")f.iv=sjcl.codec.base64.toBits(f.iv);if(!sjcl.mode[f.mode]||!sjcl.cipher[f.cipher]||typeof a==="string"&&f.iter<=100||f.ts!==64&&f.ts!==96&&f.ts!==128||f.ks!==128&&f.ks!==192&&f.ks!==0x100||f.iv.length<
2||f.iv.length>4)throw new sjcl.exception.invalid("json encrypt: invalid parameters");if(typeof a==="string"){g=sjcl.misc.cachedPbkdf2(a,f);a=g.key.slice(0,f.ks/32);f.salt=g.salt}if(typeof b==="string")b=sjcl.codec.utf8String.toBits(b);if(typeof c==="string")c=sjcl.codec.utf8String.toBits(c);g=new sjcl.cipher[f.cipher](a);e.c(d,f);d.key=a;f.ct=sjcl.mode[f.mode].encrypt(g,b,f.iv,c,f.ts);return e.encode(f)},decrypt:function(a,b,c,d){c=c||{};d=d||{};var e=sjcl.json;b=e.c(e.c(e.c({},e.defaults),e.decode(b)),
c,true);var f;c=b.adata;if(typeof b.salt==="string")b.salt=sjcl.codec.base64.toBits(b.salt);if(typeof b.iv==="string")b.iv=sjcl.codec.base64.toBits(b.iv);if(!sjcl.mode[b.mode]||!sjcl.cipher[b.cipher]||typeof a==="string"&&b.iter<=100||b.ts!==64&&b.ts!==96&&b.ts!==128||b.ks!==128&&b.ks!==192&&b.ks!==0x100||!b.iv||b.iv.length<2||b.iv.length>4)throw new sjcl.exception.invalid("json decrypt: invalid parameters");if(typeof a==="string"){f=sjcl.misc.cachedPbkdf2(a,b);a=f.key.slice(0,b.ks/32);b.salt=f.salt}if(typeof c===
"string")c=sjcl.codec.utf8String.toBits(c);f=new sjcl.cipher[b.cipher](a);c=sjcl.mode[b.mode].decrypt(f,b.ct,b.iv,c,b.ts);e.c(d,b);d.key=a;return sjcl.codec.utf8String.fromBits(c)},encode:function(a){var b,c="{",d="";for(b in a)if(a.hasOwnProperty(b)){if(!b.match(/^[a-z0-9]+$/i))throw new sjcl.exception.invalid("json encode: invalid property name");c+=d+'"'+b+'":';d=",";switch(typeof a[b]){case "number":case "boolean":c+=a[b];break;case "string":c+='"'+escape(a[b])+'"';break;case "object":c+='"'+
sjcl.codec.base64.fromBits(a[b],0)+'"';break;default:throw new sjcl.exception.bug("json encode: unsupported type");}}return c+"}"},decode:function(a){a=a.replace(/\s/g,"");if(!a.match(/^\{.*\}$/))throw new sjcl.exception.invalid("json decode: this isn't json!");a=a.replace(/^\{|\}$/g,"").split(/,/);var b={},c,d;for(c=0;c<a.length;c++){if(!(d=a[c].match(/^(?:(["']?)([a-z][a-z0-9]*)\1):(?:(\d+)|"([a-z0-9+\/%*_.@=\-]*)")$/i)))throw new sjcl.exception.invalid("json decode: this isn't json!");b[d[2]]=
d[3]?parseInt(d[3],10):d[2].match(/^(ct|salt|iv)$/)?sjcl.codec.base64.toBits(d[4]):unescape(d[4])}return b},c:function(a,b,c){if(a===undefined)a={};if(b===undefined)return a;var d;for(d in b)if(b.hasOwnProperty(d)){if(c&&a[d]!==undefined&&a[d]!==b[d])throw new sjcl.exception.invalid("required parameter overridden");a[d]=b[d]}return a},Y:function(a,b){var c={},d;for(d in a)if(a.hasOwnProperty(d)&&a[d]!==b[d])c[d]=a[d];return c},X:function(a,b){var c={},d;for(d=0;d<b.length;d++)if(a[b[d]]!==undefined)c[b[d]]=
a[b[d]];return c}};sjcl.encrypt=sjcl.json.encrypt;sjcl.decrypt=sjcl.json.decrypt;sjcl.misc.U={};sjcl.misc.cachedPbkdf2=function(a,b){var c=sjcl.misc.U,d;b=b||{};d=b.iter||1E3;c=c[a]=c[a]||{};d=c[d]=c[d]||{firstSalt:b.salt&&b.salt.length?b.salt.slice(0):sjcl.random.randomWords(2,0)};c=b.salt===undefined?d.firstSalt:b.salt;d[c]=d[c]||sjcl.misc.pbkdf2(a,c,b.iter);return{key:d[c].slice(0),salt:c.slice(0)}};

/* YgD0x8gtO-s */});
__d("EncryptedLocalStorage",["StanfordCrypto","JSLogger","copyProperties"],function(a,b,c,d,e,f){var g=b('StanfordCrypto'),h=b('JSLogger').create('encrypted_local_storage'),i=b('copyProperties');function j(k){this._store=a.localStorage;this._password=k;}i(j.prototype,{available:function(){try{return !!a.localStorage;}catch(k){return false;}},keys:function(){var k=[];for(var l=0;l<this._store.length;l++)k.push(this._store.key(l));return k;},get:function(k){var l=this._store.getItem(k);if(l==null)return null;try{return g.decrypt(this._password,l);}catch(m){h.error('decryption_fail',{key:k});return null;}},set:function(k,l){var m=g.encrypt(this._password,l);this._store.setItem(k,m);},remove:function(k){this._store.removeItem(k);},clear:function(){this._store.clear();}});e.exports=j;});
__d("MercuryDrafts",["CacheStorage","EncryptedLocalStorage","MercuryConfig","MercurySingletonMixin","copyProperties"],function(a,b,c,d,e,f){var g=b('CacheStorage'),h=b('EncryptedLocalStorage'),i=b('MercuryConfig'),j=b('MercurySingletonMixin'),k=b('copyProperties');function l(m){this._fbid=m;var n=new h(i.local_storage_crypto);this._drafts=new g(n,'mercury-drafts:'+this._fbid);}k(l,j);k(l.prototype,{createDraft:function(m,n){return {thread_id:m,message:n};},isDraftEmpty:function(m){if(!m)return true;if(!m.message)return true;var n=m.message;if(!n.body)return true;return false;},isMessageEqualTo:function(m,n){var o=null,p=null;if(m.message&&m.message.body)o=m.message.body;if(n&&n.body)p=n.body;return o==p;},saveDraft:function(m){if(this.isDraftEmpty(m)){this.removeDraft(m.thread_id);}else this._drafts.set(m.thread_id,m);},removeDraft:function(m){this._drafts.remove(m);},getDraft:function(m){return this._drafts.get(m,{});}});e.exports=l;});
__d("Ellipsizer",["CSS","DOM","Style","UserAgent","cx"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DOM'),i=b('Style'),j=b('UserAgent'),k=b('cx'),l=1.3;function m(n){this.elements=[];n.forEach(function(o){g.addClass(o,"_6qy");this.elements.push({node:o});}.bind(this));return this;}m.prototype._analyzeElements=function(){var n;this.elements.forEach(function(o){n=o.node;while(n.children.length===1)n=n.children[0];if(n===o.node)i.set(n,'width','');j.ie()&&i.set(n,'position','absolute');o.width=n.offsetWidth;j.ie()&&i.set(n,'position','');});this.elements.sort(function(o,p){return o.width-p.width;});};m.prototype.confineWithin=function(n){this._analyzeElements();var o=n;this.elements.forEach(function(p,q){var r=Math.floor(o/(this.elements.length-q));if(p.width<=r||p.width<=0||r<=0||(p.width<=r*l&&o>=r*l)){g.removeClass(p.node,"_6s5");i.set(p.node,'width','');o-=p.width;if(p.titleSet){p.node.setAttribute('title','');p.titleSet=false;}}else{g.addClass(p.node,"_6s5");i.set(p.node,'width',r+'px');o-=r;if(!p.titleSet&&!p.node.getAttribute('title')){p.node.setAttribute('title',h.getText(p.node));p.titleSet=true;}}}.bind(this));};e.exports=m;});
__d("TabIndexDelegator",["JSXDOM","CSS","DOM","Event","Focus","copyProperties"],function(a,b,c,d,e,f){var g=b('JSXDOM'),h=b('CSS'),i=b('DOM'),j=b('Event'),k=b('Focus'),l=b('copyProperties');function m(n,o){this._placeholder=o||g.button(null);this._placeholder.setAttribute('aria-describedby',i.getID(n));h.addClass(this._placeholder,'accessible_elem');this._listener=j.listen(this._placeholder,'click',function(){n.click();});k.relocate(this._placeholder,n);this.enable();}l(m.prototype,{enable:function(){h.show(this._placeholder);},disable:function(){h.hide(this._placeholder);},getPlaceholder:function(){return this._placeholder;},destroy:function(){this._listener.remove();i.remove(this._placeholder);}});e.exports=m;});
__d("VaultBoxURI",[],function(a,b,c,d,e,f){var g={PHOTOS_SYNCED:'photos_synced',isVaultBoxURI:function(h){var i=new RegExp("\/"+g.PHOTOS_SYNCED+"\/?$");return h.getPath().match(i)&&h.getQueryData().hasOwnProperty('view_image');},isVaultArchiveURI:function(h){var i=new RegExp("\/"+g.PHOTOS_SYNCED+"\/?$");return h.getPath().match(i);}};e.exports=g;});
__d("WebMessengerForwardedMessages",["Event","CSS","DOM","MercuryMessages","WebMessengerThreadMessagesRenderer","WebMessengerEvents","WebMessengerSubscriptionsHandler","copyProperties","tx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('CSS'),i=b('DOM'),j=b('MercuryMessages').get(),k=b('WebMessengerThreadMessagesRenderer'),l=b('WebMessengerEvents'),m=b('WebMessengerSubscriptionsHandler'),n=b('copyProperties'),o=b('tx');function p(q,r,s,t){this._parent=q;this._title=r;this._shelf=s;this._closeButton=t;this._forwardedMessages=[];m.addSubscriptions(g.listen(this._closeButton,'click',this.clear.bind(this)));}n(p.prototype,{setForwardedMessages:function(q){this._forwardedMessages=q;this._render();},clear:function(){this._forwardedMessages=[];this._render();},getForwardedMessages:function(){return this._forwardedMessages||[];},_render:function(){i.empty(this._shelf);var q=this._forwardedMessages.length;if(q){var r=(q===1)?"1 forwarded message":o._("{num} forwarded messages",{num:q});i.setContent(this._title,r);k.renderForwardedMessages(this._shelf,j.getMessagesFromIDs(this._forwardedMessages));}h.conditionShow(this._parent,q);l.detailDOMChanged();}});e.exports=p;});
__d("WebMessengerDetailViewBottomShelfControl",["Event","Arbiter","AsyncDialog","AsyncRequest","Button","CSS","DOM","MercuryDrafts","Ellipsizer","Focus","MercuryFolders","Input","Keys","Locale","MercuryAPIArgsSource","MercuryConfig","MercuryFileUploader","MercuryPhotoUploader","MercuryShareLinkUploader","MercurySourceType","MercuryMessages","MessagesEmoticonView","PageTransitions","WebMessengerPermalinks","PhotosUploadWaterfall","WebMessengerPreferences","Run","WebMessengerStateConstants","WebMessengerStateManager","Style","TabIndexDelegator","WebMessengerTemplates","TextAreaControl","MercuryThreadInformer","MercuryThreads","VaultBoxURI","Vector","WaterfallIDGenerator","WebMessengerEvents","WebMessengerForwardedMessages","WebMessengerSubscriptionsHandler","copyProperties","csx","tx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('AsyncDialog'),j=b('AsyncRequest'),k=b('Button'),l=b('CSS'),m=b('DOM'),n=b('MercuryDrafts').get(),o=b('Ellipsizer'),p=b('Focus'),q=b('MercuryFolders'),r=b('Input'),s=b('Keys'),t=b('Locale'),u=b('MercuryAPIArgsSource'),v=b('MercuryConfig'),w=b('MercuryFileUploader'),x=b('MercuryPhotoUploader'),y=b('MercuryShareLinkUploader'),z=b('MercurySourceType'),aa=b('MercuryMessages').get(),ba=b('MessagesEmoticonView'),ca=b('PageTransitions'),da=b('WebMessengerPermalinks'),ea=b('PhotosUploadWaterfall'),fa=b('WebMessengerPreferences'),ga=b('Run'),ha=b('WebMessengerStateConstants'),ia=b('WebMessengerStateManager'),ja=b('Style'),ka=b('TabIndexDelegator'),la=b('WebMessengerTemplates'),ma=b('TextAreaControl'),na=b('MercuryThreadInformer').get(),oa=b('MercuryThreads').get(),pa=b('VaultBoxURI'),qa=b('Vector'),ra=b('WaterfallIDGenerator'),sa=b('WebMessengerEvents'),ta=b('WebMessengerForwardedMessages'),ua=b('WebMessengerSubscriptionsHandler'),va=b('copyProperties'),wa=b('csx'),xa=b('csx'),ya=b('tx'),za="_1rh";function ab(ec,fc){this._manager=ec;this._rootElement=fc;this._sendOnEnterDefault=fa.sendOnEnter;m.empty(this._rootElement);var gc=la[':fb:web-messenger:read-view:bottom-shelf'].build();m.setContent(this._rootElement,gc.getRoot());this._bottomShelfToolbar=gc.getNode('toolbar');this._bottomShelfComposer=gc.getNode('composer');this._bottomShelfButtons=gc.getNode('buttons');this._autogrowContainer=gc.getNode('autogrowContainer');this._composerBox=gc.getNode('composerTextarea');this._composerGrid=gc.getNode('composerGrid');this._sendContainer=gc.getNode('sendContainer');this._replyButton=gc.getNode('replyButton');this._uploadingWarning=gc.getNode('uploadingWarning');this._replyButtonLabel=m.find(this._sendContainer,"._1ri");this._sendOnEnterButton=gc.getNode('sendOnEnterButton');this._loadingIndicator=gc.getNode('loadingIndicator');this._cannotReplyAlert=gc.getNode('noReplyMessage');this._ariaOwns=this._composerBox.getAttribute('aria-owns');this._waterfallID=null;ua.addSubscriptions(g.listen(this._autogrowContainer,'click',this.focusComposer.bind(this)),sa.subscribe(sa.UPDATE_SELECTION,dc.curry(this)),sa.subscribe(sa.FOCUS_COMPOSER,this.focusComposer.bind(this)));this._emoteWrapper=gc.getNode('emoteWrapper');this._emoticonsPanel=new ba(gc.getNode('emoticons'),this._composerBox);this._messageSent=false;var hc=gc.getNode('attachButtonForm');if(hc)this._fileUploader=new w(gc.getNode('attachmentShelf'),hc,gc.getNode('fileInput'),gc.getNode('attachID'));this._forwardedMessages=new ta(gc.getNode('forwardedMessages'),gc.getNode('forwardedMessagesTitle'),gc.getNode('forwardedMessagesShelf'),gc.getNode('forwardedMessagesCloseButton'));this._shareLinkUploader=new y(gc.getNode('shareStage'),gc.getNode('shareStageContent'),gc.getNode('shareStageLoadingIndicator'),gc.getNode('shareStageCloseButton'),this._composerBox);p.relocate(this._replyButton,this._replyButtonLabel);this._delegator=new ka(this._replyButtonLabel);m.prependContent(this._bottomShelfToolbar,this._delegator.getPlaceholder());d(['TypingDetectorController'],function(jc){this._typingDetector=new jc(null,this._composerBox,'web-messenger',null,null);cc(this);}.bind(this));this._photoUploader=new x(this._composerGrid,gc.getNode('photoButton'),ua,gc.getNode('composer'));ua.addSubscriptions(this._photoUploader.subscribe('dom-updated',sa.detailDOMChanged.bind(sa)),this._photoUploader.subscribe('menu-show',function(){if(!this._waterfallID){this.setWaterfallID(ra.generate());this.waterfallStep(ea.BEGIN);}}.bind(this)),this._photoUploader.subscribe('selection-start',function(){this.waterfallStep(ea.SELECT_START);}.bind(this)),this._photoUploader.subscribe('upload-started',function(jc,kc){this.waterfallStep(ea.UPLOAD_START,{count:kc.imageCount});}.bind(this)),this._photoUploader.subscribe('upload-completed',function(jc,kc){for(var lc=0;lc<kc.fbids.length;++lc)this.waterfallStep(ea.ONE_UPLOAD_DONE);}.bind(this)),this._photoUploader.subscribe('all-uploads-completed',function(){if(this._blockedOnUpload){rb(this,false);pb(this);}this.waterfallStep(ea.ALL_UPLOADS_DONE);}.bind(this)));var ic=m.scry(this._bottomShelfToolbar,"._6q-");ic.push(gc.getNode('sendOnEnterButtonLabel'));this._ellipsizer=new o(ic);if(this._fileUploader)ua.addSubscriptions(this._fileUploader.subscribe('all-uploads-completed',function(){if(this._blockedOnUpload){rb(this,false);pb(this);}}.bind(this)),this._fileUploader.subscribe('upload-canceled',rb.curry(this,false)),this._fileUploader.subscribe('dom-updated',sa.detailDOMChanged.bind(sa)));this._confirmationSubscription=ia.registerConfirmationBeforeStateUpdate(function(jc,kc,lc){if(yb(this)&&bb(this,kc,lc)){this._stateUpdateConfirmed=true;return "You haven't sent your message.";}return false;}.bind(this));zb(this);ua.addSubscriptions(h.subscribe('page_transition',function(jc,kc){if(da.isWebMessengerURI(kc.uri))zb(this);}.bind(this)),this._shareLinkUploader.subscribe('link-detected',sa.detailDOMChanged.bind(sa)),this._shareLinkUploader.subscribe('closed',this.focusComposer.bind(this)));ma.getInstance(this._composerBox).subscribe('resize',function(){sa.detailDOMChanged();}.bind(this));bc(this);ua.addSubscriptions(g.listen(this._replyButtonLabel,'click',pb.curry(this)),g.listen(this._replyButton,'keydown',db.curry(this)),g.listen(this._composerBox,'keydown',db.curry(this)),g.listen(this._sendOnEnterButton,'click',hb.curry(this)),g.listen(gc.getNode('cancelButton'),'click',sb),g.listen(gc.getNode('deleteButton'),'click',tb.curry(this)),g.listen(gc.getNode('forwardButton'),'click',xb.curry(this)),g.listen(gc.getNode('reportSpamButton'),'click',vb.curry(this)),sa.subscribe(sa.DETAIL_DOM_CHANGED,eb.curry(this)));ua.addSubscriptions(na.subscribe('threads-updated',function(jc,kc){kc[this._threadID]&&this.updateView();}.bind(this)));}va(ab.prototype,{setWaterfallID:function(ec){if(this._waterfallID===ec)return;this._waterfallID=ec;this._photoUploader.setWaterfallID(ec);},waterfallStep:function(ec,fc){if(!this._waterfallID)return;ea.sendSignal(va({qn:this._waterfallID,step:ec,uploader:ea.APP_MESSENGER},fc||{}));},hideView:function(){l.hide(this._rootElement);},updateView:function(){var ec=ia.getCurrentDetailState();l.show(this._rootElement);var fc=ia.getCurrentStateData();bb(this,ec,fc)&&qb(this);l.hide(this._bottomShelfComposer);l.removeClass(this._bottomShelfComposer,'invisible_elem');l.hide(this._bottomShelfButtons);l.show(this._sendOnEnterButton);l.hide(this._cannotReplyAlert);jb(this,this._sendOnEnterDefault);switch(ec){case ha.DETAIL.RECENT_MESSAGES:case ha.DETAIL.SEARCH_CONTEXT:this._threadID=fc.thread_id;if(fc.message_action==ha.MESSAGE_ACTION.DELETE||fc.message_action==ha.MESSAGE_ACTION.FORWARD||fc.message_action==ha.MESSAGE_ACTION.REPORT_SPAM){ac(this,fc.message_action);}else if(this._threadID)oa.getThreadMeta(this._threadID,function(gc){if(oa.canReply(this._threadID)){l.show(this._bottomShelfComposer);bc(this);nb(this);}else{var hc=gc.recipients_loadable||gc.recipients_loadable===undefined,ic=hc?"You cannot reply to this conversation":"You cannot reply to this conversation. Either the recipient's account was disabled or its privacy settings don't allow replies.";l.show(this._cannotReplyAlert);m.setContent(this._cannotReplyAlert,ic);}cb(this,gc);}.bind(this));break;case ha.DETAIL.COMPOSE_MAIN:this._threadID=null;l.show(this._bottomShelfComposer);bc(this);l.hide(this._sendOnEnterButton);jb(this,false);cb(this,null);break;default:this._threadID=null;break;}cc(this);sa.detailDOMChanged();this._state=ec;},focusComposer:function(){this._composerBox.focus();},submitReply:function(){pb(this);},destroy:function(){this._emoticonsPanel&&this._emoticonsPanel.destroy();this._fileUploader&&this._fileUploader.destroy();ia.unregisterConfirmationBeforeStateUpdate(this._confirmationSubscription);}});function bb(ec,fc,gc){switch(fc){case ha.DETAIL.RECENT_MESSAGES:case ha.DETAIL.SEARCH_CONTEXT:return !gc.reuse_composer&&(ec._threadID!=gc.thread_id||ec._state!=fc);case ha.DETAIL.COMPOSE_MAIN:return gc.start;case ha.DETAIL.SEARCH_SNIPPET:case ha.DETAIL.SEARCH_THREAD_SNIPPET:return true;}return false;}function cb(ec,fc){var gc,hc;if(!fc){gc="Send";hc="Write a message...";}else if(fc.participants&&fc.participants.length<=2){gc="Reply";hc="Write a reply...";}else{gc="Reply All";hc="Write a reply...";}if(ec._composerBox.getAttribute('placeholder')!=hc)r.setPlaceholder(ec._composerBox,hc);k.setLabel(ec._replyButton,gc);mb(ec);}function db(ec,event){if(event.getModifiers().any)return;var fc=false;switch(event.keyCode){case s.SPACE:fc=event.getTarget()===ec._replyButton;break;case s.RETURN:var gc=!l.hasClass(ec._bottomShelfComposer,za),hc=event.getTarget()===ec._replyButton;fc=hc||gc;break;case s.UP:case s.DOWN:var ic=ia.getCurrentDetailState();if(ec._composerBox.value||ic!=ha.DETAIL.RECENT_MESSAGES)event.stop();break;}if(fc){pb(ec);ec.focusComposer();return false;}}function eb(ec){bc(ec);kb(ec);}function fb(ec){var fc=n.createDraft(ec._threadID,ob(ec));n.saveDraft(fc);}function gb(ec){n.removeDraft(ec._threadID);}function hb(ec){ib(ec);var fc=!ec._sendOnEnterDefault;ec.focusComposer();ec._sendOnEnterDefault=fc;fa.sendOnEnter=fc;var gc={action:'setPreferences',send_on_enter:fc};new j('/ajax/messaging/async.php').setData(gc).send();}function ib(ec){l.toggleClass(ec._bottomShelfComposer,za);mb(ec,true);sa.detailDOMChanged();}function jb(ec,fc){if(fc==l.hasClass(ec._bottomShelfComposer,za))ib(ec);}function kb(ec){var fc;if(l.hasClass(ec._bottomShelfComposer,za)){fc=lb(ec);}else fc=0;var gc=qa.getElementDimensions(ec._bottomShelfToolbar).x;ec._ellipsizer.confineWithin(gc-fc-120);}function lb(ec){return qa.getElementDimensions(ec._replyButtonLabel).x+20;}function mb(ec,fc){var gc='',hc='';if(!l.hasClass(ec._bottomShelfComposer,za)){hc=lb(ec)+'px';gc='-1';ec._delegator.disable();}else ec._delegator.enable();l.conditionClass(ec._sendContainer,'transition',fc);ec._replyButton.setAttribute('tabindex',gc);ja.set(ec._sendContainer,t.isRTL()?'right':'left',hc);}function nb(ec){if(!v.ChatSaveDraftsGK||r.getValue(ec._composerBox))return;var fc=ec._threadID,gc=n.getDraft(fc);if(gc&&gc.message){ec.focusComposer();r.setValue(ec._composerBox,gc.message.body);}}function ob(ec){var fc=ia.getCurrentStateData(),gc=aa.constructUserGeneratedMessageObject(r.getValue(ec._composerBox),z.TITAN_WEB,fc.thread_id,fc.participants),hc=ec._fileUploader&&ec._fileUploader.getAttachments();if(hc&&hc.length){gc.has_attachment=true;gc.raw_attachments=hc;}if(ec._photoUploader.getSelectedFBIDs().length>0){gc.has_attachment=true;gc.photo_fbids=ec._photoUploader.getSelectedFBIDs();}if(ec._shareLinkUploader.getAttachData()){gc.has_attachment=true;gc.content_attachment=ec._shareLinkUploader.getAttachData();}gc.forward_message_ids=ec._forwardedMessages.getForwardedMessages();gc.forward_count=gc.forward_message_ids.length;gc.force_sms=true;return gc;}function pb(ec){if((ec._fileUploader&&ec._fileUploader.isUploading())||ec._photoUploader.isUploading()){rb(ec,true);return;}var fc=ob(ec),gc=r.isEmpty(ec._composerBox);if((gc&&!fc.has_attachment&&!fc.forward_count)||(!fc.thread_id&&!fc.specific_to_list.length))return;l.show(ec._loadingIndicator);l.hide(ec._replyButtonLabel);ec._composerBox.setAttribute('disabled','disabled');ec.waterfallStep(ea.SESSION_POSTED);ec._sendSubscription=aa.sendMessage(fc,function(hc){ec.waterfallStep(ea.POST_PUBLISHED);gb(ec);qb(ec);ec._messageSent=true;var ic=q.getFromMeta(oa.getThreadMetaNow(hc));ia.updateDetailState(ha.DETAIL.RECENT_MESSAGES,{thread_id:hc,folder:ic});ec._messageSent=false;},u.WEBMESSENGER);}function qb(ec){r.reset(ec._composerBox);bc(ec);ec._typingDetector&&ec._typingDetector.resetState();ec._fileUploader&&ec._fileUploader.removeAttachments();ec._forwardedMessages.clear();ec._shareLinkUploader.clear();ec.setWaterfallID(null);if(ec._photoUploader.getSelectedFBIDs().length>0)ec._photoUploader.clear();l.hide(ec._loadingIndicator);l.show(ec._replyButtonLabel);ec._composerBox.removeAttribute('disabled');if(ec._sendSubscription){aa.unsubscribeSend(ec._sendSubscription);ec._sendSubscription=null;}rb(ec,false);}function rb(ec,fc){l.conditionShow(ec._uploadingWarning,fc);ec._blockedOnUpload=fc;}function sb(){var ec=ia.getCurrentDetailState(),fc=ia.getCurrentStateData();delete fc.message_action;ia.updateDetailState(ec,fc);}function tb(ec){var fc=ec._manager.getSelectedMessageIDs().length;i.send(new j('/ajax/mercury/delete_messages_dialog.php').setData({count:fc}),function(gc){gc.subscribe('confirm',ub.curry(ec,gc));});}function ub(ec,fc){var gc=ec._manager.getSelectedMessageIDs();aa.deleteMessages(ec._threadID,gc);fc.hide();var hc=ia.getCurrentStateData();if(hc.message_action){var ic=va({},hc);delete ic.message_action;ia.updateDetailState(ia.getCurrentDetailState(),ic);}}function vb(ec){var fc=ec._manager.getSelectedMessageIDs().length;i.send(new j('/ajax/mercury/mark_spam_messages_dialog.php').setData({count:fc}),function(gc){gc.subscribe('confirm',wb.curry(ec,gc));});}function wb(ec,fc){var gc=ec._manager.getSelectedMessageIDs();aa.markMessagesSpam(ec._threadID,gc);fc.hide();var hc=ia.getCurrentStateData();if(hc.message_action){var ic=va({},hc);delete ic.message_action;ia.updateDetailState(ia.getCurrentDetailState(),ic);}}function xb(ec){var fc=ec._manager.getSelectedMessageIDs();if(fc.length){ia.updateDetailState(ha.DETAIL.COMPOSE_MAIN,{start:true});ec._forwardedMessages.setForwardedMessages(fc);}}function yb(ec){if(ec._messageSent)return false;if(v.ChatSaveDraftsGK&&ec._threadID){fb(ec);return false;}if(!r.isEmpty(ec._composerBox))return true;var fc=ec._fileUploader&&ec._fileUploader.getAttachments();if((fc&&fc.length)||ec._shareLinkUploader.getAttachData()||ec._photoUploader.getSelectedFBIDs().length>0)return true;var gc=ia.getCurrentStateData(),hc=ia.getCurrentDetailState(),ic=hc==ha.DETAIL.COMPOSE_MAIN||hc==ha.DETAIL.COMPOSE_TYPEAHEAD_RESULTS||hc==ha.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS;if(ic&&!gc.start&&(gc.participants||[]).length)return true;if(ec._forwardedMessages.getForwardedMessages().length)return true;return false;}function zb(ec){ga.onBeforeUnload(function(){if(ec._stateUpdateConfirmed){ec._stateUpdateConfirmed=false;return;}var fc=ca.getNextURI(),gc=da.processURI(fc),hc=!gc||bb(ec,gc.detail_state,gc.data);if(!fc.getQueryData().hasOwnProperty('theater')&&!pa.isVaultBoxURI(fc)&&yb(ec)&&hc)return "You haven't sent your message.";},true);}function ac(ec,fc){l.show(ec._bottomShelfComposer);l.addClass(ec._bottomShelfComposer,'invisible_elem');l.conditionClass(ec._bottomShelfButtons,'delete',fc==ha.MESSAGE_ACTION.DELETE);l.conditionClass(ec._bottomShelfButtons,'forward',fc==ha.MESSAGE_ACTION.FORWARD);l.conditionClass(ec._bottomShelfButtons,'report_spam',fc==ha.MESSAGE_ACTION.REPORT_SPAM);l.show(ec._bottomShelfButtons);}function bc(ec){ja.set(ec._emoteWrapper,t.isRTL()?'right':'left',(ec._composerBox.clientWidth+22)+'px');}function cc(ec){if(ec._typingDetector){var fc=ec._threadID,gc=null;if(fc){gc=oa.getCanonicalUserInThread(fc);var hc=v.chat_multi_typ_send,ic=oa.getThreadMetaNow(fc);if((!hc||!ic||ic.is_canonical)&&!gc)fc=null;}ec._typingDetector.setUserAndThread(gc,fc);}}function dc(ec,fc,gc){if(m.contains(ec._ariaOwns,gc))ec._composerBox.setAttribute('aria-activedescendant',gc);}e.exports=ab;});
__d("WebMessengerThreadIsMutedTabSheet",["Event","ArbiterMixin","DOM","WebMessengerTemplates","copyProperties"],function(a,b,c,d,e,f){var g=b('Event'),h=b('ArbiterMixin'),i=b('DOM'),j=b('WebMessengerTemplates'),k=b('copyProperties');function l(m,n){this._rootElement=m;this._sheetView=n;}k(l.prototype,h,{render:function(){var m=j[':fb:web-messenger:read-view:message-mute-sheet'].build();i.setContent(m.getNode('text'),i.tx._("This conversation is muted. Chat tabs will not pop up for it and push notifications are off."));i.setContent(this._rootElement,m.getRoot());g.listen(m.getNode('unmuteButton'),'click',function(){this.inform('clicked',null);}.bind(this));},isPermanent:function(){return false;},getType:function(){return 'wb-thread-is-muted';},open:function(){this._sheetView.open(this);},close:function(){this._sheetView.close(this);}});e.exports=l;});
__d("WebMessengerDetailViewSheetControl",["MercuryConfig","copyProperties","DOM","WebMessengerStateManager","MercurySheetView","WebMessengerTemplates","MercuryThreadInformer","MercuryThreadMuter","MercuryThreads","WebMessengerThreadIsMutedTabSheet","WebMessengerSubscriptionsHandler"],function(a,b,c,d,e,f){var g=b('MercuryConfig'),h=b('copyProperties'),i=b('DOM'),j=b('WebMessengerStateManager'),k=b('MercurySheetView'),l=b('WebMessengerTemplates'),m=b('MercuryThreadInformer').get(),n=b('MercuryThreadMuter'),o=b('MercuryThreads').get(),p=b('WebMessengerThreadIsMutedTabSheet'),q=b('WebMessengerSubscriptionsHandler'),r=function(s){this._template=l[':fb:web-messenger:tab-sheet-container'].build();this._rootElement=this._template.getNode('sheet');this._threadID=j.getCurrentStateData().thread_id;this._sheetView=new k(this._threadID,this._rootElement,s);this._threadIsMutedTabSheet=new p(this._rootElement,this._sheetView);this._muteSetting=undefined;i.setContent(s,this._template.getRoot());this._threadIsMutedClickSub=this._threadIsMutedTabSheet.subscribe('clicked',function(){n.showMuteChangeDialog(0,this._threadID);}.bind(this));q.addSubscriptions(m.subscribe('threads-updated',function(t,u){if(this._threadID&&u[this._threadID])this.updateTabSheet(false);}.bind(this)));this.updateTabSheet(true);};h(r.prototype,{updateView:function(){var s=j.getCurrentStateData().thread_id;if(this._threadID!=s){this._threadID=s;this.updateTabSheet(true);}},updateTabSheet:function(s){if(!this._threadID||!g.MuteThreadsOnDesktopGK)return;o.getThreadMeta(this._threadID,function(t){var u=n.getThreadMuteSettingForUser(t);if(u!=this._muteSetting||s){if(u){this._threadIsMutedTabSheet.open();}else this._threadIsMutedTabSheet.close();this._muteSetting=u;}}.bind(this));},destroy:function(){this._threadIsMutedClickSub&&this._threadIsMutedClickSub.unsubscribe();}});e.exports=r;});
__d("WebMessengerDetailViewControlManager",["Event","ArbiterMixin","CSS","WebMessengerDetailViewHeaderControl","DOM","WebMessengerFlexibleScrollArea","copyProperties","WebMessengerDetailViewActionsMenuControl","WebMessengerDetailViewAllPeopleResultsControl","WebMessengerDetailViewComposeTypeaheadControl","WebMessengerDetailViewRecentMessagesControl","WebMessengerDetailViewSearchContextControl","WebMessengerDetailViewSearchSnippetsControl","WebMessengerDetailViewBottomShelfControl","WebMessengerMessagesSelection","Parent","WebMessengerDetailViewSheetControl","WebMessengerStateManager","WebMessengerStateConstants","Style","UserAgent","WebMessengerEvents","WebMessengerSubscriptionsHandler","WebMessengerTemplates"],function(a,b,c,d,e,f){var g=b('Event'),h=b('ArbiterMixin'),i=b('CSS'),j=b('WebMessengerDetailViewHeaderControl'),k=b('DOM'),l=b('WebMessengerFlexibleScrollArea'),m=b('copyProperties'),n=b('WebMessengerDetailViewActionsMenuControl'),o=b('WebMessengerDetailViewAllPeopleResultsControl'),p=b('WebMessengerDetailViewComposeTypeaheadControl'),q=b('WebMessengerDetailViewRecentMessagesControl'),r=b('WebMessengerDetailViewSearchContextControl'),s=b('WebMessengerDetailViewSearchSnippetsControl'),t=b('WebMessengerDetailViewBottomShelfControl'),u=b('WebMessengerMessagesSelection'),v=b('Parent'),w=b('WebMessengerDetailViewSheetControl'),x=b('WebMessengerStateManager'),y=b('WebMessengerStateConstants'),z=b('Style'),aa=b('UserAgent'),ba=b('WebMessengerEvents'),ca=b('WebMessengerSubscriptionsHandler'),da=b('WebMessengerTemplates'),ea=function(fa){this._rootElement=fa;k.empty(this._rootElement);var ga=da[':fb:web-messenger:read-view'].build();k.setContent(this._rootElement,ga.getRoot());this._readContainer=ga.getNode('readContainer');this._headerControl=new j(ga.getNode('detailViewHeader'));this._actionsMenuControl=new n(ga.getNode('detailViewActionsMenu'));this._allPeopleResultsControl=new o(ga.getNode('detailViewAllPeopleResults'));this._composeTypeaheadControl=new p(ga.getNode('detailViewComposeTypeahead'),ga.getNode('detailViewComposeTypeaheadResults'));this._searchContextControl=new r(this,ga.getNode('detailViewSearchContext'),ga.getNode('snippetPaginationControlBox'));this._searchSnippetsControl=new s(this,ga.getNode('detailViewSearchSnippets'));this._sheetControl=new w(ga.getNode('detailViewSheetTab'));var ha=ga.getNode('detailViewBottomShelf');this._bottomShelfControl=new t(this,ha);this._detailViewScroller=ga.getNode('readMessagesScroller');ca.addSubscriptions(g.listen(this._detailViewScroller,'click',function(ja){if(v.byTag(ja.getTarget(),'a')||k.getSelection())return;this._bottomShelfControl.focusComposer();}.bind(this)));var ia={fade:!!aa.osx(),persistent:true};this._flexArea=new l(this._detailViewScroller,ia).setBottomAligned(false).setInfiniteScrollHandler(this.inform.bind(this,'scrolledNearTop'),true).setContainer(this._rootElement).setMinFlexAreaHeight(200).draw();ca.addSubscriptions(ba.subscribe(ba.DETAIL_DOM_CHANGED,this._flexArea.draw.bind(this._flexArea)),ba.subscribe(ba.SUBMIT_REPLY,this._bottomShelfControl.submitReply.bind(this._bottomShelfControl)),x.subscribe(y.STATE_CHANGE_EVENT,this.updateOnStateChange.bind(this)));this._recentMessagesControl=new q(this,ga.getNode('detailViewRecentMessages'),ga.getNode('loadingSpinner'),ga.getNode('noSelectedConversation'),ga.getNode('newMessageLink'),ga.getNode('showUnreadLink'),ha);this._stateData={};this._resizeNodes=[this._rootElement,this._detailViewScroller,k.find(this._detailViewScroller,'div.uiScrollableAreaBody')];};m(ea.prototype,h,{updateOnStateChange:function(){var fa=x.getCurrentDetailState(),ga=this._stateData;this._stateData=x.getCurrentStateData();this._flexArea.setTabbable(fa!==y.DETAIL.COMPOSE_MAIN);this._allPeopleResultsControl.hideView();this._composeTypeaheadControl.hideView();this._recentMessagesControl.hideView();this._searchContextControl.hideView();this._searchSnippetsControl.hideView();i.removeClass(this._readContainer,'blankComposeState');i.conditionClass(this._readContainer,'blankComposeState',fa===y.DETAIL.COMPOSE_MAIN);this._bottomShelfControl.updateView();this._actionsMenuControl.updateView();this._headerControl.updateView();switch(fa){case y.DETAIL.RECENT_MESSAGES:this._recentMessagesControl.updateView();this._sheetControl.updateView();break;case y.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS:this._allPeopleResultsControl.updateView();case y.DETAIL.COMPOSE_MAIN:case y.DETAIL.COMPOSE_TYPEAHEAD_RESULTS:this._composeTypeaheadControl.updateView();break;case y.DETAIL.SEARCH_SNIPPET:case y.DETAIL.SEARCH_THREAD_SNIPPET:this._searchSnippetsControl.updateView();break;case y.DETAIL.SEARCH_CONTEXT:this._searchContextControl.updateView();break;}switch(fa){case y.DETAIL.RECENT_MESSAGES:case y.DETAIL.SEARCH_CONTEXT:if(ga.thread_id!=this._stateData.thread_id)this._bottomShelfControl.focusComposer();break;}},hideAll:function(){this._headerControl.hideView();this._actionsMenuControl.hideView();this._allPeopleResultsControl.hideView();this._composeTypeaheadControl.hideView();this._recentMessagesControl.hideView();this._searchContextControl.hideView();this._searchSnippetsControl.hideView();this._bottomShelfControl.hideView();},getSelectedMessageIDs:function(){var fa=x.getCurrentDetailState();switch(fa){case y.DETAIL.RECENT_MESSAGES:case y.DETAIL.SEARCH_CONTEXT:return u.getSelectedMessageIDs();}return [];},scrollIntoView:function(fa){this._flexArea&&this._flexArea.scrollIntoView(fa);},setScrollTop:function(fa,ga){this._flexArea&&this._flexArea.setScrollTop(fa,ga);},isScrolledToBottom:function(){return this._flexArea&&this._flexArea.isScrolledToBottom();},scrollToBottom:function(fa){this._flexArea&&this._flexArea.scrollToBottom(fa);},draw:function(){this._flexArea&&this._flexArea.draw();},poke:function(){this._flexArea&&this._flexArea.poke();},setScrollCallback:function(fa){this._flexArea&&this._flexArea.setScrollCallback(fa);},resizeTo:function(fa){this._resizeNodes.forEach(function(ga){z.set(ga,'width',fa+'px');});ba.detailDOMChanged();},destroy:function(){this._headerControl.destroy();this._actionsMenuControl.destroy();this._allPeopleResultsControl.destroy();this._composeTypeaheadControl.destroy();this._recentMessagesControl.destroy();this._searchContextControl.destroy();this._searchSnippetsControl.destroy();this._bottomShelfControl.destroy();this._flexArea.destroy();this._sheetControl.destroy();}});e.exports=ea;});
__d("WebMessengerAuxMenu",["copyProperties","MenuXSelectable","MenuXSelectableItem","PopoverMenuOverlappingBorder","Popover","PopoverMenu"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('MenuXSelectable'),i=b('MenuXSelectableItem'),j=b('PopoverMenuOverlappingBorder'),k=b('Popover'),l=b('PopoverMenu');function m(n,o){this._menu=new h([],{className:o});var p=new k(n.parentNode,n,null,{alignh:'right'});new l(p,n,this._menu,[j]);}g(m.prototype,{addOption:function(n,o){var p=new i({markup:n,title:''});p.setOnClickHandler(o);this._menu.addItem(p);return p;},destroy:function(){}});e.exports=m;});
__d("WebMessengerMenuFolderControl",["WebMessengerAuxMenu","CSS","Parent","WebMessengerTemplates","Toggler","copyProperties","cx","WebMessengerSubscriptionsHandler"],function(a,b,c,d,e,f){var g=b('WebMessengerAuxMenu'),h=b('CSS'),i=b('Parent'),j=b('WebMessengerTemplates'),k=b('Toggler'),l=b('copyProperties'),m=b('cx'),n=b('WebMessengerSubscriptionsHandler'),o,p;function q(s){return i.byClass(s,"_282");}function r(s,t,u){var v=!o||o!=t;o=t;this._template=j[':fb:web-messenger:master-view:tab-bar:menu-option'].build();this._template.setNodeContent('folderLabel',s);if(!p||v){p=new g(o,"_1j");h.show(q(o));n.addSubscriptions(k.subscribe(['show','hide'],function(w,x){var y=x.getActive(),z=y&&i.byClass(y,"_282");if(z)h.conditionClass(z,"_50p_",w==='show');}));}this._menuItem=p.addOption(this._template.getRoot(),u);this._menuItem.getRoot();}l(r.prototype,{getCountBadge:function(){return this._template.getNode('count');},setSelected:function(s){h.conditionClass(q(o),'selectedFolder',s);if(s){this._menuItem.select();}else this._menuItem.deselect();},destroy:function(){p&&p.destroy();}});e.exports=r;});
__d("MessagingFilteringNux",["Arbiter","AsyncRequest","LayerDestroyOnHide","LayerHideOnTransition","MercuryConfig","WebMessengerPermalinks"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncRequest'),i=b('LayerDestroyOnHide'),j=b('LayerHideOnTransition'),k=b('MercuryConfig'),l=b('WebMessengerPermalinks'),m=null,n,o={ACCEPTED_EVENT:'filtering/accepted',DIALOG_REGISTERED_EVENT:'filtering/dialog-registered',tryShow:function(p){g.subscribe(o.DIALOG_REGISTERED_EVENT,function(){if(!m)return;m.setContext(p);m.show();m=null;},g.SUBSCRIBE_ALL);},registerDialog:function(p){m=p.disableBehavior(i).disableBehavior(j);n=g.subscribe('page_transition',function(q,r){if(!l.isWebMessengerURI(r.uri)){p&&p.destroy();n.unsubscribe();}},g.SUBSCRIBE_NEW);if(p)p.subscribe('confirm',function(){k.filtering_active=true;new h('/ajax/web_messenger/dismiss_filtering_nux.php').send();p.hide();g.inform(o.ACCEPTED_EVENT,{});});g.inform(o.DIALOG_REGISTERED_EVENT,{},g.BEHAVIOR_PERSISTENT);}};e.exports=o;});
__d("WebMessengerTabbedFolderControl",["Event","CSS","WebMessengerTemplates","copyProperties"],function(a,b,c,d,e,f){var g=b('Event'),h=b('CSS'),i=b('WebMessengerTemplates'),j=b('copyProperties');function k(l,m,n){this._template=i[':fb:web-messenger:master-view:tab-bar:folder'].build();this._template.setNodeContent('folderLabel',l);this._listener=g.listen(this._template.getNode('link'),'click',n);m.push(this._template.getRoot());}j(k.prototype,{getCountBadge:function(){return this._template.getNode('count');},setSelected:function(l){h.conditionClass(this._template.getRoot(),'selectedFolder',l);},getElement:function(){this._template.getRoot();},destroy:function(){this._listener.remove();}});e.exports=k;});
__d("WebMessengerEditFilteringSettingDialog",["AsyncDialog","AsyncRequest","MercuryConstants","DOM","csx"],function(a,b,c,d,e,f){var g=b('AsyncDialog'),h=b('AsyncRequest'),i=b('MercuryConstants'),j=b('DOM'),k=b('csx'),l='/ajax/mercury/edit_filtering_type.php',m='/ajax/mercury/change_filtering_type.php',n={show:function(){var o=function(q){var r=q.getRoot(),s=j.find(r,"._cq6").checked,t=j.find(r,"._cq7").checked,u='';if(s){u=i.MessagingFilteringType.MODERATE;}else if(t)u=i.MessagingFilteringType.STRICT;new h(m).setData({filtering_type:u}).send();q.hide();},p=function(q){q.subscribe('confirm',o.curry(q));q.show();};g.send(new h(l),p);}};e.exports=n;});
__d("WebMessengerMercury",["MercuryMessages","MercuryOrderedThreadlist","MercuryServerRequests","WebMessengerStateManager","MercuryThreadInformer","MercuryThreads","MercuryUnreadState","MercuryUnseenState"],function(a,b,c,d,e,f){var g=b('MercuryMessages'),h=b('MercuryOrderedThreadlist'),i=b('MercuryServerRequests'),j=b('WebMessengerStateManager'),k=b('MercuryThreadInformer'),l=b('MercuryThreads'),m=b('MercuryUnreadState'),n=b('MercuryUnseenState'),o={getMessages:function(){return g.getForFBID(p());},getOrderedThreadlist:function(){return h.getForFBID(p());},getServerRequests:function(){return i.getForFBID(p());},getThreadInformer:function(){return k.getForFBID(p());},getThreads:function(){return l.getForFBID(p());},getUnreadState:function(){return m.getForFBID(p());},getUnseenState:function(){return n.getForFBID(p());}};function p(){return j.getCurrentUserID();}e.exports=o;});
__d("WebMessengerMasterViewTabBarControl",["JSXDOM","Arbiter","CSS","DOM","Event","Ellipsizer","WebMessengerMenuFolderControl","MercuryConfig","MercuryFilters","MercuryFolders","MercuryThreadlistConstants","MessagingFilteringNux","MessagingTag","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTabbedFolderControl","WebMessengerTemplates","WebMessengerEditFilteringSettingDialog","WebMessengerEvents","WebMessengerSubscriptionsHandler","WebMessengerMercury","copyProperties","csx","tx"],function(a,b,c,d,e,f){var g=b('JSXDOM'),h=b('Arbiter'),i=b('CSS'),j=b('DOM'),k=b('Event'),l=b('Ellipsizer'),m=b('WebMessengerMenuFolderControl'),n=b('MercuryConfig'),o=b('MercuryFilters'),p=b('MercuryFolders'),q=b('MercuryThreadlistConstants'),r=b('MessagingFilteringNux'),s=b('MessagingTag'),t=b('WebMessengerStateConstants'),u=b('WebMessengerStateManager'),v=b('WebMessengerTabbedFolderControl'),w=b('WebMessengerTemplates'),x=b('WebMessengerEditFilteringSettingDialog'),y=b('WebMessengerEvents'),z=b('WebMessengerSubscriptionsHandler'),aa=b('WebMessengerMercury'),ba=b('copyProperties'),ca=b('csx'),da=b('tx'),ea=function(la,ma,na){this._manager=la;this._rootElement=ma;this._rootTopContentElement=na;this._threadInformer=aa.getThreadInformer();this._unreadState=aa.getUnreadState();j.empty(this._rootElement);var oa=w[':fb:web-messenger:master-view:tab-bar'].build(),pa=w[':fb:web-messenger:master-view:top-content'].build();j.setContent(this._rootElement,oa.getRoot());j.setContent(this._rootTopContentElement,pa.getRoot());this._tabList=oa.getRoot();this._moreMenu=oa.getNode('moreMenu');this._topContentCont=pa.getRoot();this._topContent=pa.getNode('masterViewTopContentHolder');this._closeButton=pa.getNode('masterViewTopContentCloseButton');this._closeButtonCont=pa.getNode('masterViewTopContentCloseCont');this._state=null;this._folder=null;this._filter=null;this._query=null;this._threadID=null;this._folders=p.getSupportedFolders();this._foldersToHeader={};this._filters=o.getSupportedFilters();this._filtersToHeader={};this._otherMarkAllRead=j.create('a',{},"Mark All as Read");this._unreadMarkAllRead=j.create('a',{},"Mark All as Read");this._otherEditSettings=j.create('a',{},"Edit Preferences");var qa=[];this._filters.forEach(function(ta){var ua=ja.curry(this,s.INBOX,ta);switch(ta){case s.UNREAD:this._filtersToHeader[ta]=this._filtersToHeader[ta]||new m("Unread",this._moreMenu,ua);break;}}.bind(this));this._folders.forEach(function(ta){var ua=ja.curry(this,ta,o.ALL);switch(ta){case s.INBOX:this._foldersToHeader[ta]=this._foldersToHeader[ta]||new v("Inbox",qa,ua);break;case s.OTHER:this._foldersToHeader[ta]=this._foldersToHeader[ta]||new v("Other",qa,ua);break;case s.ACTION_ARCHIVED:this._foldersToHeader[ta]=this._foldersToHeader[ta]||new m("Archived",this._moreMenu,ua);break;case s.SPAM:this._foldersToHeader[ta]=this._foldersToHeader[ta]||new m("Spam",this._moreMenu,ua);break;}}.bind(this));j.prependContent(this._tabList,qa);var ra=j.scry(this._tabList,"._6xt");ra.push(oa.getNode('moreMenuLabel'));this._ellipsizer=new l(ra);fa(this);var sa=ja.curry(this,s.INBOX,o.ALL);h.subscribe(r.ACCEPTED_EVENT,ia.curry(this));z.addSubscriptions(this._threadInformer.subscribe('unread-updated',ka.curry(this)),k.listen(this._otherMarkAllRead,'click',function(){this._unreadState.markFolderAsRead(s.OTHER);}.bind(this)),k.listen(this._unreadMarkAllRead,'click',function(){this._unreadState.markFolderAsRead(s.INBOX);}.bind(this)),k.listen(this._otherEditSettings,'click',function(){x.show();}),k.listen(this._closeButton,'click',sa));};ba(ea.prototype,{updateView:function(){var la=ha(this);ga(this);if(la)ia(this);fa(this);},getOtherFolderLabel:function(){var la=s.OTHER,ma=this._foldersToHeader[la];if(!ma||!ma._template)return null;return ma._template.getNode('folderLabel');},destroy:function(){for(var la in this._foldersToHeader)this._foldersToHeader[la]&&this._foldersToHeader[la].destroy();for(var ma in this._filtersToHeader)this._filtersToHeader[ma]&&this._filtersToHeader[ma].destroy();}});function fa(la){var ma=85;j.scry(la._tabList,"._1r").forEach(function(na){ma+=na.offsetWidth;});la._ellipsizer.confineWithin(la._rootElement.offsetWidth-ma);}function ga(la){var ma=u.getCurrentStateData();la._state=u.getCurrentMasterState();la._folder=ma.folder;la._filter=ma.filter;la._query=ma.query;}function ha(la){if(!la._state||!la._folder)return true;var ma=u.getCurrentStateData();if(la._folder!=ma.folder)return true;if(la._filter!=ma.filter)return true;return false;}function ia(la){var ma=false,na;la._folders.forEach(function(oa){var pa=la._filter==s.UNREAD,qa=oa==la._folder&&(la._filter==o.ALL||pa),ra,sa;switch(oa){case s.INBOX:if(pa){var ta=g.strong(null,"Unread"),ua=g.strong(null,"Inbox"),va=da._("{unread} messages in {inbox}",{unread:ta,inbox:ua});ra=g.div(null,[va,' \u00b7 ',la._unreadMarkAllRead]);sa=true;}break;case s.OTHER:var wa='';if(n.filtering_active)wa=g.span(null,[la._otherEditSettings,' \u00b7 ']);ra=g.div(null,[g.p(null,[g.strong(null,"Tip:"+' '),"See a message from someone you know? Just reply or click Move to Inbox."]),wa,la._otherMarkAllRead]);r.tryShow(la.getOtherFolderLabel());break;}if(qa){na=oa;i.conditionShow(la._closeButtonCont,sa);}else la._foldersToHeader[oa].setSelected(false);if(qa&&ra){ma=true;j.setContent(la._topContent,ra);}});la._filters.forEach(function(oa){var pa=la._folder==s.INBOX&&oa==la._filter;la._filtersToHeader[oa].setSelected(pa);});na&&la._foldersToHeader[na].setSelected(true);i.conditionShow(la._topContentCont,ma);ka(la);la._manager.draw();}function ja(la,ma,na){var oa=la._state==t.MASTER.SEARCH;if(oa||la._folder!=ma||la._filter!=na){var pa=ba({},u.getCurrentStateData()),qa=u.getCurrentDetailState();if(qa!==t.DETAIL.SEARCH_SNIPPET&&qa!==t.DETAIL.SEARCH_CONTEXT)delete pa.query;u.updateMasterState(t.MASTER.RECENT_THREADS,ba(pa,{folder:ma,filter:na}));}y.focusComposer();}function ka(la){for(var ma in la._foldersToHeader){if(ma==s.ACTION_ARCHIVED)continue;var na=la._unreadState.exceedsMaxCount(ma)?q.MAX_UNREAD_COUNT+'+':la._unreadState.getUnreadCount(ma),oa=[la._foldersToHeader[ma].getCountBadge()];if(ma==s.INBOX)la._filters.forEach(function(pa){oa.push(la._filtersToHeader[pa].getCountBadge());});oa.forEach(function(pa){if(na)j.setContent(pa,j.tx._("({unread_count})",{unread_count:na}));i.conditionShow(pa,na);});}fa(la);}e.exports=ea;});
__d("escapeRegex",[],function(a,b,c,d,e,f){function g(h){return h.replace(/([.?*+\^$\[\]\\(){}|\-])/g,"\\$1");}e.exports=g;});
__d("MercuryLocalThreadResults",["Env","escapeRegex","MercuryFolders","MercuryOrderedThreadlist","MercuryIDs","MercuryParticipants","MercuryThreads","TypeaheadUtil"],function(a,b,c,d,e,f){var g=b('Env'),h=b('escapeRegex'),i=b('MercuryFolders'),j=b('MercuryOrderedThreadlist').get(),k=b('MercuryIDs'),l=b('MercuryParticipants'),m=b('MercuryThreads').get(),n=b('TypeaheadUtil'),o={findMatchingThreadsFromIds:function(v,w){return w.filter(function(x){var y=m.getThreadMetaNow(x);return p(y,v);});},findMatchingThreads:function(v){var w=[];i.getSupportedFolders().forEach(function(x){w=w.concat(j.getThreadlistUntilTimestamp(0,x));}.bind(this));return this.findMatchingThreadsFromIds(v,w);}};function p(v,w){var x=s(v.participants),y=q(w),z=null;l.getMulti(x,function(aa){z=x.map(function(ba){return aa[ba];});});if(!z)return false;return u(y,function(aa){var ba=t(z,function(da){return da&&da.name&&r(aa,q(da.name));}),ca=v.name&&r(aa,q(v.name));return ba||ca;});}function q(v){return v.split(/\s+/).filter(function(w){return w.trim().length>0;});}function r(v,w){var x=new RegExp('\\b'+h(v),'i');return t(w,function(y){var z=n.parse(y).flatValue;return x.test(z);});}function s(v){if(v.length===1&&k.tokenize(v[0]).value===g.user)return v;return v.filter(function(w){var x=k.tokenize(w).value;return x!==g.user;});}function t(v,w){for(var x=0;x<v.length;x++)if(w(v[x]))return true;return false;}function u(v,w){for(var x=0;x<v.length;x++)if(!w(v[x]))return false;return true;}e.exports=o;});
__d("MercurySearchThreadResults",["KeyedCallbackManager","MercuryAPIArgsSource","MercuryThreadlistConstants","RangedCallbackManager","MercuryServerDispatcher","MercuryServerRequests"],function(a,b,c,d,e,f){var g=b('KeyedCallbackManager'),h=b('MercuryAPIArgsSource'),i=b('MercuryThreadlistConstants'),j=b('RangedCallbackManager'),k=b('MercuryServerDispatcher'),l=b('MercuryServerRequests').get(),m=new g(),n=i.WEBMESSENGER_THREAD_COUNT,o=i.WEBMESSENGER_MORE_COUNT,p={getThreadlist:function(s,t){if(s){var u=m.executeOrEnqueue(s,function(x){var y=x.getAllResources(),z=x.hasReachedEndOfArray();t(y,z);}),v=m.getUnavailableResources(u),w=h.WEBMESSENGER;if(v.length)r({client:w,query:s,offset:0,limit:n+1});return u;}},isExhausted:function(s){var t=m.getResource(s);return t?t.hasReachedEndOfArray():false;},getCachedThreadlist:function(s){var t=m.getResource(s);return t?t.getAllResources():null;},cacheThreadlist:function(s,t){m.getResource(s);var u=new j();u.addResourcesWithoutSorting(t,0);u.setReachedEndOfArray();m.setResource(s,u);},getMoreThreadlist:function(s,t){if(s){var u=m.getResource(s);if(u){var v=u.getCurrentArraySize(),w=o,x=u.executeOrEnqueue(0,v+w,function(){var z=u.getAllResources(),aa=u.hasReachedEndOfArray();t(z,aa);}),y=u.getUnavailableResources(x);if(y.length)r({query:s,offset:v,limit:w+1});return x;}}},handleUpdate:function(s){if(s.mercury_payload)l.handleUpdate(s.mercury_payload);var t=s.search_threads||{};for(var u in t){var v=t[u]||[],w=v.map(l.getClientThreadIDNow.bind(l)),x=m.getResource(u);if(x){q(x,w,o+1);}else{x=new j();q(x,w,n+1);m.setResource(u,x);}}},unsubscribe:function(s,t){if(t){var u=m.getResource(t);if(u){u.unsubscribe(s);}else m.unsubscribe(s);}},setInitialCount:function(s){n=s;}};function q(s,t,u){var v=s.getCurrentArraySize(),w=t.length<u;if(!w)t.pop();s.addResourcesWithoutSorting(t,v);if(w)s.setReachedEndOfArray();}function r(s){s.client=h.WEBMESSENGER;k.trySend('/ajax/mercury/search_threads.php',s);}k.registerEndpoints({'/ajax/mercury/search_threads.php':{mode:k.IMMEDIATE,handler:p.handleUpdate}});e.exports=p;});
__d("MercurySearchThreadsStrategy",["WebMessengerConstants","MercuryLocalThreadResults","MercurySearchThreadResults","copyProperties","createObjectFrom"],function(a,b,c,d,e,f){var g=b('WebMessengerConstants'),h=b('MercuryLocalThreadResults'),i=b('MercurySearchThreadResults'),j=b('copyProperties'),k=b('createObjectFrom'),l=null,m=null,n=g.SEARCH_THREAD_DELAY,o={clearTimer:function(){l=null;clearTimeout(m);m=null;},search:function(r,s,t,u){if(r!=l){l=r;clearTimeout(m);m=null;}var v=h.findMatchingThreads(r),w=i.getCachedThreadlist(r);if(w){var x=q(v,w);s(x);t([],i.isExhausted(r));u(null,r);return;}var y=p(r),z=q(v,y.thread_ids);if(y.from_exhausted_remote_results){i.cacheThreadlist(r,z);s(z);t([],true);u(null,r);return;}s(z);m=setTimeout(function(){var aa=i.getThreadlist(r,t);u(aa,r);},n);}};function p(r){var s='',t=[];for(var u=r.length-1;u>0;u--){var v=r.slice(0,u),w=i.getCachedThreadlist(v);if(!w)continue;if(i.isExhausted(v)){return {from_exhausted_remote_results:true,thread_ids:h.findMatchingThreadsFromIds(r,w)};}else if(s.length===0){s=v;t=h.findMatchingThreadsFromIds(r,w);}}return {from_exhausted_remote_results:false,thread_ids:t};}function q(r,s){return Object.keys(j(k(r),k(s)));}e.exports=o;});
__d("WebMessengerMasterViewSearchInputControl",["Event","CSS","DOM","Input","Keys","MercurySearchThreadsStrategy","WebMessengerShortcuts","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","WebMessengerSubscriptionsHandler","WebMessengerEvents","copyProperties","cx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('CSS'),i=b('DOM'),j=b('Input'),k=b('Keys'),l=b('MercurySearchThreadsStrategy'),m=b('WebMessengerShortcuts'),n=b('WebMessengerStateConstants'),o=b('WebMessengerStateManager'),p=b('WebMessengerTemplates'),q=b('WebMessengerSubscriptionsHandler'),r=b('WebMessengerEvents'),s=b('copyProperties'),t=b('cx'),u=function(ca,da){this._manager=ca;this._rootElement=da;i.empty(this._rootElement);var ea=p[':fb:web-messenger:master-view:search-input'].build();i.replace(this._rootElement,ea.getRoot());this._searchBox=ea.getRoot();this._searchInput=ea.getNode('searchInput');this._searchClear=ea.getNode('searchClear');this._searchButton=i.find(this._searchBox,'button');this._state=null;this._query=null;this._folder=null;this._threadID=null;this._ariaOwns=this._searchInput.getAttribute('aria-owns');q.addSubscriptions(r.subscribe(r.UPDATE_SELECTION,ba.curry(this)),g.listen(this._searchButton,'click',function(){var fa=j.getValue(this._searchInput);if(fa)z(this,fa);}.bind(this)),g.listen(this._searchClear,'click',y.curry(this)),g.listen(this._searchInput,'keyup',function(event){var fa=j.getValue(this._searchInput);if(event.keyCode==k.ESC){y(this);}else if(event.keyCode==k.RETURN&&fa){m.openSearchThread();}else if(fa){aa(this,fa);}else if(fa!==o.getCurrentStateData().query){y(this);this.focus();}return false;}.bind(this)),g.listen(this._searchInput,'focus',function(fa){this._focused=true;}.bind(this)),g.listen(this._searchInput,'blur',function(fa){this._focused=false;}.bind(this)));};s(u.prototype,{updateView:function(){var ca=w(this);v(this);if(ca)x(this);},focusAndSelectSearch:function(){z(this,j.getValue(this._searchInput));this._manager.scrollToTop(false);this.focus();this._searchInput.select();},focus:function(){(function(){if(!this._focused){this._searchInput.focus();this._searchInput.value=this._searchInput.value;}}).bind(this).defer();},destroy:function(){}});function v(ca){var da=o.getCurrentStateData();ca._state=o.getCurrentMasterState();ca._folder=da.folder;if(ca._state!=n.MASTER.SEARCH){ca._query=null;}else ca._query=da.query;}function w(ca){if(!ca._state||!ca._folder)return true;var da=o.getCurrentMasterState(),ea=o.getCurrentStateData();if(ca._folder!=ea.folder)return true;if(da!=ca._state)return true;if(da==n.MASTER.SEARCH&&ca._query!=ea.query)return true;return false;}function x(ca){if(ca._state==n.MASTER.SEARCH){var da=ca._query||'';if(j.getValue(ca._searchInput)!=da)j.setValue(ca._searchInput,da);ca.focus();}else{j.reset(ca._searchInput);ca._searchInput.blur();}h.conditionClass(ca._searchBox,"_47",!j.isEmpty(ca._searchInput));}function y(ca){l.clearTimer();var da=o.getCurrentStateData();da.no_uri=true;delete da.query;o.updateMasterState(n.MASTER.RECENT_THREADS,da);}function z(ca,da){var ea=o.getCurrentMasterState();if(ea!=n.MASTER.SEARCH)ca._threadID=o.getCurrentStateData().thread_id;if(da)o.updateDetailState(n.DETAIL.SEARCH_SNIPPET,{query:da,message_query:da});}function aa(ca,da){var ea=o.getCurrentStateData();if(da!==ea.query){var fa=o.getCurrentMasterState();if(fa!=n.MASTER.SEARCH)ca._threadID=ea.thread_id;if(da)o.updateMasterState(n.MASTER.SEARCH,{all_people_query:ea.all_people_query,message_query:ea.message_query,message_id:ea.message_id,query:da,thread_id:ea.thread_id});}}function ba(ca,da,ea){if(i.contains(ca._ariaOwns,ea))ca._searchInput.setAttribute('aria-activedescendant',ea);}e.exports=u;});
__d("MercuryLogger",["JSLogger","MercuryServerRequests","MercuryThreads"],function(a,b,c,d,e,f){var g=b('JSLogger'),h=b('MercuryServerRequests').get(),i=b('MercuryThreads').get(),j=g.create('messaging_impressions');function k(event,o){j.log(event,o);}function l(o,p){var q=i.getThreadMetaNow(o);if(q){var r=h.getServerThreadIDNow(o);if(r){var event=p?'thread_search':'thread',s={is_single_thread:q.is_canonical_user,is_subscribed:q.is_subscribed,query:p||null,thread_id:r};k(event,s);}j.bump('opened_thread_'+q.folder);}}function m(o,p){var q={};p.forEach(function(r){var s=h.getServerThreadIDNow(r),t=i.getThreadMetaNow(r);if(t&&s){var u={is_single_thread:t.is_canonical_user,thread_id:s,folder:t.folder,participants:t.participants,canonical_fbid:t.canonical_fbid};q[s]=u;}});k('threadlist',{folder:o,threads:q});j.bump('opened_threadlist_'+o);}var n={logThread:function(o){l(o);},logThreadlist:function(o,p){m(o,p);},logThreadFromSearch:function(o,p){l(p,o);},logThreadlistFromSearch:function(o,p){k('threadlist_search',{folder:p,query:o});}};e.exports=n;});
__d("WebMessengerThreadlistRenderer",["CSS","DOM","Event","MercuryListUpdateRenderer","MercuryAPIArgsSource","MessagingTag","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","MercuryThreadMetadataRawRenderer","MercuryThreadMetadataRenderer","Tooltip","WebMessengerMercury","WebMessengerPermalinks","WebMessengerDeleteThreadDialog","cx","tx"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DOM'),i=b('Event'),j=b('MercuryListUpdateRenderer'),k=b('MercuryAPIArgsSource'),l=b('MessagingTag'),m=b('WebMessengerStateConstants'),n=b('WebMessengerStateManager'),o=b('WebMessengerTemplates'),p=b('MercuryThreadMetadataRawRenderer'),q=b('MercuryThreadMetadataRenderer'),r=b('Tooltip'),s=b('WebMessengerMercury'),t=b('WebMessengerPermalinks'),u=b('WebMessengerDeleteThreadDialog'),v=b('cx'),w=b('tx'),x={renderThreadsFromIDs:function(z,aa,ba,ca,da,ea){ca=ca||function(fa){return fa;};da=da||{};j.updateList(z,aa.map(ca),function(fa){return !da[aa[fa]]&&aa[fa]!=ba;},function(fa){var ga=aa[fa],ha=o[':fb:web-messenger:threadlist-row'].build();ha.getRoot().setAttribute('id',ca(ga));i.listen(ha.getNode('threadLink'),'click',function(ia){if(ia.getModifiers().any)return true;var ja=n.getCurrentMasterState(),ka={thread_id:ga};if(ja===m.MASTER.SEARCH)ka.query=n.getCurrentStateData().query;n.updateDetailState(m.DETAIL.RECENT_MESSAGES,ka);return false;});if(ga==ba)g.addClass(ha.getRoot(),"_kv");s.getThreads().getThreadMeta(ga,function(ia){var ja=q.getForFBID(n.getCurrentUserID());ja.renderCoreThreadlist(ia,ha,y.curry(ea),{show_unread_count:false,names_renderer:p.renderShortNames},true);},k.WEBMESSENGER);return ha.getRoot();});}};function y(z,aa,ba){var ca=aa.getNode('readToggler'),da=aa.getNode('archiveButton'),ea=aa.getNode('deleteButton');aa.getNode('threadLink').setAttribute('href',t.getURI(z,m.DETAIL.RECENT_MESSAGES,{thread_id:ba.thread_id}).toString());if(ba.unread_count>0){g.addClass(aa.getRoot(),"_kx");h.setContent(aa.getNode('newCount'),h.tx._("{num} new",{num:ba.unread_count}));g.addClass(ca,"_ky");r.set(ca,"Mark as read",'above','right');}else{g.addClass(ca,"_kz");r.set(ca,"Mark as unread",'above','right');}i.listen(ca,'click',function(event){s.getThreads().changeThreadReadStatus(ba.thread_id,g.hasClass(ca,"_ky"));return false;});var fa=n.getCurrentStateData().folder;if(fa==l.SPAM){r.set(ea,"Delete Conversation",'above','right');g.addClass(ea,"_4_3q");i.listen(ea,'click',function(event){u.show(ba.thread_id);});g.hide(da);}else{g.hide(ea);var ga=true;if(fa==l.ACTION_ARCHIVED){ga=false;r.set(da,"Unarchive",'above','right');g.addClass(da,"_2s2");}else{r.set(da,"Archive",'above','right');g.addClass(da,"_l9");}i.listen(da,'click',function(event){s.getThreads().changeThreadArchivedStatus(ba.thread_id,ga);var ha=n.getCurrentStateData();if(ha.thread_id==ba.thread_id)n.updateDetailState(m.DETAIL.RECENT_MESSAGES,{folder:ha.folder});return false;});}}e.exports=x;});
__d("WebMessengerMasterViewUnseenMessagesNotice",["Class","MessagingTag","WebMessengerStateManager","UserActivity","WebMessengerSubscriptionsHandler","WebMessengerMessagesNotice","WebMessengerConstants","WebMessengerMercury","copyProperties","throttle"],function(a,b,c,d,e,f){var g=b('Class'),h=b('MessagingTag'),i=b('WebMessengerStateManager'),j=b('UserActivity'),k=b('WebMessengerSubscriptionsHandler'),l=b('WebMessengerMessagesNotice'),m=b('WebMessengerConstants'),n=b('WebMessengerMercury'),o=b('copyProperties'),p=b('throttle'),q=m.THREADLIST_SCROLLTOP_OFFSET,r=m.MESSAGE_NOTICE_INACTIVITY_THRESHOLD,s=function(x){this.parent.construct(this);this._manager=x;this._threadInformer=n.getThreadInformer();this._unseenState=n.getUnseenState();k.addSubscriptions(this._threadInformer.subscribe('messages-received',function(y,z){var aa=!j.isActive(r),ba=!this.isScrolledWithinTopThreshold();if(!this.parent.getActive()||v(z)||!u(z))return;if(this.parent.onlyReceivedFromSelf(z))return;if(aa){this.removeMessageNotice();this._manager.scrollToTop();}else if(ba)this.showMessageNotice();}.bind(this)),this._threadInformer.subscribe('unseen-updated',t.curry(this)));this._manager.setScrollCallback(p(function(y){if(this.parent.getActive()&&y.getScrollTop()<=m.THREADLIST_TOP_OFFSET&&j.isActive(r)&&w()){this.removeMessageNotice();this._unseenState.markAsSeen();}}.bind(this),100,null));};g.extend(s,l);o(s.prototype,{isScrolledWithinTopThreshold:function(){return this._manager.getScrollTop()<=q;},showMessageNotice:function(){if(!w())return;var x=function(){this._manager.scrollToTop();}.bind(this);this.parent.showMessageNotice(x,'below');}});function t(x){if(x._unseenState.getUnseenCount()===0)x.removeMessageNotice();}function u(x){for(var y in x)for(var z=0;z<x[y].length;z++)if(x[y][z].folder==h.INBOX)return true;return false;}function v(x){var y=i.getCurrentStateData().thread_id,z=true;for(var aa in x)if(x.hasOwnProperty(aa))if(aa!==y){z=false;break;}return w()&&z;}function w(){var x=i.getCurrentStateData().folder;return x===h.INBOX;}e.exports=s;});
__d("WebMessengerMasterViewRecentThreadsControl",["Event","function-extensions","CSS","DOM","MercuryLogger","MercuryAPIArgsSource","MercuryFilters","MercuryFolders","MercuryThreadlistConstants","MessagingTag","WebMessengerShortcuts","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","WebMessengerThreadlistRenderer","UserActivity","WebMessengerConstants","WebMessengerEvents","WebMessengerInfoBoxRenderer","WebMessengerSubscriptionsHandler","WebMessengerMasterViewUnseenMessagesNotice","WebMessengerMercury","copyProperties","createObjectFrom","cx","ge","tx"],function(a,b,c,d,e,f){var g=b('Event');b('function-extensions');var h=b('CSS'),i=b('DOM'),j=b('MercuryLogger'),k=b('MercuryAPIArgsSource'),l=b('MercuryFilters'),m=b('MercuryFolders'),n=b('MercuryThreadlistConstants'),o=b('MessagingTag'),p=b('WebMessengerShortcuts'),q=b('WebMessengerStateConstants'),r=b('WebMessengerStateManager'),s=b('WebMessengerTemplates'),t=b('WebMessengerThreadlistRenderer'),u=b('UserActivity'),v=b('WebMessengerConstants'),w=b('WebMessengerEvents'),x=b('WebMessengerInfoBoxRenderer'),y=b('WebMessengerSubscriptionsHandler'),z=b('WebMessengerMasterViewUnseenMessagesNotice'),aa=b('WebMessengerMercury'),ba=b('copyProperties'),ca=b('createObjectFrom'),da=b('cx'),ea=b('ge'),fa=b('tx'),ga='recent:',ha=function(cb,db,eb,fb){this._manager=cb;this._rootElement=db;this._infoBox=eb;this._orderedThreadlist=aa.getOrderedThreadlist();this._serverRequests=aa.getServerRequests();this._threadInformer=aa.getThreadInformer();this._threads=aa.getThreads();this._unseenState=aa.getUnseenState();i.empty(this._rootElement);this._pagerExponent=-1;var gb=s[':fb:web-messenger:threadlist'].build();i.setContent(this._rootElement,gb.getRoot());this._loadingSpinner=gb.getNode('loadingSpinner');this._threadlistRows=gb.getNode('threadlistRows');this._loadMoreButton=gb.getNode('loadMoreButton');this._loadMoreLink=gb.getNode('loadMoreLink');this._active=false;this._state=null;this._folder=null;this._filter=null;this._selection=null;this._threadIDs=[];this._unreadThreadIDs=[];this._folders=m.getSupportedFolders();this._filters=l.getSupportedFilters();this._olderTimestamp={};this._currentCountMap={};this._folders.forEach(function(hb){this._currentCountMap[hb]={};this._filters.concat([l.ALL]).forEach(function(ib){this._currentCountMap[hb][ib]=n.WEBMESSENGER_THREAD_COUNT+1;}.bind(this));}.bind(this));this._unseenMessagesNotice=new z(this._manager);this._unseenMessagesNotice.setNoticeContextNode(fb);y.addSubscriptions(this._threadInformer.subscribe('threadlist-updated',function(hb,ib){ua(this,ca(ib));}.bind(this)),this._serverRequests.subscribe('model-update-completed',function(){za(this);}.bind(this)),g.listen(this._loadMoreLink,'click',function(){ta(this);}.bind(this)),this._manager.subscribe('scrolledNearBottom',function(){this._active&&ta(this);}.bind(this)));};ba(ha.prototype,{updateView:function(){this._active=true;this._unseenMessagesNotice.updateView();h.show(this._rootElement);var cb=ja(this),db=ka(this),eb=this._folder,fb=this._selection;la(this);if(db)ma(this,fb);if(cb){sa(this);}else na(this);za(this);if(eb!=this._folder)j.logThreadlist(this._folder,this._threadIDs);if(this._selection&&fb!=this._selection)j.logThread(this._selection);},hideView:function(){this._active=false;this._unseenMessagesNotice.hideView();h.hide(this._rootElement);},destroy:function(){ia(this);this._unseenMessagesNotice.destroy();}});function ia(cb){cb._threadlistSubscription&&cb._orderedThreadlist.unsubscribe(cb._threadlistSubscription.subscriber_id,cb._threadlistSubscription.folder,cb._threadlistSubscription.filter);cb._threadlistSubscription=null;}function ja(cb){var db=r.getCurrentStateData();if((cb._folder!=db.folder)||(cb._filter!=db.filter))return true;return false;}function ka(cb){var db=r.getCurrentStateData();if(cb._selection!=db.thread_id)return true;return false;}function la(cb){var db=r.getCurrentStateData();cb._state=r.getCurrentMasterState();if((cb._folder!=db.folder)||(cb._filter!=db.filter))cb._pageExponent=-1;cb._folder=db.folder;cb._filter=db.filter;cb._selection=db.thread_id;}function ma(cb,db){var eb=ea(ya(db));if(eb){h.removeClass(eb,"_kv");eb.removeAttribute('aria-selected');}var fb=ea(ya(cb._selection));if(fb){h.addClass(fb,"_kv");fb.setAttribute('aria-selected','true');}w.updateSelection(fb&&fb.id);}function na(cb){if(cb._active)p.updateThreadlistIndex(cb,cb._threadIDs.map(ya),ya(cb._selection));}function oa(cb){h.addClass(cb._manager.getFlexAreaElement(),"_3j6");h.addClass(cb._manager.getFlexAreaElement(),"_3j7");}function pa(cb){h.removeClass(cb._manager.getFlexAreaElement(),"_3j6");h.removeClass(cb._manager.getFlexAreaElement(),"_3j7");}function qa(cb){h.hide(cb._threadlistRows);pa(cb);}function ra(cb){if(cb._threadIDs.length){h.show(cb._threadlistRows);pa(cb);}else{h.hide(cb._threadlistRows);oa(cb);}}function sa(cb){h.show(cb._loadingSpinner);h.hide(cb._infoBox);qa(cb);h.hide(cb._loadMoreButton);ia(cb);var db=cb._orderedThreadlist.getFilteredThreadlist(n.RECENT_THREAD_OFFSET,cb._currentCountMap[cb._folder][cb._filter],cb._folder,cb._filter,function(eb,fb){h.hide(cb._loadingSpinner);va(cb,eb,fb);ra(cb);na(cb);cb._manager.poke();cb._manager.forceFireScrollCallbacks();},null,k.WEBMESSENGER);if(db)cb._threadlistSubscription={subscriber_id:db,folder:cb._folder,filter:cb._filter};}function ta(cb){if(cb._requestInFlight||h.hasClass(cb._loadMoreButton,'hidden_elem'))return;cb._requestInFlight=true;h.addClass(cb._loadMoreButton,'async_saving');cb._pagerExponent=Math.min(cb._pagerExponent+1,v.EXPONENTIAL_PAGER_MAX_CYCLES);var db=Math.pow(2,cb._pagerExponent),eb=cb._currentCountMap[cb._folder][cb._filter]+db*(n.WEBMESSENGER_MORE_COUNT);ia(cb);var fb=cb._orderedThreadlist.getFilteredThreadlist(n.RECENT_THREAD_OFFSET,eb,cb._folder,cb._filter,function(gb,hb){h.removeClass(cb._loadMoreButton,'async_saving');cb._currentCountMap[cb._folder][cb._filter]=eb;va(cb,gb,hb);na(cb);cb._manager.poke();cb._requestInFlight=false;},null,k.WEBMESSENGER);if(fb)cb._threadlistSubscription={subscriber_id:fb,folder:cb._folder,filter:cb._filter};}function ua(cb,db){if(!cb._folder||!cb._olderTimestamp[cb._folder])return;var eb=cb._orderedThreadlist.getThreadlistUntilTimestamp(cb._olderTimestamp[cb._folder],cb._folder,cb._filter);if(cb._filter==o.UNREAD){eb=xa(cb,eb);}else cb._unreadThreadIDs=[];if(eb.length>cb._currentCountMap[cb._folder][cb._filter])cb._currentCountMap[cb._folder][cb._filter]=eb.length;cb._threadIDs=eb;ra(cb);t.renderThreadsFromIDs(cb._threadlistRows,eb,cb._selection,ya,db,q.MASTER.RECENT_THREADS);na(cb);cb._manager.poke();}function va(cb,db,eb){var fb=(db.length==cb._currentCountMap[cb._folder][cb._filter]);if(fb)db.pop();if(db.length){var gb=db[db.length-1];cb._threads.getThreadMeta(gb,function(hb){cb._olderTimestamp[cb._folder]=hb.timestamp;},k.WEBMESSENGER);}if(cb._filter==o.UNREAD){cb._unreadThreadIDs=db;}else cb.unreadThreadIDs=[];h.conditionShow(cb._loadMoreButton,fb);cb._threadIDs=db;t.renderThreadsFromIDs(cb._threadlistRows,db,cb._selection,ya,null,q.MASTER.RECENT_THREADS);eb=eb&&db.length===0;eb&&wa(cb);h.conditionShow(cb._infoBox,eb);}function wa(cb){if(cb._builtErrorMessage)return;i.setContent(cb._infoBox,x.render("Could Not Load Conversations",[{text:"Try Again",handler:sa.bind(null,cb)}]));cb._builtErrorMessage=true;}function xa(cb,db){db.forEach(function(eb){if(cb._unreadThreadIDs.indexOf(eb)<0)cb._unreadThreadIDs.push(eb);});cb._unreadThreadIDs.sort(function(eb,fb){var gb=cb._threads.getThreadMetaNow(eb).timestamp,hb=cb._threads.getThreadMetaNow(fb).timestamp;return hb-gb;});cb._unreadThreadIDs=cb._unreadThreadIDs.filter(function(eb){var fb=cb._threads.getThreadMetaNow(eb);return m.getFromMeta(fb)==cb._folder;});return cb._unreadThreadIDs;}function ya(cb){if(cb)return ga+cb;return null;}function za(cb){if(!bb(cb))return;if(u.isActive(5000)){ab(cb);}else u.subscribeOnce(ab.curry(cb));}function ab(cb){if(bb(cb))cb._unseenState.markAsSeen();}function bb(cb){return cb._active&&cb._folder==o.INBOX&&cb._unseenMessagesNotice.isScrolledWithinTopThreshold();}e.exports=ha;});
__d("MercurySearchThreadResultOrderer",["MessagingTag","MercuryThreads","createObjectFrom"],function(a,b,c,d,e,f){var g=b('MessagingTag'),h=b('MercuryThreads').get(),i=b('createObjectFrom'),j={separateCanonicalThreadsInFolder:function(p,q){var r=[],s=[];p.forEach(function(t){var u=h.getThreadMetaNow(t);if(u.folder===q&&u.is_canonical){r.push(t);}else s.push(t);});return {canonical_in_folder:r.sort(l),remaining:s};},orderResults:function(p,q,r,s){var t=o(q,r),u=t.sort(k.curry(s));return o(p,u);}};function k(p,q,r){var s=h.getThreadMetaNow(q),t=h.getThreadMetaNow(r),u=m(s),v=m(t);if(u!==v)return n(u,p)>n(v,p)?-1:1;if(s.is_canonical!==t.is_canonical)return s.is_canonical?-1:1;return l(q,r);}function l(p,q){var r=h.getThreadMetaNow(p),s=h.getThreadMetaNow(q);return r.timestamp>s.timestamp?-1:1;}function m(p){return p.is_archived?g.ACTION_ARCHIVED:p.folder;}function n(p,q){if(p===q)return 5;var r={};r[g.INBOX]=4;r[g.ACTION_ARCHIVED]=3;r[g.OTHER]=2;r[g.SPAM]=1;return r[p];}function o(p,q){var r=i(p),s=q.filter(function(t){return !(t in r);});return p.concat(s);}e.exports=j;});
__d("WebMessengerMasterViewSearchThreadsControl",["Event","CSS","DOM","MercuryFolders","MercuryLogger","MercurySearchThreadResultOrderer","MercurySearchThreadResults","MercurySearchThreadsStrategy","WebMessengerShortcuts","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","WebMessengerThreadlistRenderer","WebMessengerEvents","WebMessengerMercury","WebMessengerSubscriptionsHandler","copyProperties","createObjectFrom","csx","cx","ge"],function(a,b,c,d,e,f){var g=b('Event'),h=b('CSS'),i=b('DOM'),j=b('MercuryFolders'),k=b('MercuryLogger'),l=b('MercurySearchThreadResultOrderer'),m=b('MercurySearchThreadResults'),n=b('MercurySearchThreadsStrategy'),o=b('WebMessengerShortcuts'),p=b('WebMessengerStateConstants'),q=b('WebMessengerStateManager'),r=b('WebMessengerTemplates'),s=b('WebMessengerThreadlistRenderer'),t=b('WebMessengerEvents'),u=b('WebMessengerMercury'),v=b('WebMessengerSubscriptionsHandler'),w=b('copyProperties'),x=b('createObjectFrom'),y=b('csx'),z=b('cx'),aa=b('ge'),ba='search:',ca='search-indicator',da=function(za,ab,bb,cb){this._manager=za;this._rootElement=ab;this._noMessagesIndicator=cb;this._orderedThreadlist=u.getOrderedThreadlist();this._threadInformer=u.getThreadInformer();this._threads=u.getThreads();i.empty(this._rootElement);var db=r[':fb:web-messenger:thread-search'].build();i.setContent(this._rootElement,db.getRoot());this._loadingSpinner=db.getNode('loadingSpinner');this._threadlistRows=db.getNode('threadlistRows');this._loadMoreButton=db.getNode('loadMoreButton');this._loadMoreLink=db.getNode('loadMoreLink');var eb=r[':fb:web-messenger:master-view-snippets-link'].build();this._threadSearchResultDescription=eb.getNode('threadSearchResultDescription');this._searchMessagesIndicator=eb.getRoot();this._searchMessagesIndicator.setAttribute('id',ba+ca);i.replace(bb,this._searchMessagesIndicator);this._snippetSearchLink=eb.getNode('snippetSearchLink');this._snippetSearchLinkText=eb.getNode('snippetSearchLinkText');this._active=false;this._detailState=null;this._query=null;this._folder=null;this._selection=null;this._keyboardSelection=null;this._threadIDs=[];this._oldestTimestamps=fa(this);this._namesChangedSinceLastRedraw=false;this._remoteResultsCompleted=true;v.addSubscriptions(this._threadInformer.subscribe('threadlist-updated',function(fb,gb){ra(this,x(gb));}.bind(this)),this._threadInformer.subscribe('messages-received',function(){this._namesChangedSinceLastRedraw=true;}.bind(this)),g.listen(this._loadMoreLink,'click',function(){qa(this);}.bind(this)),g.listen(this._snippetSearchLink,'click',function(){this.updateKeyboardSelection(ca);ya(this);}.bind(this)));};w(da.prototype,{updateView:function(){this._active=true;h.show(this._rootElement);h.hide(this._loadingSpinner);var za=ga(this),ab=ha(this),bb=this._folder,cb=this._query,db=this._selection;ia(this);if(ab||za){var eb=this._keyboardSelection;switch(this._detailState){case p.DETAIL.RECENT_MESSAGES:this._keyboardSelection=this._selection;break;case p.DETAIL.SEARCH_SNIPPET:case p.DETAIL.SEARCH_CONTEXT:this._keyboardSelection=ca;}ja(this,eb);}if(za){oa(this);}else{ka(this,false);pa(this);}if(cb!=this._query||bb!=this._folder)k.logThreadlistFromSearch(this._query,this._folder);if(this._selection&&db!=this._selection)k.logThreadFromSearch(this._query,this._selection);},hideView:function(){this._active=false;h.hide(this._rootElement);sa(this,false);pa(this);},openSearchThread:function(za){if(za==ca){ya(this);}else q.updateDetailState(p.DETAIL.RECENT_MESSAGES,{query:this._query,thread_id:za});},updateKeyboardSelection:function(za){var ab=this._keyboardSelection;this._keyboardSelection=za;ja(this,ab);},destroy:function(){ea(this);}});function ea(za){za._searchThreadsSubscription&&m.unsubscribe(za._searchThreadsSubscription.subscriber_id,za._searchThreadsSubscription.query);za._searchThreadsSubscription=null;}function fa(za){var ab={};j.getSupportedFolders().forEach(function(bb){var cb=za._orderedThreadlist.getThreadlistUntilTimestamp(0,bb);ab[bb]=cb.length>0?za._threads.getThreadMetaNow(cb[cb.length-1]).timestamp:Infinity;}.bind(this));return ab;}function ga(za){var ab=za._namesChangedSinceLastRedraw;za._namesChangedSinceLastRedraw=false;if(ab)return true;if(!za._remoteResultsCompleted)return true;var bb=fa(za),cb=za._oldestTimestamps;za._oldestTimestamps=bb;var db=q.getCurrentStateData();if(za._query!==db.query||za._folder!==db.folder)return true;for(var eb in cb)if(cb[eb]>bb[eb])return true;return false;}function ha(za){var ab=q.getCurrentStateData();if(za._selection!=ab.thread_id)return true;return false;}function ia(za){var ab=q.getCurrentStateData();za._detailState=q.getCurrentDetailState();za._query=ab.query;za._folder=ab.folder;za._selection=ab.thread_id;}function ja(za,ab){var bb=aa(wa(ab));if(bb){h.removeClass(bb,"_kv");bb.removeAttribute('aria-selected');}var cb=aa(wa(za._keyboardSelection));if(cb){h.addClass(cb,"_kv");cb.setAttribute('aria-selected',true);}t.updateSelection(cb&&cb.id);}function ka(za,ab){if(za._keyboardSelection&&za._keyboardSelection!=ca&&za._threadIDs.indexOf(za._keyboardSelection)<0)za._keyboardSelection=null;if(!za._keyboardSelection)if(za._threadIDs.length){za._keyboardSelection=za._threadIDs[0];}else if(!ab){za._keyboardSelection=ca;ja(za);}var bb=za._threadIDs.slice(0);bb.push(ca);if(za._active)o.updateThreadlistIndex(za,bb.map(wa),wa(za._keyboardSelection));}function la(za){var ab=i.scry(za._threadlistRows,"._l5");ab.filter(function(bb){return i.getText(bb)!==q.getCurrentStateData().folder;}).forEach(h.show.bind(h));}function ma(za){var ab=i.scry(za._threadlistRows,"._l5");ab.forEach(h.hide.bind(h));}function na(za){la(za);za._manager.draw();}function oa(za){h.show(za._loadingSpinner);sa(za,false);h.hide(za._threadlistRows);h.hide(za._loadMoreButton);ma(za);ea(za);if(za._query){var ab=[],bb=[];za._remoteResultsCompleted=false;n.search(za._query,function(cb){var db=l.separateCanonicalThreadsInFolder(cb,q.getCurrentStateData().folder);ab=db.canonical_in_folder;bb=db.remaining;xa(za);h.show(za._threadlistRows);ua(za,ab);na(za);},function(cb,db){za._remoteResultsCompleted=true;var eb=l.orderResults(ab,bb,cb,q.getCurrentStateData().folder);if(eb.length>0){h.conditionShow(za._loadMoreButton,!db);va(za,eb);}else ta(za);h.hide(za._loadingSpinner);na(za);},function(cb,db){if(cb)za._searchThreadsSubscription={subscriber_id:cb,query:db};});}else{n.clearTimer();h.hide(za._loadingSpinner);i.empty(za._threadlistRows);h.show(za._threadlistRows);za._threadIDs=[];}pa(za);}function pa(za){var ab=!!za._query&&za._active,bb=ab^h.shown(za._searchMessagesIndicator);h.conditionShow(za._searchMessagesIndicator,ab);za._manager.sizeToFit(ab);bb&&za._manager.draw();}function qa(za){ea(za);h.addClass(za._loadMoreButton,'async_saving');var ab=m.getMoreThreadlist(za._query,function(bb,cb){h.removeClass(za._loadMoreButton,'async_saving');h.conditionShow(za._loadMoreButton,!cb);va(za,bb);za._manager.poke();});if(ab)za._searchThreadsSubscription={subscriber_id:ab,query:za._query};}function ra(za,ab){if(za._threadIDs.length){s.renderThreadsFromIDs(za._threadlistRows,za._threadIDs,za._keyboardSelection,wa,ab,p.MASTER.SEARCH);za._manager.poke();}}function sa(za,ab){ab=ab&&za._active;h.conditionClass(za._searchMessagesIndicator,"_33x",ab!==false);h.conditionShow(za._noMessagesIndicator,ab!==false);}function ta(za){za._threadIDs=[];ka(za,false);var ab=i.tx._("No people or conversations named {query}",{query:za._query}),bb=i.create('div',{},ab);i.setContent(za._noMessagesIndicator,bb);sa(za,true);}function ua(za,ab){va(za,ab,true);}function va(za,ab,bb){za._threadIDs=ab;ka(za,bb);s.renderThreadsFromIDs(za._threadlistRows,ab,za._keyboardSelection,wa,null,p.MASTER.SEARCH);t.updateSelection(za._keyboardSelection);if(za._keyboardSelection==ca)ja(za);}function wa(za){if(za)return ba+za;return null;}function xa(za){var ab=i.tx._("Showing results for name: {query}",{query:za._query});i.setContent(za._threadSearchResultDescription,ab);}function ya(za){if(za._query){q.updateDetailState(p.DETAIL.SEARCH_SNIPPET,{query:za._query,message_query:za._query});t.focusSearch();}}e.exports=da;});
__d("WebMessengerMasterViewControlManager",["ArbiterMixin","DOM","WebMessengerFlexibleScrollArea","WebMessengerMasterViewTabBarControl","WebMessengerMasterViewSearchInputControl","WebMessengerMasterViewRecentThreadsControl","WebMessengerMasterViewSearchThreadsControl","WebMessengerStateManager","WebMessengerStateConstants","Style","WebMessengerTemplates","WebMessengerEvents","WebMessengerSubscriptionsHandler","copyProperties"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('DOM'),i=b('WebMessengerFlexibleScrollArea'),j=b('WebMessengerMasterViewTabBarControl'),k=b('WebMessengerMasterViewSearchInputControl'),l=b('WebMessengerMasterViewRecentThreadsControl'),m=b('WebMessengerMasterViewSearchThreadsControl'),n=b('WebMessengerStateManager'),o=b('WebMessengerStateConstants'),p=b('Style'),q=b('WebMessengerTemplates'),r=b('WebMessengerEvents'),s=b('WebMessengerSubscriptionsHandler'),t=b('copyProperties'),u=function(v){this._rootElement=v;h.empty(this._rootElement);var w=q[':fb:web-messenger:master-view'].build();h.setContent(this._rootElement,w.getRoot());this._tabBarControl=new j(this,w.getNode('masterViewTabBar'),w.getNode('masterViewTopContent'));this._searchInputControl=new k(this,w.getNode('masterViewSearchInput'));this._searchThreadsControl=new m(this,w.getNode('masterViewSearchThreads'),w.getNode('searchMessagesIndicator'),w.getNode('noMessages'));this._threadlistRowsWrapper=w.getNode('threadlistRowsWrapper');this._flexArea&&this._flexArea.destroy();var x={fade:true,persistent:true};this._flexArea=new i(this._threadlistRowsWrapper,x).setInfiniteScrollHandler(this.inform.bind(this,'scrolledNearBottom')).setContainer(this._rootElement).setMinFlexAreaHeight(40).draw();this._recentThreadsControl=new l(this,w.getNode('masterViewRecentThreads'),w.getNode('masterInfoBox'),w.getNode('masterViewTabBar'));s.addSubscriptions(r.subscribe(r.FOCUS_AND_SELECT_SEARCH,this._searchInputControl.focusAndSelectSearch.bind(this._searchInputControl)),r.subscribe(r.FOCUS_SEARCH,this._searchInputControl.focus.bind(this._searchInputControl)),r.subscribe(r.MASTER_DOM_CHANGED,function(){this._tabBarControl.updateView();this._flexArea&&this._flexArea.draw();}.bind(this)),n.subscribe(o.STATE_CHANGE_EVENT,this.updateOnStateChange.bind(this)));this._resizeNodes=[this._rootElement,this._threadlistRowsWrapper,h.find(this._threadlistRowsWrapper,'div.uiScrollableAreaBody')];};t(u.prototype,g,{updateOnStateChange:function(){var v=n.getCurrentMasterState();this._tabBarControl.updateView();this._searchInputControl.updateView();switch(v){case o.MASTER.RECENT_THREADS:this._searchThreadsControl.hideView();this._recentThreadsControl.updateView();break;case o.MASTER.SEARCH:this._recentThreadsControl.hideView();this._searchThreadsControl.updateView();break;}},scrollIntoView:function(v,w){this._flexArea&&this._flexArea.scrollIntoView(v,w);},scrollToBottom:function(v){this._flexArea&&this._flexArea.scrollToBottom(v);},scrollToTop:function(v){this._flexArea&&this._flexArea.scrollToTop(v);},isScrolledToTop:function(){return this._flexArea&&this._flexArea.isScrolledToTop();},getScrollTop:function(){return this._flexArea.getScrollableArea().getScrollTop();},draw:function(){this._flexArea&&this._flexArea.draw();},poke:function(){this._flexArea&&this._flexArea.poke();},sizeToFit:function(v){this._flexArea&&this._flexArea.setSizeToFit(v);},setScrollCallback:function(v){this._flexArea&&this._flexArea.setScrollCallback(v);},forceFireScrollCallbacks:function(){this._flexArea&&this._flexArea._onScroll();},getFlexAreaElement:function(){return this._flexArea.flexArea;},resizeTo:function(v){this._resizeNodes.forEach(function(w){p.set(w,'width',v+'px');});r.masterDOMChanged();},destroy:function(){this._tabBarControl.destroy();this._recentThreadsControl.destroy();this._searchThreadsControl.destroy();this._flexArea.destroy();}});e.exports=u;});
__d("WebMessengerPageTitleRenderer",["DocumentTitle","MercuryAPIArgsSource","MercuryParticipants","WebMessengerStateConstants","WebMessengerStateManager","MercuryThreadMetadataRenderer","MercuryThreads","tx"],function(a,b,c,d,e,f){var g=b('DocumentTitle'),h=b('MercuryAPIArgsSource'),i=b('MercuryParticipants'),j=b('WebMessengerStateConstants'),k=b('WebMessengerStateManager'),l=b('MercuryThreadMetadataRenderer').get(),m=b('MercuryThreads').get(),n=b('tx'),o={updateTitleForState:function(r,s,t){this.withTitleForState(r,s,t||function(u){var v=k.getCurrentDetailState(),w=k.getCurrentStateData();if(r===v&&s===w)g.set(u);});},withTitleForState:function(r,s,t){switch(r){case j.DETAIL.RECENT_MESSAGES:p(s.thread_id,t);break;default:q(t);break;}}};function p(r,s){if(!r){q(s);return;}m.getThreadMeta(r,function(t){if(t.name){s(n._("{conversation_name} - Messages",{conversation_name:t.name}));return;}i.getMulti(t.participants,function(u){var v=l.renderParticipantList(r,u,u[i.user]?t.participants.length-1:t.participants.length,{abbr_mode:true,last_separator_uses_and:true,names_renderer:function(w){var x=[],y=Object.keys(w);if(y.length===1&&y[0]===i.user){x.push(w[y[0]].name);}else for(var z=0,aa=y.length;z<aa;z++)if(y[z]!==i.user)x.push(w[y[z]].name);return x;}});s(n._("{conversation_name} - Messages",{conversation_name:v}));});},h.WEBMESSENGER);}function q(r){r("Messages");}e.exports=o;});
__d("WebMessengerPageTitleControl",["WebMessengerPageTitleRenderer","WebMessengerStateManager","WebMessengerStateConstants","WebMessengerSubscriptionsHandler"],function(a,b,c,d,e,f){var g=b('WebMessengerPageTitleRenderer'),h=b('WebMessengerStateManager'),i=b('WebMessengerStateConstants'),j=b('WebMessengerSubscriptionsHandler'),k=function(){j.addSubscriptions(h.subscribe(i.STATE_CHANGE_EVENT,function(){g.updateTitleForState(h.getCurrentDetailState(),h.getCurrentStateData());}));};e.exports=k;});
__d("WebMessengerThreadMessagesAgent",["MercuryAPIArgsSource","MercuryMessages","MessagingTag","MercuryOrderedThreadlist","MercuryThreadInformer","MercuryThreads","WebMessengerConstants","copyProperties"],function(a,b,c,d,e,f){var g=b('MercuryAPIArgsSource'),h=b('MercuryMessages').get(),i=b('MessagingTag'),j=b('MercuryOrderedThreadlist').get(),k=b('MercuryThreadInformer').get(),l=b('MercuryThreads').get(),m=b('WebMessengerConstants'),n=b('copyProperties'),o=21,p=false,q='n_inbox_n_unreads',r=m.THREADLIST_MAX_READ_PRELOAD_NUM,s=m.THREADLIST_MAX_UNREAD_PRELOAD_NUM,t=function(){this._active=true;this._iterative=p;this._strategy=q;this._requestInFlight=false;this._requestIsQueued=false;this._pendingThreadIds={};this._processedThreadIds={};this._threadInformerSubscriptions=[];this._threadInformerSubscriptions.push(k.subscribe('threadlist-updated',u.curry(this)));};n(t.prototype,{turnOn:function(){this._active=true;},turnOff:function(){this._active=false;},destroy:function(){this._threadInformerSubscriptions.forEach(k.unsubscribe);this._threadInformerSubscriptions=[];}});function u(x){if(x._active&&!x._requestIsQueued){if(x._requestInFlight){x._requestIsQueued=true;return;}var y=v(x);if(y.length){x._requestInFlight=true;if(y.length>o){y=y.slice(0,o);x._requestIsQueued=true;}}y.forEach(function(z){x._processedThreadIds[z]=true;x._pendingThreadIds[z]=true;h.getThreadMessagesRange(z,0,m.INITIAL_MESSAGES_LIMIT+1,function(){w(x,z);},null,g.WEBMESSENGER);});}}function v(x){var y=j.getThreadlistUntilTimestamp(0,i.INBOX),z=y.filter(function(ea){return !x._processedThreadIds[ea]&&!h.hasLoadedNMessages(ea,m.INITIAL_MESSAGES_LIMIT+1);});if(x._strategy===q){var aa=[],ba=[];for(var ca=0;ca<z.length;ca++){var da=l.getThreadMetaNow(z[ca]);if(da){if(da.unread_count&&ba.length<s)ba.push(z[ca]);if(!da.unread_count&&aa.length<r)aa.push(z[ca]);if(ba.length>=s&&aa.length>=r)break;}}z=aa.concat(ba);}return z;}function w(x,y){if(x._pendingThreadIds[y])delete x._pendingThreadIds[y];if(Object.keys(x._pendingThreadIds).length===0){if(!x._iterative)x._active=false;x._requestInFlight=false;if(x._requestIsQueued){x._requestIsQueued=false;u(x);}}}e.exports=t;});
__d("WebMessengerAdsControl",["Arbiter","CSS","DOM","EgoAdsObjectSet","Env","Event","KeyedCallbackManager","MercuryParticipants","MercuryThreads","UIPagelet","URI","UserActivity","Vector","WebMessengerStateManager","cx","WebMessengerSubscriptionsHandler","copyProperties","csx","throttle","WebMessengerConstants"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('CSS'),i=b('DOM'),j=b('EgoAdsObjectSet'),k=b('Env'),l=b('Event'),m=b('KeyedCallbackManager'),n=b('MercuryParticipants'),o=b('MercuryThreads').get(),p=b('UIPagelet'),q=b('URI'),r=b('UserActivity'),s=b('Vector'),t=b('WebMessengerStateManager'),u=b('cx'),v=b('WebMessengerSubscriptionsHandler'),w=b('copyProperties'),u=b('cx'),x=b('csx'),y=b('throttle'),z=b('WebMessengerConstants'),aa=z.ADS_ROTATION_INTERVAL_PASSIVE,ba=z.ADS_ROTATION_THRESHOLD_ACTIVE,ca=z.MAX_ADS,da=2,ea=165,fa='data-height',ga=new m(),ha='webMessengerAdsStage',ia=0;function ja(){}w(ja,{init:function(){this._ads=new j();this._initializedAds=false;this._loadingCount=null;this._stage=null;this._drawCount=0;this._lastRefresh=0;this._pageletInProgress=null;this._lastMousedOnAds=false;this._waitOn(['codes','container','sidebar','footer'],this.start.bind(this));v.addSubscriptions(r.subscribe(this._refreshIfReady.shield(this)),g.subscribe('footerLoaded',function(){ga.setResource('footer',1);}),g.subscribe(['sidebar/initialized','sidebar/show','sidebar/hide'],this._sideBarChanged.bind(this)),ga);return this;},setContainer:function(qa){ga.setResource('container',qa);this._container=qa;},setTrackingCodes:function(qa){ga.setResource('codes',qa);},getTrackingCodes:function(){return ga.getResource('codes');},start:function(){this._stage=i.create('div',{id:ha,className:"_2rn"});this._ego=i.find(this._container,"._81");i.insertAfter(this._ego,this._stage);this._updateFooterHeight();this.waitForAdsLoad(this._container,this._processOnPageUnits.bind(this));v.addSubscriptions(l.listen(window,'resize',y(this.draw,100,this)),l.listen(this._ego,'mouseenter',this._mouseEvent.shield(this,true)),l.listen(this._ego,'mouseleave',this._mouseEvent.shield(this,false)));},stateChanged:function(qa,ra){qa=qa||{};ra=ra||{};if(qa.thread_id&&ra.thread_id&&ra.thread_id!==qa.thread_id)this._refreshIfReady(true);},draw:function(){var qa=this._loadingCount<=0;if(!this._initializedAds||!this._drawCount&&!qa)return;this._adjustAdsToFit();},_processOnPageUnits:function(){this._ads.init(oa(this._ego));this._initializedAds=true;this._adjustAdsToFit();},_processStagedUnits:function(){this._pageletInProgress=false;var qa=oa(this._stage);if(!this._lastMousedOnAds&&qa.length&&!this._focusedOnAds()){i.empty(this._ego);while(this._stage.childNodes.length)i.appendContent(this._ego,this._stage.firstChild);this._ads.init(qa);this._lastRefresh=Date.now();this._adjustAdsToFit();}},waitForAdsLoad:function(qa,ra){var sa=oa(qa);this._loadingCount=sa.length;if(!this._loadingCount){this._lastRefresh=Date.now()-aa/2;this._pageletInProgress=false;return;}var ta=function(ua){na(ua);if(--this._loadingCount<=0)ra();}.bind(this);sa.forEach(function(ua){function va(){ta.curry(ua).defer();}var wa=i.scry(ua,'img.img')[0];if(!wa||wa.complete){va();}else l.listen(wa,{load:va,error:va,abort:va});}.bind(this));},_adjustAdsToFit:function(){this._drawCount++;var qa=s.getViewportDimensions().y,ra=qa-this._footerHeight-ea,sa=ra,ta=0;while(sa>0&&ta<this._ads.getCount()){sa-=ma(this._ads.getUnit(ta));if(sa>=0)ta++;}ta=Math.max(ta,da);for(var ua=0;ua<this._ads.getCount();ua++)la(this._ads.getUnit(ua),ua>=ta);h.conditionShow(this._ego,ta);h.addClass(this._ads.getUnit(0),'ego_unit_no_top_border');var va=i.scry(this._container,'.ego_section');va.forEach(function(wa){ka(wa,i.scry(wa,'[data-onscreen]').length);});ka(this._container,true);this._registerImpressions(ta);this._registerHoldoutImpressions(ra);},_waitOn:function(qa,ra){ga.executeOrEnqueue(qa,ra);},_mouseEvent:function(qa){this._lastMousedOnAds=qa;},_focusedOnAds:function(){return i.contains(this._container,document.activeElement);},_refreshIfReady:function(qa){var ra=qa?ba:aa;if(this._lastRefresh===0){this._lastRefresh=Date.now();return;}else if(this._pageletInProgress||!this._drawCount||this._lastMousedOnAds||this._focusedOnAds()||this._lastRefresh+ra>Date.now())return;ga.reset();this._waitOn(['codes'],this.waitForAdsLoad.bind(this,this._stage,this._processStagedUnits.bind(this)));this._pageletInProgress=p.loadFromEndpoint('WebEgoPane',ha,{pid:43,data:[k.user,ca,++ia,pa()]},{crossPage:true,bundle:false});},_updateFooterHeight:function(){h.hide(this._ego);this._footerHeight=s.getElementDimensions(this._container).y;h.show(this._ego);},_registerImpression:function(qa){var ra=this.getTrackingCodes();if(!ra||!ra[qa])return;var sa=i.create('iframe',{src:q('/ai.php').addQueryData({aed:ra[qa]}),width:0,height:0,frameborder:0,scrolling:'no',className:'fbEmuTracking'});sa.setAttribute('aria-hidden','true');i.appendContent(this._container,sa);delete ra[qa];},_registerImpressions:function(qa){for(var ra=qa-1;ra>=0;--ra){if(!this._ads.getUnit(ra))continue;var sa=i.scry(this._ads.getUnit(ra),"div._4u8");if(!sa.length)continue;var ta=sa[0].getAttribute('data-ad'),ua=JSON.parse(ta).adid,va=this.getTrackingCodes();if(!va||!va[ua])return;this._registerImpression(ua);}},_registerHoldoutImpressions:function(qa){var ra=this._ads.getHoldoutAdIDsForSpace(qa,ma);if(ra)ra.forEach(this._registerImpression.bind(this));},_sideBarChanged:function(qa,ra){if(qa=='sidebar/initialized')ga.setResource('sidebar',1);this._initializedAds&&this.draw();}});function ka(qa,ra){h.conditionClass(qa,"_2rn",!ra);}function la(qa,ra){h.conditionClass(qa,"_22r",ra);qa.setAttribute('aria-hidden',ra?'true':'false');if(ra){qa.removeAttribute('data-onscreen');}else qa.setAttribute('data-onscreen','1');}function ma(qa){if(!qa)return 0;var ra=qa.getAttribute(fa)||na(qa);return parseInt(ra,10);}function na(qa){var ra=s.getElementDimensions(qa).y;qa.setAttribute(fa,ra);return ra;}function oa(qa){return i.scry(qa,'div.ego_unit');}function pa(){var qa=t.getCurrentStateData();if(qa.thread_id){var ra=o.getThreadMetaNow(qa.thread_id);if(ra)return ra.participants.map(n.getUserID).filter(function(sa){return sa&&sa!=k.user;});}return [];}e.exports=ja;});
__d("WebMessengerApp",["Arbiter","WebMessengerDetailViewControlManager","DOM","WebMessengerMasterViewControlManager","WebMessengerPageTitleControl","PageTransitions","WebMessengerPermalinks","MercuryServerRequests","WebMessengerShortcuts","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerStateStore","MercuryThreadInformer","WebMessengerThreadMessagesAgent","URI","VaultBoxURI","WebMessengerAdsControl","emptyFunction","WebMessengerSubscriptionsHandler","WebMessengerWidthControl","clickRefAction","userAction","MercuryStateCheck","WebMessengerTemplates"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('WebMessengerDetailViewControlManager'),i=b('DOM'),j=b('WebMessengerMasterViewControlManager'),k=b('WebMessengerPageTitleControl'),l=b('PageTransitions'),m=b('WebMessengerPermalinks'),n=b('MercuryServerRequests').get(),o=b('WebMessengerShortcuts'),p=b('WebMessengerStateConstants'),q=b('WebMessengerStateManager'),r=b('WebMessengerStateStore'),s=b('MercuryThreadInformer').get(),t=b('WebMessengerThreadMessagesAgent'),u=b('URI'),v=b('VaultBoxURI'),w=b('WebMessengerAdsControl'),x=b('emptyFunction'),y=b('WebMessengerSubscriptionsHandler'),z=b('WebMessengerWidthControl'),aa=b('clickRefAction'),ba=b('userAction');b('MercuryStateCheck');var ca=b('WebMessengerTemplates');d(['VideoCallCore'],x);var da,ea;d(['VaultBox'],function(la){ea=la.getInstance();});function fa(la,ma){var na=ma&&ma.getQueryData().hasOwnProperty('theater'),oa=ma&&v.isVaultBoxURI(ma);if(na){da=g.subscribe('PhotoSnowlift.CLOSE',ga.curry(la),g.SUBSCRIBE_NEW);return false;}else if(oa){if(ea)da=ea.subscribe('close',ga.curry(la),g.SUBSCRIBE_NEW);return false;}var pa=m.processURI(ma);if(pa){var qa=q.getCurrentStateData();if(pa.redirect){m.goNextURI(pa.master_state,pa.detail_state,pa.data,pa.replace);}else q.updateStateOnURI(pa.master_state,pa.detail_state,pa.data);l.transitionComplete();la._adsControl.stateChanged(qa,q.getCurrentStateData());return true;}ka(la);return false;}function ga(la){l.registerHandler(fa.curry(la),6);if(da){da.unsubscribe();da=null;}}function ha(){var la=q.getCurrentStateData();r.setLastSeen(la.folder,la.thread_id);}function ia(la,ma,na,oa,pa,qa){q.setUserID(qa);y.engage();ga(this);g.inform('chat/set_does_page_occlude_tabs',true,g.BEHAVIOR_PERSISTENT);g.inform('chat/set_show_tab_unread_ui',false,g.BEHAVIOR_PERSISTENT);new t();n.handleUpdate(ma);i.empty(la);var ra=ca[':fb:web-messenger:page-skeleton'].build();i.setContent(la,ra.getRoot());o.registerGeneralShortcuts();this._masterViewManager=new j(ra.getNode('masterView'));this._detailViewManager=new h(ra.getNode('detailView'));this._pageTitleControl=new k();oa&&i.prependContent(ra.getRoot(),oa);this._widthControl=new z(this._masterViewManager.resizeTo.bind(this._masterViewManager),this._detailViewManager.resizeTo.bind(this._detailViewManager),pa);this._adsControl=w.init();var sa=na?new u(na):m.getDefaultURI();fa(this,sa);aa('web_messenger').set_namespace('web_messenger');ba('web_messenger').uai('load').add_event('tti',0,window._cstart);y.addSubscriptions(s.subscribe('threads-deleted',function(ta,ua){var va=q.getCurrentStateData().thread_id,wa=q.getCurrentDetailState();if(wa==p.DETAIL.RECENT_MESSAGES&&ua[va]){q.updateDetailState(p.DETAIL.RECENT_MESSAGES,{thread_id:null});}else ha();}),q.subscribe(p.STATE_CHANGE_EVENT,ha));d(['MercuryBrowserAlerts'],function(ta){y.addSubscriptions(s.subscribe('messages-received',function(ua,va){for(var wa in va){var xa=va[wa];for(var ya=0;ya<xa.length;ya++)ta.messageReceived(xa[ya]);}}));ta.subscribe('before-alert',function(ua,event){if(event.threadID==ja())event.cancelAlert();});});}function ja(){var la=q.getCurrentDetailState(),ma=q.getCurrentStateData();if(la==p.DETAIL.RECENT_MESSAGES||la==p.DETAIL.SEARCH_CONTEXT)return ma.thread_id;return null;}function ka(la){var ma=true;d(['ChatTabModel'],function(na){ma&&na.persistLocalRaised();});y.release();g.inform('chat/set_does_page_occlude_tabs',false,g.BEHAVIOR_PERSISTENT);g.inform('chat/set_show_tab_unread_ui',true,g.BEHAVIOR_PERSISTENT);la._masterViewManager.destroy();la._detailViewManager.destroy();ma=false;}e.exports=ia;});
__d("WebMessengerComposerDataSource",["Class","MercuryConstants","ExpandableDataSource","MercuryIDs","WebMessengerStateManager","copyProperties"],function(a,b,c,d,e,f){var g=b('Class'),h=b('MercuryConstants'),i=b('ExpandableDataSource'),j=b('MercuryIDs'),k=b('WebMessengerStateManager'),l=b('copyProperties');function m(q){q=q||{};q.kanaNormalization=true;this.parent.construct(this,q,h.MercuryTypeaheadConstants.COMPOSER_THREADS_INITIAL_LIMIT,h.MercuryTypeaheadConstants.COMPOSER_SHOW_MORE_LIMIT);this._maxResults=h.MercuryTypeaheadConstants.COMPOSER_FRIENDS_MAX+h.MercuryTypeaheadConstants.COMPOSER_THREADS_INITIAL_LIMIT+h.MercuryTypeaheadConstants.COMPOSER_NON_FRIENDS_MAX;this._statesPerTokens={};this.subscribe('fetchComplete',function(r,s){var t=s.fetch_context,u=s.response.getPayload().entries;if(t.bootstrap)p(u);});}g.extend(m,i);l(m.prototype,{buildData:function(q){var r=[],s=[],t=[];q.forEach(function(v){var w=this.parent.getEntry(v);switch(w.render_type){case h.MercuryTypeaheadConstants.FRIEND_TYPE:if(r.length<h.MercuryTypeaheadConstants.COMPOSER_FRIENDS_MAX)r.push(v);break;case h.MercuryTypeaheadConstants.THREAD_TYPE:s.push(v);break;case h.MercuryTypeaheadConstants.NON_FRIEND_TYPE:if(t.length<h.MercuryTypeaheadConstants.COMPOSER_NON_FRIENDS_MAX)t.push(v);break;}}.bind(this));var u=r.concat(s,t);if(!this.hasLoadedAllResults()){this._maxResults=u.length+1;}else this._maxResults=u.length;return this.parent.buildData(u);},query:function(q,r,s){this.value=q;this.parent.query(q,r,s);},getQueryData:function(q,r){var s=this.parent.getQueryData(q,r);s.existing_token_ids=o();return s;},getStates:function(){var q=n();if(!this._statesPerTokens[q])this._statesPerTokens[q]={};return this._statesPerTokens[q];},fetchHandler:function(q,r){this.getState('loaded_all_threads_per_query')[r.value]=q.getPayload().end_of_threads;this.getState('loaded_initial_per_query')[r.value]=true;this.parent.fetchHandler(q,r);},hasLoadedInitialResults:function(q){if(q===undefined)q=this.value;return this.getState('loaded_initial_per_query')[q];},hasLoadedAllResults:function(q){if(q===undefined)q=this.value;return this.getState('loaded_all_threads_per_query')[q];}});function n(){var q=o().sort();return ','+q.join(',');}function o(){var q=k.getCurrentStateData();return (q.participants||[]).map(function(r){return j.tokenize(r).value;});}function p(q){q.forEach(function(r){r.render_type=h.MercuryTypeaheadConstants.FRIEND_TYPE;});}e.exports=m;});
__d("Photocrop2",["Event","ArbiterMixin","CSS","DOM","PhotosConst","Vector","Rect","copyProperties"],function(a,b,c,d,e,f){var g=b('Event'),h=b('ArbiterMixin'),i=b('CSS'),j=b('DOM'),k=b('PhotosConst'),l=b('Vector'),m=b('Rect'),n=b('copyProperties');function o(q,r,s){this.photo=q;if(s){this.imageDimensions=new l(s.x,s.y);}else this.imageDimensions=new l(q.offsetWidth,q.offsetHeight);n(this,n({target:this.photo.parentNode,create_target:false,target_parent:this.photo.parentNode,width:200,height:200,min_width:k.PIC_NORMAL_FBX_SIZE,min_height:k.PIC_NORMAL_FBX_SIZE,center_x:(this.photo.offsetWidth||200)/2,center_y:(this.photo.offsetHeight||200)/2,square:false},r));this.unscaledMinWidth=this.min_width;this.unscaledMinHeight=this.min_height;if(this.square){this.unscaledMinWidth=Math.min(this.min_width,this.min_height);this.unscaledMinHeight=this.unscaledMinWidth;}this.setNewRatio();this.width=Math.max(this.width,this.min_width);this.height=Math.max(this.height,this.min_height);var t=Math.min(this.width,this.height);if(t>this.photo.offsetWidth||t>this.photo.offsetHeight)t=Math.min(this.photo.offsetWidth,this.photo.offsetHeight);if(this.min_width>this.photo.offsetWidth)this.min_width=this.photo.offsetWidth;if(this.min_height>this.photo.offsetHeight)this.min_height=this.photo.offsetHeight;if(this.square){this.min_width=Math.min(this.min_width,this.min_height);this.min_height=this.min_width;}var u=this.center_x-t/2,v=this.center_y-t/2;this.box=new m(v,u+t,v+t,u);this.displacement=null;if(this.create_target){this.target=j.create('div');i.addClass(this.target,'stageCropper');this.target_parent.appendChild(this.target);}i.addClass(this.target,'photocrop');['bg','wrapper','viewport'].forEach(function(w){this[w]=j.create('div');i.addClass(this[w],w);}.bind(this));this.highlight=j.create('img',{src:q.src});i.addClass(this.highlight,'highlight');i.addClass(this.wrapper,'photocropWrapper');this.target.appendChild(this.bg);this.target.appendChild(this.wrapper);this.wrapper.appendChild(this.highlight);this.wrapper.appendChild(this.viewport);['ne','nw','sw','se'].forEach(function(w){var x=j.create('div');i.addClass(x,w);this.viewport.appendChild(x);i.addClass(x,'profilePicViewportGrabby');}.bind(this));g.listen(this.viewport,{mousedown:this.mousedown.bind(this),dragstart:g.kill,selectstart:g.kill,click:g.stop});g.listen(document,{mousemove:this.mousemove.bind(this),mouseup:this.mouseup.bind(this)});g.listen(window,{resize:this.adjustForResize.bind(this)});this.realignToPictureSize();this.redraw();}n(o.prototype,h);o.prototype.adjustForResize=function(){var q=this.ratio,r=this.setNewRatio(),s=r/q;this.box.t*=s;this.box.l*=s;this.box.b*=s;this.box.r*=s;this.redraw();this.realignToPictureSize();};o.prototype.setNewRatio=function(){this.ratio=this.photo.offsetWidth/this.imageDimensions.x;this.min_width=this.ratio*this.unscaledMinWidth;this.min_height=this.ratio*this.unscaledMinHeight;return this.ratio;};o.prototype.realignToPictureSize=function(){var q=this.photo;if(!q)return;[this.bg,this.wrapper].forEach(function(r){r.style.width=q.offsetWidth+'px';r.style.height=q.offsetHeight+'px';r.style.top=q.offsetTop+'px';r.style.left=q.offsetLeft+'px';});};var p=function(q,r,s){return Math.max(q,Math.min(s,r));};o.prototype.redraw=function(){var q=[this.box.t,this.box.r,this.box.b,this.box.l];this.highlight.style.width=this.photo.offsetWidth+"px";this.highlight.style.height=this.photo.offsetHeight+"px";this.highlight.style.clip="rect("+q.join("px ")+"px)";this.viewport.style.top=this.box.t+"px";this.viewport.style.left=this.box.l+"px";this.viewport.style.height=(this.box.b-this.box.t)+"px";this.viewport.style.width=(this.box.r-this.box.l)+"px";};o.prototype.done=function(q){this.freezeViewport=true;if(!q){[this.bg,this.wrapper].forEach(j.remove);if(this.create_target){j.remove(this.target);this.target=null;}else i.removeClass(this.target,'photocrop');}var r=Math.round(this.box.l*(1/this.ratio)),s=Math.round(this.box.t*(1/this.ratio)),t=Math.round(this.box.r*(1/this.ratio)),u=Math.round(this.box.b*(1/this.ratio));this.inform('done',q);return {x:Math.max(r,0),y:Math.max(s,0),width:t-Math.max(r,0),height:u-Math.max(s,0)};};o.prototype.mousedown=function(q){if(this.freezeViewport)return;this.mouseTarget=q.getTarget();this.pos=l.getEventPosition(q);var r=this.box.r-this.box.l;this.displacement=new l(r,r);i.addClass(document.body,'draggingMode');return false;};o.prototype.mousemove=function(q){if(!this.mouseTarget)return;var r=l.getEventPosition(q).sub(this.pos),s=this.min_width,t=this.min_height,u=this.box,v=this.wrapper.offsetWidth,w=this.wrapper.offsetHeight,x;if(this.mouseTarget===this.viewport){r.x=p(-u.l,r.x,v-u.r);r.y=p(-u.t,r.y,w-u.b);this.box=u.add(r);}else if(i.hasClass(this.mouseTarget,'ne')){if(this.square){this.displacement=this.displacement.add(r.x,-r.y);x=p(s,Math.max(this.displacement.x,this.displacement.y),Math.min(u.b,v-u.l));this.box.r=u.l+x;this.box.t=u.b-x;}else{this.box.r+=r.x=p(u.l+s-u.r,r.x,v-u.r);this.box.t+=r.y=p(-u.t,r.y,u.b-t-u.t);}}else if(i.hasClass(this.mouseTarget,'nw')){if(this.square){this.displacement=this.displacement.add(-r.x,-r.y);x=p(s,Math.max(this.displacement.x,this.displacement.y),Math.min(u.b,u.r));this.box.l=u.r-x;this.box.t=u.b-x;}else{this.box.b+=r.x=p(-u.l,r.x,u.r-s-u.l);this.box.t+=r.y=p(-u.t,r.y,u.b-t-u.t);}}else if(i.hasClass(this.mouseTarget,'se')){if(this.square){this.displacement=this.displacement.add(r.x,r.y);x=p(s,Math.max(this.displacement.x,this.displacement.y),Math.min(w-u.t,v-u.l));this.box.r=u.l+x;this.box.b=u.t+x;}else{this.box.r+=r.x=p(u.l+s-u.r,r.x,v-u.r);this.box.b+=r.y=p(u.t+t-u.b,r.y,w-u.b);}}else if(i.hasClass(this.mouseTarget,'sw'))if(this.square){this.displacement=this.displacement.add(-r.x,r.y);x=p(s,Math.max(this.displacement.x,this.displacement.y),Math.min(w-u.t,u.r));this.box.l=u.r-x;this.box.b=u.t+x;}else{this.box.l+=r.x=p(-u.l,r.x,u.r-s-u.l);this.box.b+=r.y=p(u.t+t-u.b,r.y,w-u.b);}this.redraw();this.pos=this.pos.add(r);return false;};o.prototype.mouseup=function(q){this.mouseTarget=null;i.removeClass(document.body,'draggingMode');};e.exports=o;});
__d("ProfilePicRequestCreator",["copyProperties","Form"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('Form');function i(j,k,l,m){this._fbid=j;this._owner=k;this._profileID=l;this._area=m;}g(i.prototype,{setSuccessURI:function(j){this._successURI=j;return this;},setErrorURI:function(j){this._errorURI=j;return this;},setIsUnscaled:function(j){this._isUnscaled=j;return this;},send:function(){var j=g({fbid:this._fbid,owner:this._owner,id:this._profileID,'return':this._successURI,error_return:this._errorURI,is_unscaled:this._isUnscaled},this._area);h.post('/crop_profile_pic.php',j);}});e.exports=i;});