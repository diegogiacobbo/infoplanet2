/*1364881559,173217057*/

if (self.CavalryLogger) { CavalryLogger.start_js(["fSGge"]); }

__d("CollectionsAddNewHub",["event-extensions","copyProperties","AsyncRequest","AsyncResponse","Event","Form","Keys","TimelineSection"],function(a,b,c,d,e,f){b('event-extensions');var g=b('copyProperties'),h=b('AsyncRequest'),i=b('AsyncResponse'),j=b('Event'),k=b('Form'),l=b('Keys'),m=b('TimelineSection'),n={init:function(o,p,q,r,s){m.callWithSection(r,function(t){this.initImpl(o,p,q,r,s,t.getNode());}.bind(this));},initImpl:function(o,p,q,r,s,t){if(!o)return;var u=o.getCore();o.subscribe('select',function(w,x){x.selected.uid||this.createHub(o,x.selected.orig_text||x.selected.text,p,q,r,s,t);}.bind(this));var v=o.getView();j.listen(u.getElement(),'keydown',function(event){if(j.getKeyCode(event)==l.RETURN&&!v.getSelection()){this.createHub(o,u.getValue(),p,q,r,s,t);event.kill();}}.bind(this));},createHub:function(o,p,q,r,s,t,u){var v=o.getCore();v.setEnabled(false);var w=function(){v.reset();v.getElement().blur();v.setEnabled(true);},x=g({title:p,type:q,root_id:u.id},k.serialize(t));new h(r).setData(x).setHandler(w).setErrorHandler(function(y){w();i.defaultErrorHandler(y);}).send();}};e.exports=n;});
__d("CollectionsRecommendationViewportTracking",["Class","DOM","ViewportTracking","copyProperties","csx"],function(a,b,c,d,e,f){var g=b('Class'),h=b('DOM'),i=b('ViewportTracking'),j=b('copyProperties'),k=b('csx'),l=55,m=200;function n(){this.parent.construct(this);}g.extend(n,i);j(n.prototype,{getDataFromConfig:function(o){this.control=o.control;},getTimeout:function(){return m;},getAllStories:function(){var o=h.scry(this.control,"._3owb");return o||[];},getStoryID:function(o){var p=JSON.parse(o.getAttribute('data-gt'));return p&&p.token;},getDataToLog:function(o){var p=j(JSON.parse(o.getAttribute('data-gt')),{evt:l});return {gt:p};}});n.init=function(o){var p=new n();p.init(j(o,{banzai:false}));return p;};e.exports=n;});
__d("TimelineCollectionRecommendationLogger",["JSLogger","TimelineAppCollection","TimelineSection"],function(a,b,c,d,e,f){var g=b('JSLogger'),h=b('TimelineAppCollection'),i=b('TimelineSection'),j=g.create('collections'),k={log:function(l,m,n,o){k.logByID(l,h.getIDByToken(m),n,o);},logByID:function(l,m,n,o){i.callWithSection(m,function(p){j.log('recommendation_interaction',{type:l,collection:p.getToken(),duration:o,gks:n,item_count:p.getCount(),sk:p.getMedleySiteKey()});});}};e.exports=k;});
__d("TimelineCollectionAddRecommendation",["Event","AsyncRequest","CollectionsRecommendationViewportTracking","CSS","DOM","JSLogger","OGCollectionAddObject","OnVisible","Parent","TimelineAppCollection","TimelineAppSection","TimelineAppSectionCuration","TimelineSection","TimelineCollectionRecommendationLogger","TriggerablePageletLoader","csx","cx","tidyEvent"],function(a,b,c,d,e,f){var g=b('Event'),h=b('AsyncRequest'),i=b('CollectionsRecommendationViewportTracking'),j=b('CSS'),k=b('DOM'),l=b('JSLogger'),m=b('OGCollectionAddObject'),n=b('OnVisible'),o=b('Parent'),p=b('TimelineAppCollection'),q=b('TimelineAppSection'),r=b('TimelineAppSectionCuration'),s=b('TimelineSection'),t=b('TimelineCollectionRecommendationLogger'),u=b('TriggerablePageletLoader'),v=b('csx'),w=b('cx'),x=b('tidyEvent'),y=l.create('collections'),z={},aa="._5rz",ba=5,ca=6,da=ba+ca,ea=500;m.subscribe(m.ADD_PLACEHOLDER,function(qa,ra){if(ra){var sa=pa.getPageletID(ra);t.logByID('add_typeahead',ra,z[sa].gks);}p.incrementCount(ra);});m.subscribe(m.REMOVE_PLACEHOLDER,function(qa,ra){p.decrementCount(ra);});function fa(qa){return k.find(qa,"._3owb").getAttribute('data-obj');}function ga(qa,ra){var sa=z[qa].items.shift();if(ra){var ta=ra.nextSibling||sa;ta&&na(qa,ta);k.remove(ra);}if(sa){k.insertBefore(z[qa].placeholder,sa);var ua=fa(sa);ua&&y.log('recommendation_impression',{collection:z[qa].collectionToken,object_id:ua});}ka(z[qa]);}function ha(qa,ra){var sa=[];while(ra.previousSibling){ra=ra.previousSibling;var ta=fa(ra);if(ta)sa.push(ta);}return sa.reverse();}function ia(qa){var ra,sa=qa.childNodes.length,ta=[];for(ra=0;ra<sa&&ra<ba;++ra){var ua=fa(qa.childNodes[ra]);if(ua)ta.push(ua);}return ta;}function ja(qa,ra){var sa=z[qa],ta=0;if(ra){ta=ca+1;j.addClass(sa.reload,"_4kgc");sa.reloadAnimating=true;setTimeout(function(){for(var ua=0;ua<ba;ua++)sa.grid.removeChild(sa.grid.firstChild);j.removeClass(sa.reload,"_4kgc");sa.reloadAnimating=false;ka(sa);},ea);}else{ta=k.scry(sa.grid,aa).length;if(sa.reloadAnimating)ta-=ba;}for(;ta<(sa.amount+ca)&&sa.items.length;ta++)ga(qa);la(qa,ta);ka(sa);sa.viewportTracking.fireTimer();}function ka(qa){qa.reloadDisabled=qa.grid.children.length<=da;j.conditionClass(qa.reload,"_4kg9",qa.reloadDisabled);}function la(qa,ra){var sa=z[qa];if(!sa.asyncing&&sa.items.length<sa.amount/2){sa.asyncStartTime=Date.now();sa.asyncing=new h('/ajax/open_graph/recommendation_reload').setData(sa.data).send();}if(sa.asyncing&&!j.hasClass(sa.reload,'async_saving')){if(ra===undefined)ra=k.scry(sa.grid,aa).length;j.conditionClass(sa.reload,'async_saving',ra<sa.amount);}}function ma(qa,ra){var sa=ha(qa,ra);ga(qa,ra);la(qa);return sa;}function na(qa,ra){var sa=z[qa].grid;j.addClass(sa,"_42fm");j.addClass(ra,"_42fn");var ta=g.listen(ra,'mouseover',function(){j.removeClass(ra,"_42fn");j.removeClass(sa,"_42fm");ta.remove();});}function oa(qa){var ra=z[qa];if(ra.filled)return;var sa=q.getIDBySK(ra.data.sk);s.callWithSection(sa,function(ta){var ua=ta.getActiveCollection().getToken(),va=r.getSectionState(sa);if(ua==ra.collectionToken&&va==r.SHOW_STATE){t.log('first_view',ra.collectionToken,ra.gks);ja(qa);ra.filled=true;}});}var pa={addTriggerLoader:function(qa,ra,sa){new u({controller:'TimelineAppCollectionRecommendationPagelet',data:sa,node:qa,options:{crossPage:1,jsNonblock:1}},[{node:ra,type:u.TRIGGER_ONVISIBLE}]);},getPageletID:function(qa){return 'pagelet_recommendation_'+qa.split(':')[2];},initButton:function(qa,ra,sa,ta){x(g.listen(qa,'click',function(ua){new h(ta).send();pa.plusRecommendation(sa,sa,o.byClass(ua.getTarget(),"_5rz"),ra,z[sa].collectionToken);}));},init:function(qa,ra,sa,ta,ua,va){var wa=z[qa]={addButtonVisible:va.add_button_visible,amount:va.amount,collectionToken:ua.collection_token,data:ua,isFirst:true,gks:va.gks,grid:ra,hoveredItem:va.items[0],items:va.items,placeholder:ta,postUri:va.post_uri,reload:sa,sessionID:ua.session_id,viewportTracking:i.init({control:ra})};t.log('first_render',wa.collectionToken,wa.gks);var xa=new n(wa.grid,function(){xa.reset();var za=function(){oa(qa);};q.subscribe('changeCollection',za);r.register(q.getIDBySK(ua.sk),za);za();},true,0),ya=g.listen(wa.grid,'mouseover',function(za){ya.remove();t.log('first_hover',wa.collectionToken,wa.gks);});if(va.previewPlaceholder)x([g.listen(wa.grid,'mouseover',function(za){var ab=o.byClass(za.getTarget(),"_5rz");if(!ab)return;p.addPlaceholderToCollection(wa.collectionToken,ab,{previewPlaceholder:true});}),g.listen(o.byClass(wa.grid,"_4kg6"),'mouseleave',function(za){p.removePlaceholderFromCollection(wa.collectionToken);})]);if(wa.addButtonVisible)x(g.listen(wa.grid,'mouseover',function(za){var ab=o.byClass(za.getTarget(),"_5rz");if(!ab)return;j.removeClass(wa.hoveredItem,"_504l");j.addClass(wa.hoveredItem=ab,"_504l");}));x(g.listen(z[qa].reload,'mousedown',function(za){var ab=JSON.parse(z[qa].reload.getAttribute('data-gt'));ab.rec_list_items=ia(z[qa].grid);z[qa].reload.setAttribute('data-gt',JSON.stringify(ab));}));x(g.listen(wa.reload,'click',function(za){if(!wa.reloadDisabled&&!wa.reloadAnimating){y.log('reload_recommendations',{collection:wa.collectionToken});t.log('reload',wa.collectionToken,wa.gks);ja(qa,true);}}));x(g.listen(wa.grid,'click',function(za){var ab=o.byTag(za.getTarget(),'a');if(!ab)return;var bb="_gx8",cb="_4q5f",db="_4-k4",eb=j.hasClass(ab,bb)||j.hasClass(ab,cb),fb=!eb&&j.hasClass(ab,db);if(eb||fb){var gb=o.byClass(ab,"_5rz"),hb=k.find(gb,"._3owb").getAttribute('data-obj'),ib=ma(qa,gb);if(eb){t.log('add',wa.collectionToken,wa.gks);p.addPlaceholderToCollection(wa.collectionToken,gb);var jb=wa.isFirst||0;delete wa.isFirst;new h(wa.postUri).setData({underlying_entity_id:hb,ignored_item_ids:ib,is_first:jb}).send();za.prevent();}else{t.log('x',wa.collectionToken,wa.gks);new h('/ajax/timeline/collections/remove_rec/').setData({objectid:hb,ignored_item_ids:ib}).send();}}}));},plusRecommendation:function(qa,ra,sa,ta,ua){var va=z[qa];if(qa==ra){t.log('add',ua,va.gks);}else t.log('add_alt',ua,va.gks);p.addPlaceholderToCollection(ua,sa);var wa=z[ra];if(qa!=ra&&wa){var xa=k.scry(wa.grid,'[data-obj="'+ta+'"]');if(xa&&xa.length>0){var ya=xa[0].parentNode;ga(ra,ya);la(ra);}}var za=ma(qa,sa),ab=va.isFirst||0;delete va.isFirst;return {ignored_item_ids:za,is_first:ab,session_id:va.sessionID};},populateSuggestionsList:function(qa,ra,sa){var ta=z[qa];if(ta.grid.children.length<da){var ua=Date.now()-ta.asyncStartTime;t.log('placeholder_view',ta.collectionToken,ta.gks,ua);}ta.items=z[qa].items.concat(ra);ta.data.exclude_ids=sa;ta.asyncing=false;j.removeClass(ta.reload,'async_saving');ja(qa);}};e.exports=pa;});
__d("TimelineCollectionItemReorder",["$","AsyncRequest","DataStore","DOMQuery","OGCollectionAddObject","Parent","SortableGroup","TimelineAppCollection","copyProperties","cx"],function(a,b,c,d,e,f){var g=b('$'),h=b('AsyncRequest'),i=b('DataStore'),j=b('DOMQuery'),k=b('OGCollectionAddObject'),l=b('Parent'),m=b('SortableGroup'),n=b('TimelineAppCollection'),o=b('copyProperties'),p=b('cx'),q='item-reorder-inst';function r(t,u){this._collectionToken=u;this._initSorting();i.set(g(t),q,this);n.subscribe(n.NEW_ITEM,this._processNewItem.bind(this,t));k.subscribe(k.NEW_ITEM,this._processNewItem.bind(this,t));}function s(t,u){var v=i.get(g(t),q);return v||new r(t,u);}o(r,{registerCollectionItems:function(t,u,v){var w=s(t,u);if(w)w._registerCollectionItems(v);}});o(r.prototype,{_initSorting:function(){this._sortableGroup=new m().setDropCallback(function(t,u){new h('/ajax/timeline/collections/reorder_items/').setData({order:this._sortableGroup.getOrder(),collection_token:this._collectionToken}).send();}.bind(this));},_registerCollectionItems:function(t){var u=j.scry(t,'li[data-sort-id]');u.forEach(function(v){this._registerCollectionItem(v);},this);},_registerCollectionItem:function(t){var u=t.getAttribute('data-sort-id');this._sortableGroup.addSortable.bind(this._sortableGroup,u,t).defer(500);},_processNewItem:function(t,u,v){var w=l.byClass(v.grid,"_30f");if(t!=w.id)return;this._registerCollectionItem(v.newItem);}});e.exports=r;});
__d("TimelineCollectionUnlikeHandler",["Arbiter","AsyncRequest","CSS","PageLikeButton","TimelineAppCollection"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncRequest'),i=b('CSS'),j=b('PageLikeButton'),k=b('TimelineAppCollection'),l={};g.subscribe(j.UNLIKED,function(n,o){var p=l[o.profile_id];if(p){i.hide(p.buttons);k.decrementCount(k.getIDByToken(p.collectionToken));new h('/ajax/timeline/app_collection_item/unlike/fbpage/').setData({collection_token:p.collectionToken,profile_id:o.profile_id}).send();l[o.profile_id]=null;}});var m={init:function(n,o,p){l[n]={buttons:p,collectionToken:o};}};e.exports=m;});
__d("TimelineInHouseOGCurationControl",["event-extensions","CSS","DOM","Parent","TimelineAppCollection","csx","cx"],function(a,b,c,d,e,f){b('event-extensions');var g=b('CSS'),h=b('DOM'),i=b('Parent'),j=b('TimelineAppCollection'),k=b('csx'),l=b('cx');function m(n,o,p,q){this._menu=n;this._collectionToken=o;this._popoverMenu=p;this._placeholderMarkup=q;this._menu.subscribe('itemclick',function(r,s){var t=s.item.getValue();if(t==o||t=="delete")return;var u=i.byClass(this._popoverMenu,"_3owb"),v=h.scry(u,"._1eds");v&&g.hide(v[0]);u.appendChild(q);g.hide(i.byClass(this._popoverMenu,"_1xg4"));if(!t)return;j.decrementCount(j.getIDByToken(o));j.addPlaceholderToCollection(t,u.parentNode);}.bind(this));}e.exports=m;});